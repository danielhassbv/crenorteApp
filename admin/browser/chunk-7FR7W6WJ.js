import{a as j}from"./chunk-F34SCIM2.js";import{i as $,q as B,u as L,v as Q,w as H}from"./chunk-FDAITWFV.js";import{f as z}from"./chunk-FTITK7GV.js";import"./chunk-UQF2N3UO.js";import"./chunk-5OO6GXAC.js";import{k as F,l as A,t as U,w as N}from"./chunk-DTXGXR4A.js";import{Hb as y,Jb as P,Ka as l,Kb as D,Ua as M,Za as f,a as w,aa as v,b as E,fb as d,g as b,ia as u,ib as n,ja as _,jb as i,kb as S,lb as R,mb as I,nb as C,qb as g,rb as m,tb as O,ub as T,vb as V,wb as k,xa as x,xb as a,yb as p,zb as h}from"./chunk-2KT3GOAN.js";var G=["preCadastrosModal"];function J(r,t){r&1&&(n(0,"div",22),a(1,"Carregando\u2026"),i())}function K(r,t){if(r&1){let e=C();n(0,"tr")(1,"td"),a(2),i(),n(3,"td"),a(4),y(5,"date"),i(),n(6,"td",34)(7,"button",29),g("click",function(){u(e);let s=m(2);return _(s.abrirPreCadastros((s.auth.currentUser==null?null:s.auth.currentUser.uid)||"","Meus pr\xE9-cadastros"))}),a(8," Visualizar pr\xE9-cadastros "),i()()()}if(r&2){let e=t.$implicit;l(2),p(e.nome),l(2),p(P(5,2,e.data,"dd/MM/yyyy HH:mm"))}}function W(r,t){r&1&&(n(0,"tr")(1,"td",36),a(2,"Sem registros."),i()())}function X(r,t){if(r&1){let e=C();n(0,"div")(1,"div",23)(2,"div",24)(3,"div")(4,"div",25),a(5,"Meus Pr\xE9-cadastros"),i(),n(6,"small",26),a(7),i()(),n(8,"div",27)(9,"a",28),a(10," Ver lista "),i(),n(11,"button",29),g("click",function(){u(e);let s=m();return _(s.abrirPreCadastros((s.auth.currentUser==null?null:s.auth.currentUser.uid)||"","Meus pr\xE9-cadastros"))}),a(12," Ver meus pr\xE9-cadastros "),i()()()(),n(13,"div",30)(14,"div",31)(15,"table",32)(16,"thead",33)(17,"tr")(18,"th"),a(19,"Nome"),i(),n(20,"th"),a(21,"Data"),i(),n(22,"th",34),a(23,"A\xE7\xF5es"),i()()(),n(24,"tbody"),f(25,K,9,5,"tr",35)(26,W,3,0,"tr",10),i()()()()()}if(r&2){let e=m();l(7),h("Total: ",e.meus().length,""),l(18),d("ngForOf",e.meus()),l(),d("ngIf",!e.meus().length)}}function Z(r,t){if(r&1){let e=C();n(0,"tr")(1,"td",38),a(2),i(),n(3,"td"),a(4),i(),n(5,"td",34)(6,"button",29),g("click",function(){let s=u(e).$implicit,c=m(2);return _(c.abrirPreCadastros(s.uid,s.assessor))}),a(7," Ver pr\xE9-cadastros "),i()()()}if(r&2){let e=t.$implicit;l(2),p(e.assessor),l(2),p(e.total)}}function ee(r,t){r&1&&(n(0,"tr")(1,"td",36),a(2,"Sem registros."),i()())}function te(r,t){if(r&1&&(n(0,"div")(1,"div",30)(2,"div",31)(3,"table",37)(4,"thead",33)(5,"tr")(6,"th"),a(7,"Assessor"),i(),n(8,"th"),a(9,"Total"),i(),n(10,"th",34),a(11,"A\xE7\xF5es"),i()()(),n(12,"tbody"),f(13,Z,8,2,"tr",35)(14,ee,3,0,"tr",10),i()()()()()),r&2){let e=m();l(13),d("ngForOf",e.porAssessor()),l(),d("ngIf",!e.porAssessor().length)}}function ne(r,t){r&1&&(n(0,"div",39),a(1," Seu perfil n\xE3o tem acesso a este relat\xF3rio. "),i())}function ie(r,t){if(r&1&&(n(0,"div",50)(1,"span",51),a(2,"CPF"),i(),n(3,"span",52),a(4),i()()),r&2){let e=m().$implicit;l(4),p(e.cpf)}}function re(r,t){if(r&1&&(n(0,"div",50)(1,"span",51),a(2,"Telefone"),i(),n(3,"span",52),a(4),i()()),r&2){let e=m().$implicit;l(4),p(e.telefone||e.contato)}}function oe(r,t){if(r&1&&(n(0,"div",50)(1,"span",51),a(2,"E-mail"),i(),n(3,"span",53),a(4),i()()),r&2){let e=m().$implicit;l(4),p(e.email)}}function ae(r,t){if(r&1&&(n(0,"div",50)(1,"span",51),a(2,"Endere\xE7o"),i(),n(3,"span",53),a(4),i()()),r&2){let e=m().$implicit;l(4),p(e.endereco||e.enderecoCompleto)}}function se(r,t){if(r&1){let e=C();n(0,"div",42)(1,"div",43)(2,"div",44)(3,"div",45),a(4),i(),n(5,"small",26),a(6),y(7,"date"),i()(),n(8,"div",46),f(9,ie,5,1,"div",47)(10,re,5,1,"div",47)(11,oe,5,1,"div",47)(12,ae,5,1,"div",47),i(),n(13,"div",48)(14,"button",49),g("click",function(){let s=u(e).$implicit,c=m(2);return _(c.iniciarCadastro(s))}),a(15," Iniciar cadastro "),i()()()()}if(r&2){let e=t.$implicit;l(3),d("title",e.nome),l(),p(e.nome||"\u2014"),l(2),h(" ",e.data?P(7,7,e.data,"dd/MM/yyyy HH:mm"):"-"," "),l(3),d("ngIf",e.cpf),l(),d("ngIf",e.telefone||e.contato),l(),d("ngIf",e.email),l(),d("ngIf",e.endereco||e.enderecoCompleto)}}function le(r,t){if(r&1&&(R(0),n(1,"div",40),f(2,se,16,10,"div",41),i(),I()),r&2){let e=m();l(2),d("ngForOf",e.selectedPreCadastros)}}function de(r,t){r&1&&(n(0,"div",26),a(1,"Sem pr\xE9-cadastros para exibir."),i())}var q=class r{service=v(j);auth=v($);afs=v(B);router=v(z);loading=x(!1);erro=x(null);papel="desconhecido";rows=x([]);preCadastrosModalRef;preCadastrosModal;selectedAssessorUid=null;selectedAssessorNome="";selectedPreCadastros=[];ngOnInit(){return b(this,null,function*(){this.loading.set(!0),this.erro.set(null);try{yield this.resolvePapel();let e=(yield this.service.listarTodos()).map(o=>E(w({},o),{data:this.toDate(o?.createdAt),nome:o?.nomeCompleto??o?.nome??""}));this.rows.set(e)}catch(t){console.error("[Relat\xF3rio] erro:",t),this.erro.set(t?.message||"Erro ao carregar relat\xF3rio.")}finally{this.loading.set(!1)}})}resolvePapel(){return b(this,null,function*(){let t=this.auth.currentUser?.uid;if(!t){this.papel="desconhecido";return}let e=Q(L(this.afs,"colaboradores"),t),s=(yield H(e)).data()?.papel,c=(typeof s=="string"?s:"").trim().toLowerCase(),Y=["admin","supervisor","coordenador","rh","assessor"];this.papel=Y.includes(c)?c:"assessor",console.log("[Relat\xF3rio] papel detectado:",s,"\u2192",this.papel)})}toDate(t){return t?typeof t?.toDate=="function"?t.toDate():t instanceof Date?t:typeof t=="number"?new Date(t):null:null}meus(){let t=this.auth.currentUser?.uid;return t?this.rows().filter(e=>e.createdByUid===t):[]}porAssessor(){let t=new Map;for(let e of this.rows()){let o=e.createdByUid??"sem-uid",s=e.createdByNome||"Assessor",c=t.get(o)??{uid:o,assessor:s,total:0};c.total+=1,t.set(o,c)}return Array.from(t.values()).sort((e,o)=>o.total-e.total)}abrirPreCadastros(t,e){this.selectedAssessorUid=t,this.selectedAssessorNome=e;let o=this.rows().filter(s=>t?s.createdByUid===t:!0).sort((s,c)=>(c.data?.getTime()||0)-(s.data?.getTime()||0));this.selectedPreCadastros=o,this.preCadastrosModalRef&&(this.preCadastrosModal=new bootstrap.Modal(this.preCadastrosModalRef.nativeElement,{backdrop:"static"}),this.preCadastrosModal.show())}fecharPreCadastros(){this.preCadastrosModal?.hide()}verDetalhes(t){console.log("[Pr\xE9-cadastro] detalhes:",t)}iniciarCadastro(t){let e=this.buildQueryFromPre(t);this.fecharPreCadastros(),this.router.navigate(["/cadastro","novo"],{queryParams:e})}onlyDigits(t){return(t??"").replace(/\D/g,"")}buildQueryFromPre(t){let e=this.onlyDigits(t.telefone??t.contato??""),o=this.onlyDigits(t.cpf??"");return{nome:t.nomeCompleto??t.nome??"",cpf:o,contato:e,email:t.email??"",endereco:t.endereco??t.enderecoCompleto??"",preCadastroId:t.id??t.uid??""}}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=M({type:r,selectors:[["app-pre-cadastro-relatorio"]],viewQuery:function(e,o){if(e&1&&O(G,5),e&2){let s;T(s=V())&&(o.preCadastrosModalRef=s.first)}},decls:28,vars:7,consts:[["preCadastrosModal",""],["semItens",""],[1,"container","py-4"],[1,"form-header","d-flex","justify-content-between","align-items-center","mb-3"],[1,"title-box","px-2"],[1,"form-title","mb-0"],[1,"subtitle"],[1,"logo-box"],["src","../../../assets/img/logo2-crenorte.png","alt","Logo CRENORTE",1,"logo-img"],["class","alert alert-light",4,"ngIf"],[4,"ngIf"],["class","alert alert-warning mt-3",4,"ngIf"],["tabindex","-1","aria-labelledby","preCadastrosModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-xl","modal-dialog-scrollable"],[1,"modal-content"],[1,"modal-header"],["id","preCadastrosModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[4,"ngIf","ngIfElse"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"alert","alert-light"],[1,"card","card-crenorte","shadow-sm","mb-3"],[1,"card-body","d-flex","justify-content-between","align-items-center"],[1,"h5","mb-0"],[1,"text-muted"],[1,"d-flex","gap-2"],["routerLink","/pre-cadastro/minha-lista",1,"btn","btn-outline-primary","btn-sm"],[1,"btn","btn-outline-success","btn-sm",3,"click"],[1,"card","card-crenorte","shadow-sm"],[1,"table-responsive"],[1,"table","mb-0"],[1,"table-light"],[1,"text-end"],[4,"ngFor","ngForOf"],["colspan","3",1,"text-center","text-muted","py-4"],[1,"table","align-middle","mb-0"],[1,"fw-semibold"],[1,"alert","alert-warning","mt-3"],[1,"row","g-3"],["class","col-12 col-sm-6 col-lg-4",4,"ngFor","ngForOf"],[1,"col-12","col-sm-6","col-lg-4"],[1,"pc-card","h-100","d-flex","flex-column"],[1,"pc-card__header"],[1,"pc-card__title","text-truncate",3,"title"],[1,"pc-card__body"],["class","pc-field",4,"ngIf"],[1,"pc-card__footer","mt-auto","d-flex","gap-2"],["type","button",1,"btn","btn-success","btn-sm","ms-auto",3,"click"],[1,"pc-field"],[1,"pc-label"],[1,"pc-value"],[1,"pc-value","text-truncate"]],template:function(e,o){if(e&1){let s=C();n(0,"div",2)(1,"div",3)(2,"div",4)(3,"h2",5),a(4,"Relat\xF3rio de Pr\xE9-cadastros"),i(),n(5,"small",6),a(6,"Microcr\xE9dito Produtivo Orientado"),i()(),n(7,"div",7),S(8,"img",8),i()(),f(9,J,2,0,"div",9)(10,X,27,3,"div",10)(11,te,15,2,"div",10)(12,ne,2,0,"div",11),n(13,"div",12,0)(15,"div",13)(16,"div",14)(17,"div",15)(18,"h5",16),a(19),i(),n(20,"button",17),g("click",function(){return u(s),_(o.fecharPreCadastros())}),i()(),n(21,"div",18),f(22,le,3,1,"ng-container",19)(23,de,2,0,"ng-template",null,1,D),i(),n(25,"div",20)(26,"button",21),g("click",function(){return u(s),_(o.fecharPreCadastros())}),a(27,"Fechar"),i()()()()()()}if(e&2){let s=k(24);l(9),d("ngIf",o.loading()),l(),d("ngIf",!o.loading()&&o.papel==="assessor"),l(),d("ngIf",!o.loading()&&(o.papel==="admin"||o.papel==="supervisor")),l(),d("ngIf",!o.loading()&&!(o.papel==="assessor"||o.papel==="admin"||o.papel==="supervisor")),l(7),h(" Pr\xE9-cadastros \u2014 ",o.selectedAssessorNome," "),l(3),d("ngIf",o.selectedPreCadastros==null?null:o.selectedPreCadastros.length)("ngIfElse",s)}},dependencies:[N,F,A,U],styles:[".form-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}.form-title[_ngcontent-%COMP%]{margin:0;font-size:1.6rem;font-weight:800;color:#006e37}.subtitle[_ngcontent-%COMP%]{font-size:.95rem;color:#555}.logo-img[_ngcontent-%COMP%]{height:60px;width:auto;display:block}@media (max-width: 576px){.logo-img[_ngcontent-%COMP%]{height:42px}.form-title[_ngcontent-%COMP%]{font-size:1.2rem}.subtitle[_ngcontent-%COMP%]{font-size:.8rem}}.card-crenorte[_ngcontent-%COMP%]{border-radius:14px}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{white-space:nowrap}.stat-tile[_ngcontent-%COMP%]{background:#f8faf9;border:1px solid #e5efe9;border-radius:12px;padding:12px}.stat-label[_ngcontent-%COMP%]{font-size:.8rem;color:#4b5563}.stat-value[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;color:#006e37}.bg-success-subtle[_ngcontent-%COMP%]{background:#d1fae5!important}.bg-secondary-subtle[_ngcontent-%COMP%]{background:#f3f4f6!important}.text-truncate[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.pc-card[_ngcontent-%COMP%]{border:1px solid rgba(0,0,0,.08);border-radius:14px;padding:14px;background:#fff;box-shadow:0 2px 10px #0000000a;transition:transform .15s ease,box-shadow .15s ease}.pc-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 24px #00000014}.pc-card__header[_ngcontent-%COMP%]{margin-bottom:10px}.pc-card__title[_ngcontent-%COMP%]{font-weight:700;line-height:1.2}.pc-card__body[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:8px}.pc-field[_ngcontent-%COMP%]{display:grid;grid-template-columns:96px 1fr;gap:8px;align-items:start}.pc-label[_ngcontent-%COMP%]{font-size:.8rem;color:#6c757d;white-space:nowrap}.pc-value[_ngcontent-%COMP%]{font-size:.95rem;font-weight:500}.pc-card__footer[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{min-width:120px}"]})};export{q as PreCadastroRelatorioComponent};
