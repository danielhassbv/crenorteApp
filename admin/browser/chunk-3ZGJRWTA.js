import{c as I,f as O,i as k,o as T,p as N,q as B,t as L}from"./chunk-WYCOUGZ3.js";import{j as G,k as A,l as R,w as D}from"./chunk-DTXGXR4A.js";import{Bb as S,Cb as P,Db as y,Ka as a,Ua as F,Za as _,fb as c,g as E,gb as v,ia as x,ib as i,ja as C,jb as o,kb as u,nb as M,qb as f,rb as m,xb as l,yb as b,zb as w}from"./chunk-2KT3GOAN.js";function j(r,e){r&1&&(i(0,"div",39),l(1,"Carregando grupos..."),o())}function z(r,e){if(r&1&&(i(0,"div",40),l(1),o()),r&2){let n=m();a(),b(n.erro)}}function Q(r,e){r&1&&u(0,"i",41)}function q(r,e){r&1&&u(0,"i",42)}function Y(r,e){r&1&&u(0,"i",41)}function H(r,e){r&1&&u(0,"i",42)}function J(r,e){if(r&1&&(i(0,"tr")(1,"td"),l(2),o(),i(3,"td",43),l(4),o(),i(5,"td")(6,"span",44),l(7),o()(),i(8,"td"),l(9),o(),i(10,"td")(11,"span",45),l(12),o()()()),r&2){let n=e.$implicit,t=e.index,s=m();a(2),b((s.paginaAtual-1)*s.porPagina+t+1),a(2),b(n.coordenadorNome||"\u2014"),a(3),b(s.maskCpf(n.coordenadorCpf)),a(2),b(s.toBRDate(n.criadoEm)),a(2),c("ngClass",s.statusClass(n.status)),a(),w(" ",s.statusLabel(n.status)," ")}}function K(r,e){r&1&&(i(0,"tr")(1,"td",46),l(2,"Nenhum grupo encontrado"),o()())}function U(r,e){if(r&1&&(i(0,"div",52),u(1,"i",55),l(2),o()),r&2){let n=m().$implicit,t=m();a(2),w(" ",t.toBRDate(n.criadoEm)," ")}}function X(r,e){if(r&1&&(i(0,"div",47)(1,"div",48)(2,"div",49)(3,"h6",50),l(4),o(),i(5,"span",51),l(6),o()(),i(7,"div",52),u(8,"i",53),i(9,"span",44),l(10),o()(),_(11,U,3,1,"div",54),o()()),r&2){let n=e.$implicit,t=m();a(4),b(n.coordenadorNome||"\u2014"),a(),c("ngClass",t.statusClass(n.status)),a(),w(" ",t.statusLabel(n.status)," "),a(4),b(t.maskCpf(n.coordenadorCpf)),a(),c("ngIf",n.criadoEm)}}function Z(r,e){r&1&&(i(0,"div",56),l(1," Nenhum grupo encontrado "),o())}function ee(r,e){if(r&1){let n=M();i(0,"li",59)(1,"button",60),f("click",function(){let s=x(n).$implicit,d=m(2);return C(d.irParaPagina(s))}),l(2),o()()}if(r&2){let n=e.$implicit,t=m(2);v("active",t.paginaAtual===n),a(2),b(n)}}function te(r,e){if(r&1){let n=M();i(0,"nav",57)(1,"ul",58)(2,"li",59)(3,"button",60),f("click",function(){x(n);let s=m();return C(s.irParaPagina(s.paginaAtual-1))}),l(4,"Anterior"),o()(),_(5,ee,3,3,"li",61),i(6,"li",59)(7,"button",60),f("click",function(){x(n);let s=m();return C(s.irParaPagina(s.paginaAtual+1))}),l(8,"Pr\xF3xima"),o()()()()}if(r&2){let n=m();a(2),v("disabled",n.paginaAtual===1),a(3),c("ngForOf",n.pages()),a(),v("disabled",n.paginaAtual===n.totalPaginas)}}var V=class r{carregando=!1;erro="";gruposAll=[];gruposFiltrados=[];gruposPaginados=[];filtro={nome:"",cpf:"",status:""};sortField="criadoEm";sortDir="desc";paginaAtual=1;porPagina=20;totalPaginas=1;ngOnInit(){return E(this,null,function*(){yield this.carregarTodos()})}statusLabel(e){return e==="aprovado_basa"?"Aprovado BASA":e==="reprovado_basa"?"Reprovado BASA":"Em QA"}statusClass(e){return e==="aprovado_basa"?"bg-success-subtle text-success border":e==="reprovado_basa"?"bg-danger-subtle text-danger border":"bg-warning-subtle text-warning border"}maskCpf(e){let n=(e||"").replace(/\D/g,"").slice(0,11);return n.length===11?n.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4"):e||""}toBRDate(e){let n=this.asDate(e);if(!n)return"\u2014";let t=String(n.getDate()).padStart(2,"0"),s=String(n.getMonth()+1).padStart(2,"0"),d=n.getFullYear();return`${t}/${s}/${d}`}carregarTodos(){return E(this,null,function*(){try{this.carregando=!0,this.erro="",this.gruposAll=[],this.aplicarFiltros(!0)}catch(e){console.error(e),this.erro="Falha ao carregar grupos."}finally{this.carregando=!1}})}aplicarFiltros(e=!1){let n=p=>(p||"").toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),""),t=n(this.filtro.nome),s=(this.filtro.cpf||"").replace(/\D/g,""),d=this.filtro.status,g=[...this.gruposAll];t&&(g=g.filter(p=>n(p.coordenadorNome||"").includes(t))),s&&(g=g.filter(p=>(p.coordenadorCpf||"").includes(s))),d&&(g=g.filter(p=>p.status===d)),this.gruposFiltrados=this.sortArray(g,this.sortField,this.sortDir),e&&(this.paginaAtual=1),this.recalcPaginacao()}ordenarPor(e){this.sortField===e?this.sortDir=this.sortDir==="asc"?"desc":"asc":(this.sortField=e,this.sortDir="asc"),this.gruposFiltrados=this.sortArray(this.gruposFiltrados,this.sortField,this.sortDir),this.recalcPaginacao()}sortArray(e,n,t){let s=t==="asc"?1:-1;return[...e].sort((d,g)=>{let p,h;if(n==="nome")p=(d.coordenadorNome||"").toLowerCase(),h=(g.coordenadorNome||"").toLowerCase();else{let W=this.asDate(d.criadoEm)?.getTime()??0,$=this.asDate(g.criadoEm)?.getTime()??0;p=W,h=$}return p<h?-1*s:p>h?1*s:0})}asDate(e){if(!e)return null;if(e instanceof Date)return e;if(typeof e=="object"&&typeof e.seconds=="number")return new Date(e.seconds*1e3);let n=new Date(e);return isNaN(n.getTime())?null:n}recalcPaginacao(){this.totalPaginas=Math.max(1,Math.ceil(this.gruposFiltrados.length/this.porPagina)),this.paginaAtual>this.totalPaginas&&(this.paginaAtual=this.totalPaginas);let e=(this.paginaAtual-1)*this.porPagina,n=e+this.porPagina;this.gruposPaginados=this.gruposFiltrados.slice(e,n)}irParaPagina(e){e<1||e>this.totalPaginas||e===this.paginaAtual||(this.paginaAtual=e,this.recalcPaginacao())}pages(){return Array.from({length:this.totalPaginas},(e,n)=>n+1)}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=F({type:r,selectors:[["app-grupos-relatorio"]],decls:65,vars:14,consts:[[1,"container","py-4","crn-page"],[1,"d-flex","flex-wrap","align-items-center","justify-content-between","gap-2","mb-3","crn-header"],[1,"mb-0","fw-bold","text-success"],[1,"bi","bi-clipboard-check","me-2"],[1,"d-flex","gap-2"],["routerLink","/grupos/novo",1,"btn","btn-outline-success"],[1,"bi","bi-people-fill","me-1"],[1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-arrow-clockwise","me-1"],[1,"crn-card","mb-3"],[1,"row","g-3","align-items-end"],[1,"col-md-4"],[1,"form-label","crn-label"],["placeholder","Buscar por nome",1,"form-control","crn-input",3,"ngModelChange","ngModel"],["placeholder","Somente d\xEDgitos ou parcial",1,"form-control","crn-input",3,"ngModelChange","ngModel"],[1,"col-md-3"],[1,"form-select","crn-input",3,"ngModelChange","ngModel"],["value",""],["value","em_qa"],["value","aprovado_basa"],["value","reprovado_basa"],["class","alert crn-alert-info py-2",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],[1,"crn-table-wrap","d-none","d-md-block"],[1,"table","crn-table","table-hover","align-middle","mb-0"],[1,"text-success"],[2,"width","48px"],[2,"cursor","pointer",3,"click"],[1,"d-inline-flex","align-items-center","gap-2"],["class","fa-solid fa-arrow-up",4,"ngIf"],["class","fa-solid fa-arrow-down",4,"ngIf"],[2,"cursor","pointer","width","180px",3,"click"],[2,"width","160px"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"d-block","d-md-none"],["class","mobile-card shadow-sm border rounded-4 p-3 mb-2",4,"ngFor","ngForOf"],["class","text-center text-muted py-4",4,"ngIf"],["class","mt-4",4,"ngIf"],[1,"alert","crn-alert-info","py-2"],[1,"alert","alert-warning"],[1,"fa-solid","fa-arrow-up"],[1,"fa-solid","fa-arrow-down"],[1,"fw-semibold","text-success-emphasis","text-truncate"],[1,"crn-cpf"],[1,"badge","badge-pill",3,"ngClass"],["colspan","5",1,"text-center","text-muted","py-4"],[1,"mobile-card","shadow-sm","border","rounded-4","p-3","mb-2"],[1,"d-flex","flex-column","gap-1"],[1,"d-flex","align-items-start","justify-content-between","header-row"],[1,"mb-1","fw-bold","text-success-emphasis","title-truncate"],[1,"badge","badge-pill","value-badge",3,"ngClass"],[1,"small","text-muted"],[1,"bi","bi-person-vcard","me-1"],["class","small text-muted",4,"ngIf"],[1,"bi","bi-calendar3","me-1"],[1,"text-center","text-muted","py-4"],[1,"mt-4"],[1,"pagination","justify-content-center","flex-wrap","gap-1"],[1,"page-item"],[1,"page-link",3,"click"],["class","page-item",3,"active",4,"ngFor","ngForOf"]],template:function(n,t){n&1&&(i(0,"div",0)(1,"div",1)(2,"h3",2),u(3,"i",3),l(4,"Relat\xF3rio de Grupos (QA) "),o(),i(5,"div",4)(6,"a",5),u(7,"i",6),l(8," Novo Grupo "),o(),i(9,"button",7),f("click",function(){return t.carregarTodos()}),u(10,"i",8),l(11," Recarregar "),o()()(),i(12,"div",9)(13,"div",10)(14,"div",11)(15,"label",12),l(16,"Coordenador (nome)"),o(),i(17,"input",13),y("ngModelChange",function(d){return P(t.filtro.nome,d)||(t.filtro.nome=d),d}),f("ngModelChange",function(){return t.aplicarFiltros(!0)}),o()(),i(18,"div",11)(19,"label",12),l(20,"CPF do coordenador"),o(),i(21,"input",14),y("ngModelChange",function(d){return P(t.filtro.cpf,d)||(t.filtro.cpf=d),d}),f("ngModelChange",function(){return t.aplicarFiltros(!0)}),o()(),i(22,"div",15)(23,"label",12),l(24,"Status"),o(),i(25,"select",16),y("ngModelChange",function(d){return P(t.filtro.status,d)||(t.filtro.status=d),d}),f("ngModelChange",function(){return t.aplicarFiltros(!0)}),i(26,"option",17),l(27,"Todos"),o(),i(28,"option",18),l(29,"Em QA"),o(),i(30,"option",19),l(31,"Aprovado BASA"),o(),i(32,"option",20),l(33,"Reprovado BASA"),o()()()()(),_(34,j,2,0,"div",21)(35,z,2,1,"div",22),i(36,"div",23)(37,"table",24)(38,"thead")(39,"tr",25)(40,"th",26),l(41,"#"),o(),i(42,"th",27),f("click",function(){return t.ordenarPor("nome")}),i(43,"div",28)(44,"span"),l(45,"Coordenador"),o(),_(46,Q,1,0,"i",29)(47,q,1,0,"i",30),o()(),i(48,"th"),l(49,"CPF Coordenador"),o(),i(50,"th",31),f("click",function(){return t.ordenarPor("criadoEm")}),i(51,"div",28)(52,"span"),l(53,"Criado em"),o(),_(54,Y,1,0,"i",29)(55,H,1,0,"i",30),o()(),i(56,"th",32),l(57,"Status"),o()()(),i(58,"tbody"),_(59,J,13,6,"tr",33)(60,K,3,0,"tr",34),o()()(),i(61,"div",35),_(62,X,12,5,"div",36)(63,Z,2,0,"div",37),o(),_(64,te,9,5,"nav",38),o()),n&2&&(a(17),S("ngModel",t.filtro.nome),a(4),S("ngModel",t.filtro.cpf),a(4),S("ngModel",t.filtro.status),a(9),c("ngIf",t.carregando),a(),c("ngIf",!t.carregando&&t.erro),a(11),c("ngIf",t.sortField==="nome"&&t.sortDir==="asc"),a(),c("ngIf",t.sortField==="nome"&&t.sortDir==="desc"),a(7),c("ngIf",t.sortField==="criadoEm"&&t.sortDir==="asc"),a(),c("ngIf",t.sortField==="criadoEm"&&t.sortDir==="desc"),a(4),c("ngForOf",t.gruposPaginados),a(),c("ngIf",!t.carregando&&t.gruposPaginados.length===0),a(2),c("ngForOf",t.gruposPaginados),a(),c("ngIf",!t.carregando&&t.gruposPaginados.length===0),a(),c("ngIf",!t.carregando&&t.totalPaginas>1))},dependencies:[D,G,A,R,L,N,B,I,T,O,k],styles:['[_nghost-%COMP%]{--crn-green: #006e37;--crn-green-soft: #eaf6f0;--crn-border: #e7edf0;--shadow-sm: 0 6px 18px rgba(0,0,0,.06);--shadow-md: 0 10px 26px rgba(0,0,0,.1)}.crn-card[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--crn-border);border-radius:16px;box-shadow:var(--shadow-sm);padding:16px;position:relative}.crn-card[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;background:linear-gradient(90deg,var(--crn-green),var(--crn-green)) top left/100% 4px no-repeat;border-radius:16px}.crn-table-wrap[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--crn-border);border-radius:18px;box-shadow:var(--shadow-md);overflow:hidden}.crn-table[_ngcontent-%COMP%]{table-layout:fixed;width:100%;margin:0}.crn-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background:#f2fbf7;box-shadow:inset 0 -1px 0 var(--crn-border);position:sticky;top:0;z-index:1}.crn-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border:none;padding:.85rem .9rem;font-size:.78rem;letter-spacing:.08em;text-transform:uppercase;font-weight:900;color:#2a3f36}.crn-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-color:var(--crn-border)!important;padding:.85rem .9rem;color:#14221c;font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.crn-cpf[_ngcontent-%COMP%]{display:inline-block;background:#f5f7f6;border:1px solid var(--crn-border);padding:.28rem .55rem;border-radius:10px;font-family:ui-monospace,SFMono-Regular,Menlo,monospace;color:#213a31}.badge-pill[_ngcontent-%COMP%]{border-radius:999px;padding:.4rem .7rem;font-weight:800}.mobile-card[_ngcontent-%COMP%]{overflow:hidden}.mobile-card[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{min-width:0}.header-row[_ngcontent-%COMP%]{gap:8px;flex-wrap:wrap}.title-truncate[_ngcontent-%COMP%]{flex:1 1 auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.value-badge[_ngcontent-%COMP%]{flex:0 0 auto;white-space:nowrap;margin-left:auto}.crn-alert-info[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--crn-border);color:#335a4b;border-radius:12px}']})};export{V as GruposRelatorioComponent};
