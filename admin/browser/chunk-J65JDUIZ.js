import{A as c,i as h,l as v,m as w,n as P,o as g,p as C,q as D,s as y,v as i,w as O}from"./chunk-FDAITWFV.js";import{R as b,W as f,a as u,aa as l,b as p,g as o,u as m,z as t}from"./chunk-2KT3GOAN.js";var R=class s{auth=l(h);db=l(D);firebaseUser$=v(this.auth);perfil$=this.firebaseUser$.pipe(b(a=>{if(!a?.uid)return m(null);let r=i(this.db,"colaboradores",a.uid);return y(r).pipe(t(e=>e??null))}));papel$=this.perfil$.pipe(t(a=>a?.papel??null));login(a,r){return o(this,null,function*(){yield g(this.auth,a,r),yield this.garantirPerfilMinimo()})}logout(){return o(this,null,function*(){yield C(this.auth)})}resetSenha(a){return o(this,null,function*(){yield P(this.auth,a)})}criarColaborador(a,r,e){return o(this,null,function*(){let n=(yield w(this.auth,a,r)).user.uid,U=i(this.db,"colaboradores",n),$=p(u({uid:n},e),{status:e.status??"ativo",criadoEm:Date.now()});return yield c(U,$),n})}temPapel$(a){return this.papel$.pipe(t(r=>!!r&&a.includes(r)))}garantirPerfilMinimo(){return o(this,null,function*(){let a=this.auth.currentUser;if(!a)return;let r=i(this.db,"colaboradores",a.uid);if(!(yield O(r)).exists()){let d={uid:a.uid,nome:a.displayName??a.email??"Usu\xE1rio",email:a.email??"",papel:"assessor",status:"ativo",cpf:null,photoURL:a.photoURL??null,criadoEm:Date.now()};yield c(r,d)}})}static \u0275fac=function(r){return new(r||s)};static \u0275prov=f({token:s,factory:s.\u0275fac,providedIn:"root"})};export{R as a};
