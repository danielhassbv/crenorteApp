import{a as yt,b as xr,f as hh,g as V}from"./chunk-2KT3GOAN.js";var dh=()=>{};var ph=function(r){let t=[],e=0;for(let n=0;n<r.length;n++){let s=r.charCodeAt(n);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(s=65536+((s&1023)<<10)+(r.charCodeAt(++n)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},bp=function(r){let t=[],e=0,n=0;for(;e<r.length;){let s=r[e++];if(s<128)t[n++]=String.fromCharCode(s);else if(s>191&&s<224){let i=r[e++];t[n++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){let i=r[e++],a=r[e++],c=r[e++],l=((s&7)<<18|(i&63)<<12|(a&63)<<6|c&63)-65536;t[n++]=String.fromCharCode(55296+(l>>10)),t[n++]=String.fromCharCode(56320+(l&1023))}else{let i=r[e++],a=r[e++];t[n++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return t.join("")},gh={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,t){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();let e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let s=0;s<r.length;s+=3){let i=r[s],a=s+1<r.length,c=a?r[s+1]:0,l=s+2<r.length,d=l?r[s+2]:0,m=i>>2,p=(i&3)<<4|c>>4,y=(c&15)<<2|d>>6,S=d&63;l||(S=64,a||(y=64)),n.push(e[m],e[p],e[y],e[S])}return n.join("")},encodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(r):this.encodeByteArray(ph(r),t)},decodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(r):bp(this.decodeStringToByteArray(r,t))},decodeStringToByteArray(r,t){this.init_();let e=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let s=0;s<r.length;){let i=e[r.charAt(s++)],c=s<r.length?e[r.charAt(s)]:0;++s;let d=s<r.length?e[r.charAt(s)]:64;++s;let p=s<r.length?e[r.charAt(s)]:64;if(++s,i==null||c==null||d==null||p==null)throw new Yo;let y=i<<2|c>>4;if(n.push(y),d!==64){let S=c<<4&240|d>>2;if(n.push(S),p!==64){let C=d<<6&192|p;n.push(C)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}},Yo=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Sp=function(r){let t=ph(r);return gh.encodeByteArray(t,!0)},kr=function(r){return Sp(r).replace(/\./g,"")},yh=function(r){try{return gh.decodeString(r,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function ta(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Rp=()=>ta().__FIREBASE_DEFAULTS__,Pp=()=>{if(typeof process>"u"||typeof process.env>"u")return;let r=process.env.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},Cp=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let t=r&&yh(r[1]);return t&&JSON.parse(t)},Qs=()=>{try{return dh()||Rp()||Pp()||Cp()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},Dp=r=>Qs()?.emulatorHosts?.[r],_h=r=>{let t=Dp(r);if(!t)return;let e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);let n=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),n]:[t.substring(0,e),n]},ea=()=>Qs()?.config,cw=r=>Qs()?.[`_${r}`];var Ks=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,n))}}};function Ws(r){try{return(r.startsWith("http://")||r.startsWith("https://")?new URL(r).hostname:r).endsWith(".cloudworkstations.dev")}catch{return!1}}function wh(r){return V(this,null,function*(){return(yield fetch(r,{credentials:"include"})).ok})}function Eh(r,t){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let e={alg:"none",type:"JWT"},n=t||"demo-project",s=r.iat||0,i=r.sub||r.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=yt({iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},r);return[kr(JSON.stringify(e)),kr(JSON.stringify(a)),""].join(".")}var Nr={};function Vp(){let r={prod:[],emulator:[]};for(let t of Object.keys(Nr))Nr[t]?r.emulator.push(t):r.prod.push(t);return r}function xp(r){let t=document.getElementById(r),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",r),e=!0),{created:e,element:t}}var fh=!1;function Ih(r,t){if(typeof window>"u"||typeof document>"u"||!Ws(window.location.host)||Nr[r]===t||Nr[r]||fh)return;Nr[r]=t;function e(y){return`__firebase__banner__${y}`}let n="__firebase__banner",i=Vp().prod.length>0;function a(){let y=document.getElementById(n);y&&y.remove()}function c(y){y.style.display="flex",y.style.background="#7faaf0",y.style.position="fixed",y.style.bottom="5px",y.style.left="5px",y.style.padding=".5em",y.style.borderRadius="5px",y.style.alignItems="center"}function l(y,S){y.setAttribute("width","24"),y.setAttribute("id",S),y.setAttribute("height","24"),y.setAttribute("viewBox","0 0 24 24"),y.setAttribute("fill","none"),y.style.marginLeft="-6px"}function d(){let y=document.createElement("span");return y.style.cursor="pointer",y.style.marginLeft="16px",y.style.fontSize="24px",y.innerHTML=" &times;",y.onclick=()=>{fh=!0,a()},y}function m(y,S){y.setAttribute("id",S),y.innerText="Learn more",y.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",y.setAttribute("target","__blank"),y.style.paddingLeft="5px",y.style.textDecoration="underline"}function p(){let y=xp(n),S=e("text"),C=document.getElementById(S)||document.createElement("span"),k=e("learnmore"),D=document.getElementById(k)||document.createElement("a"),G=e("preprendIcon"),q=document.getElementById(G)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(y.created){let B=y.element;c(B),m(D,k);let X=d();l(q,G),B.append(q,C,D,X),document.body.appendChild(B)}i?(C.innerText="Preview backend disconnected.",q.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(q.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,C.innerText="Preview backend running in this workspace."),C.setAttribute("id",S)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}function je(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function uw(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(je())}function vh(){let r=Qs()?.forceEnvironment;if(r==="node")return!0;if(r==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function lw(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function hw(){let r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function dw(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function fw(){let r=je();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function na(){return!vh()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ra(){return!vh()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Hs(){try{return typeof indexedDB=="object"}catch{return!1}}function Th(){return new Promise((r,t)=>{try{let e=!0,n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(n),r(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(e){t(e)}})}var Np="FirebaseError",re=class r extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name=Np,Object.setPrototypeOf(this,r.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Or.prototype.create)}},Or=class{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){let n=e[0]||{},s=`${this.service}/${t}`,i=this.errors[t],a=i?kp(i,n):"Error",c=`${this.serviceName}: ${a} (${s}).`;return new re(s,c,n)}};function kp(r,t){return r.replace(Op,(e,n)=>{let s=t[n];return s!=null?String(s):`<${n}?>`})}var Op=/\{\$([^}]+)}/g;function mw(r){for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}function An(r,t){if(r===t)return!0;let e=Object.keys(r),n=Object.keys(t);for(let s of e){if(!n.includes(s))return!1;let i=r[s],a=t[s];if(mh(i)&&mh(a)){if(!An(i,a))return!1}else if(i!==a)return!1}for(let s of n)if(!e.includes(s))return!1;return!0}function mh(r){return r!==null&&typeof r=="object"}function pw(r){let t=[];for(let[e,n]of Object.entries(r))Array.isArray(n)?n.forEach(s=>{t.push(encodeURIComponent(e)+"="+encodeURIComponent(s))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function gw(r){let t={};return r.replace(/^\?/,"").split("&").forEach(n=>{if(n){let[s,i]=n.split("=");t[decodeURIComponent(s)]=decodeURIComponent(i)}}),t}function yw(r){let t=r.indexOf("?");if(!t)return"";let e=r.indexOf("#",t);return r.substring(t,e>0?e:void 0)}function _w(r,t){let e=new Zo(r,t);return e.subscribe.bind(e)}var Zo=class{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(()=>{t(this)}).catch(n=>{this.error(n)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,e,n){let s;if(t===void 0&&e===void 0&&n===void 0)throw new Error("Missing Observer.");Mp(t,["next","error","complete"])?s=t:s={next:t,error:e,complete:n},s.next===void 0&&(s.next=Xo),s.error===void 0&&(s.error=Xo),s.complete===void 0&&(s.complete=Xo);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{e(this.observers[t])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function Mp(r,t){if(typeof r!="object"||r===null)return!1;for(let e of t)if(e in r&&typeof r[e]=="function")return!0;return!1}function Xo(){}var ww=4*60*60*1e3;function xt(r){return r&&r._delegate?r._delegate:r}var se=class{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}};var ze="[DEFAULT]";var sa=class{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){let e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){let n=new Ks;if(this.instancesDeferred.set(e,n),this.isInitialized(e)||this.shouldAutoInitialize())try{let s=this.getOrInitializeService({instanceIdentifier:e});s&&n.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){let e=this.normalizeInstanceIdentifier(t?.identifier),n=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(s){if(n)return null;throw s}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Lp(t))try{this.getOrInitializeService({instanceIdentifier:ze})}catch{}for(let[e,n]of this.instancesDeferred.entries()){let s=this.normalizeInstanceIdentifier(e);try{let i=this.getOrInitializeService({instanceIdentifier:s});n.resolve(i)}catch{}}}}clearInstance(t=ze){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}delete(){return V(this,null,function*(){let t=Array.from(this.instances.values());yield Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])})}isComponentSet(){return this.component!=null}isInitialized(t=ze){return this.instances.has(t)}getOptions(t=ze){return this.instancesOptions.get(t)||{}}initialize(t={}){let{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let s=this.getOrInitializeService({instanceIdentifier:n,options:e});for(let[i,a]of this.instancesDeferred.entries()){let c=this.normalizeInstanceIdentifier(i);n===c&&a.resolve(s)}return s}onInit(t,e){let n=this.normalizeInstanceIdentifier(e),s=this.onInitCallbacks.get(n)??new Set;s.add(t),this.onInitCallbacks.set(n,s);let i=this.instances.get(n);return i&&t(i,n),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){let n=this.onInitCallbacks.get(e);if(n)for(let s of n)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:Fp(t),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch{}return n||null}normalizeInstanceIdentifier(t=ze){return this.component?this.component.multipleInstances?t:ze:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Fp(r){return r===ze?void 0:r}function Lp(r){return r.instantiationMode==="EAGER"}var Js=class{constructor(t){this.name=t,this.providers=new Map}addComponent(t){let e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);let e=new sa(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}};var Bp=[],Q=function(r){return r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT",r}(Q||{}),Up={debug:Q.DEBUG,verbose:Q.VERBOSE,info:Q.INFO,warn:Q.WARN,error:Q.ERROR,silent:Q.SILENT},qp=Q.INFO,jp={[Q.DEBUG]:"log",[Q.VERBOSE]:"log",[Q.INFO]:"info",[Q.WARN]:"warn",[Q.ERROR]:"error"},zp=(r,t,...e)=>{if(t<r.logLevel)return;let n=new Date().toISOString(),s=jp[t];if(s)console[s](`[${n}]  ${r.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)},bn=class{constructor(t){this.name=t,this._logLevel=qp,this._logHandler=zp,this._userLogHandler=null,Bp.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Q))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Up[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Q.DEBUG,...t),this._logHandler(this,Q.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Q.VERBOSE,...t),this._logHandler(this,Q.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Q.INFO,...t),this._logHandler(this,Q.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Q.WARN,...t),this._logHandler(this,Q.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Q.ERROR,...t),this._logHandler(this,Q.ERROR,...t)}};var Gp=(r,t)=>t.some(e=>r instanceof e),Ah,bh;function $p(){return Ah||(Ah=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Kp(){return bh||(bh=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Sh=new WeakMap,oa=new WeakMap,Rh=new WeakMap,ia=new WeakMap,ca=new WeakMap;function Qp(r){let t=new Promise((e,n)=>{let s=()=>{r.removeEventListener("success",i),r.removeEventListener("error",a)},i=()=>{e(Qt(r.result)),s()},a=()=>{n(r.error),s()};r.addEventListener("success",i),r.addEventListener("error",a)});return t.then(e=>{e instanceof IDBCursor&&Sh.set(e,r)}).catch(()=>{}),ca.set(t,r),t}function Wp(r){if(oa.has(r))return;let t=new Promise((e,n)=>{let s=()=>{r.removeEventListener("complete",i),r.removeEventListener("error",a),r.removeEventListener("abort",a)},i=()=>{e(),s()},a=()=>{n(r.error||new DOMException("AbortError","AbortError")),s()};r.addEventListener("complete",i),r.addEventListener("error",a),r.addEventListener("abort",a)});oa.set(r,t)}var aa={get(r,t,e){if(r instanceof IDBTransaction){if(t==="done")return oa.get(r);if(t==="objectStoreNames")return r.objectStoreNames||Rh.get(r);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Qt(r[t])},set(r,t,e){return r[t]=e,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function Ph(r){aa=r(aa)}function Hp(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){let n=r.call(Xs(this),t,...e);return Rh.set(n,t.sort?t.sort():[t]),Qt(n)}:Kp().includes(r)?function(...t){return r.apply(Xs(this),t),Qt(Sh.get(this))}:function(...t){return Qt(r.apply(Xs(this),t))}}function Jp(r){return typeof r=="function"?Hp(r):(r instanceof IDBTransaction&&Wp(r),Gp(r,$p())?new Proxy(r,aa):r)}function Qt(r){if(r instanceof IDBRequest)return Qp(r);if(ia.has(r))return ia.get(r);let t=Jp(r);return t!==r&&(ia.set(r,t),ca.set(t,r)),t}var Xs=r=>ca.get(r);function Dh(r,t,{blocked:e,upgrade:n,blocking:s,terminated:i}={}){let a=indexedDB.open(r,t),c=Qt(a);return n&&a.addEventListener("upgradeneeded",l=>{n(Qt(a.result),l.oldVersion,l.newVersion,Qt(a.transaction),l)}),e&&a.addEventListener("blocked",l=>e(l.oldVersion,l.newVersion,l)),c.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}var Xp=["get","getKey","getAll","getAllKeys","count"],Yp=["put","add","delete","clear"],ua=new Map;function Ch(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(ua.get(t))return ua.get(t);let e=t.replace(/FromIndex$/,""),n=t!==e,s=Yp.includes(e);if(!(e in(n?IDBIndex:IDBObjectStore).prototype)||!(s||Xp.includes(e)))return;let i=function(a,...c){return V(this,null,function*(){let l=this.transaction(a,s?"readwrite":"readonly"),d=l.store;return n&&(d=d.index(c.shift())),(yield Promise.all([d[e](...c),s&&l.done]))[0]})};return ua.set(t,i),i}Ph(r=>xr(yt({},r),{get:(t,e,n)=>Ch(t,e)||r.get(t,e,n),has:(t,e)=>!!Ch(t,e)||r.has(t,e)}));var ha=class{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(Zp(e)){let n=e.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(e=>e).join(" ")}};function Zp(r){return r.getComponent()?.type==="VERSION"}var da="@firebase/app",Vh="0.14.1";var ie=new bn("@firebase/app"),tg="@firebase/app-compat",eg="@firebase/analytics-compat",ng="@firebase/analytics",rg="@firebase/app-check-compat",sg="@firebase/app-check",ig="@firebase/auth",og="@firebase/auth-compat",ag="@firebase/database",cg="@firebase/data-connect",ug="@firebase/database-compat",lg="@firebase/functions",hg="@firebase/functions-compat",dg="@firebase/installations",fg="@firebase/installations-compat",mg="@firebase/messaging",pg="@firebase/messaging-compat",gg="@firebase/performance",yg="@firebase/performance-compat",_g="@firebase/remote-config",wg="@firebase/remote-config-compat",Eg="@firebase/storage",Ig="@firebase/storage-compat",vg="@firebase/firestore",Tg="@firebase/ai",Ag="@firebase/firestore-compat",bg="firebase",Sg="12.1.0";var fa="[DEFAULT]",Rg={[da]:"fire-core",[tg]:"fire-core-compat",[ng]:"fire-analytics",[eg]:"fire-analytics-compat",[sg]:"fire-app-check",[rg]:"fire-app-check-compat",[ig]:"fire-auth",[og]:"fire-auth-compat",[ag]:"fire-rtdb",[cg]:"fire-data-connect",[ug]:"fire-rtdb-compat",[lg]:"fire-fn",[hg]:"fire-fn-compat",[dg]:"fire-iid",[fg]:"fire-iid-compat",[mg]:"fire-fcm",[pg]:"fire-fcm-compat",[gg]:"fire-perf",[yg]:"fire-perf-compat",[_g]:"fire-rc",[wg]:"fire-rc-compat",[Eg]:"fire-gcs",[Ig]:"fire-gcs-compat",[vg]:"fire-fst",[Ag]:"fire-fst-compat",[Tg]:"fire-vertex","fire-js":"fire-js",[bg]:"fire-js-all"};var Mr=new Map,Pg=new Map,ma=new Map;function xh(r,t){try{r.container.addComponent(t)}catch(e){ie.debug(`Component ${t.name} failed to register with FirebaseApp ${r.name}`,e)}}function Fr(r){let t=r.name;if(ma.has(t))return ie.debug(`There were multiple attempts to register component ${t}.`),!1;ma.set(t,r);for(let e of Mr.values())xh(e,r);for(let e of Pg.values())xh(e,r);return!0}function Mh(r,t){let e=r.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),r.container.getProvider(t)}function Fh(r){return r==null?!1:r.settings!==void 0}var Cg={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ge=new Or("app","Firebase",Cg);var pa=class{constructor(t,e,n){this._isDeleted=!1,this._options=yt({},t),this._config=yt({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new se("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ge.create("app-deleted",{appName:this._name})}};var Lh=Sg;function Dg(r,t={}){let e=r;typeof t!="object"&&(t={name:t});let n=yt({name:fa,automaticDataCollectionEnabled:!0},t),s=n.name;if(typeof s!="string"||!s)throw ge.create("bad-app-name",{appName:String(s)});if(e||(e=ea()),!e)throw ge.create("no-options");let i=Mr.get(s);if(i){if(An(e,i.options)&&An(n,i.config))return i;throw ge.create("duplicate-app",{appName:s})}let a=new Js(s);for(let l of ma.values())a.addComponent(l);let c=new pa(e,n,a);return Mr.set(s,c),c}function Bh(r=fa){let t=Mr.get(r);if(!t&&r===fa&&ea())return Dg();if(!t)throw ge.create("no-app",{appName:r});return t}function Bw(){return Array.from(Mr.values())}function ye(r,t,e){let n=Rg[r]??r;e&&(n+=`-${e}`);let s=n.match(/\s|\//),i=t.match(/\s|\//);if(s||i){let a=[`Unable to register library "${n}" with version "${t}":`];s&&a.push(`library name "${n}" contains illegal characters (whitespace or "/")`),s&&i&&a.push("and"),i&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),ie.warn(a.join(" "));return}Fr(new se(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}var Vg="firebase-heartbeat-database",xg=1,Lr="firebase-heartbeat-store",la=null;function Uh(){return la||(la=Dh(Vg,xg,{upgrade:(r,t)=>{switch(t){case 0:try{r.createObjectStore(Lr)}catch(e){console.warn(e)}}}}).catch(r=>{throw ge.create("idb-open",{originalErrorMessage:r.message})})),la}function Ng(r){return V(this,null,function*(){try{let e=(yield Uh()).transaction(Lr),n=yield e.objectStore(Lr).get(qh(r));return yield e.done,n}catch(t){if(t instanceof re)ie.warn(t.message);else{let e=ge.create("idb-get",{originalErrorMessage:t?.message});ie.warn(e.message)}}})}function Nh(r,t){return V(this,null,function*(){try{let n=(yield Uh()).transaction(Lr,"readwrite");yield n.objectStore(Lr).put(t,qh(r)),yield n.done}catch(e){if(e instanceof re)ie.warn(e.message);else{let n=ge.create("idb-set",{originalErrorMessage:e?.message});ie.warn(n.message)}}})}function qh(r){return`${r.name}!${r.options.appId}`}var kg=1024,Og=30,ga=class{constructor(t){this.container=t,this._heartbeatsCache=null;let e=this.container.getProvider("app").getImmediate();this._storage=new ya(e),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}triggerHeartbeat(){return V(this,null,function*(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=kh();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(s=>s.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:e}),this._heartbeatsCache.heartbeats.length>Og){let s=Fg(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){ie.warn(t)}})}getHeartbeatsHeader(){return V(this,null,function*(){try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=kh(),{heartbeatsToSend:e,unsentEntries:n}=Mg(this._heartbeatsCache.heartbeats),s=kr(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return ie.warn(t),""}})}};function kh(){return new Date().toISOString().substring(0,10)}function Mg(r,t=kg){let e=[],n=r.slice();for(let s of r){let i=e.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),Oh(e)>t){i.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),Oh(e)>t){e.pop();break}n=n.slice(1)}return{heartbeatsToSend:e,unsentEntries:n}}var ya=class{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return V(this,null,function*(){return Hs()?Th().then(()=>!0).catch(()=>!1):!1})}read(){return V(this,null,function*(){if(yield this._canUseIndexedDBPromise){let e=yield Ng(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(t){return V(this,null,function*(){if(yield this._canUseIndexedDBPromise){let n=yield this.read();return Nh(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return})}add(t){return V(this,null,function*(){if(yield this._canUseIndexedDBPromise){let n=yield this.read();return Nh(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}else return})}};function Oh(r){return kr(JSON.stringify({version:2,heartbeats:r})).length}function Fg(r){if(r.length===0)return-1;let t=0,e=r[0].date;for(let n=1;n<r.length;n++)r[n].date<e&&(e=r[n].date,t=n);return t}function Lg(r){Fr(new se("platform-logger",t=>new ha(t),"PRIVATE")),Fr(new se("heartbeat",t=>new ga(t),"PRIVATE")),ye(da,Vh,r),ye(da,Vh,"esm2020"),ye("fire-js","")}Lg("");var jh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},zh={};var oe,_a;(function(){var r;function t(E,g){function w(){}w.prototype=g.prototype,E.D=g.prototype,E.prototype=new w,E.prototype.constructor=E,E.C=function(I,v,A){for(var _=Array(arguments.length-2),te=2;te<arguments.length;te++)_[te-2]=arguments[te];return g.prototype[v].apply(I,_)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(n,e),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(E,g,w){w||(w=0);var I=Array(16);if(typeof g=="string")for(var v=0;16>v;++v)I[v]=g.charCodeAt(w++)|g.charCodeAt(w++)<<8|g.charCodeAt(w++)<<16|g.charCodeAt(w++)<<24;else for(v=0;16>v;++v)I[v]=g[w++]|g[w++]<<8|g[w++]<<16|g[w++]<<24;g=E.g[0],w=E.g[1],v=E.g[2];var A=E.g[3],_=g+(A^w&(v^A))+I[0]+3614090360&4294967295;g=w+(_<<7&4294967295|_>>>25),_=A+(v^g&(w^v))+I[1]+3905402710&4294967295,A=g+(_<<12&4294967295|_>>>20),_=v+(w^A&(g^w))+I[2]+606105819&4294967295,v=A+(_<<17&4294967295|_>>>15),_=w+(g^v&(A^g))+I[3]+3250441966&4294967295,w=v+(_<<22&4294967295|_>>>10),_=g+(A^w&(v^A))+I[4]+4118548399&4294967295,g=w+(_<<7&4294967295|_>>>25),_=A+(v^g&(w^v))+I[5]+1200080426&4294967295,A=g+(_<<12&4294967295|_>>>20),_=v+(w^A&(g^w))+I[6]+2821735955&4294967295,v=A+(_<<17&4294967295|_>>>15),_=w+(g^v&(A^g))+I[7]+4249261313&4294967295,w=v+(_<<22&4294967295|_>>>10),_=g+(A^w&(v^A))+I[8]+1770035416&4294967295,g=w+(_<<7&4294967295|_>>>25),_=A+(v^g&(w^v))+I[9]+2336552879&4294967295,A=g+(_<<12&4294967295|_>>>20),_=v+(w^A&(g^w))+I[10]+4294925233&4294967295,v=A+(_<<17&4294967295|_>>>15),_=w+(g^v&(A^g))+I[11]+2304563134&4294967295,w=v+(_<<22&4294967295|_>>>10),_=g+(A^w&(v^A))+I[12]+1804603682&4294967295,g=w+(_<<7&4294967295|_>>>25),_=A+(v^g&(w^v))+I[13]+4254626195&4294967295,A=g+(_<<12&4294967295|_>>>20),_=v+(w^A&(g^w))+I[14]+2792965006&4294967295,v=A+(_<<17&4294967295|_>>>15),_=w+(g^v&(A^g))+I[15]+1236535329&4294967295,w=v+(_<<22&4294967295|_>>>10),_=g+(v^A&(w^v))+I[1]+4129170786&4294967295,g=w+(_<<5&4294967295|_>>>27),_=A+(w^v&(g^w))+I[6]+3225465664&4294967295,A=g+(_<<9&4294967295|_>>>23),_=v+(g^w&(A^g))+I[11]+643717713&4294967295,v=A+(_<<14&4294967295|_>>>18),_=w+(A^g&(v^A))+I[0]+3921069994&4294967295,w=v+(_<<20&4294967295|_>>>12),_=g+(v^A&(w^v))+I[5]+3593408605&4294967295,g=w+(_<<5&4294967295|_>>>27),_=A+(w^v&(g^w))+I[10]+38016083&4294967295,A=g+(_<<9&4294967295|_>>>23),_=v+(g^w&(A^g))+I[15]+3634488961&4294967295,v=A+(_<<14&4294967295|_>>>18),_=w+(A^g&(v^A))+I[4]+3889429448&4294967295,w=v+(_<<20&4294967295|_>>>12),_=g+(v^A&(w^v))+I[9]+568446438&4294967295,g=w+(_<<5&4294967295|_>>>27),_=A+(w^v&(g^w))+I[14]+3275163606&4294967295,A=g+(_<<9&4294967295|_>>>23),_=v+(g^w&(A^g))+I[3]+4107603335&4294967295,v=A+(_<<14&4294967295|_>>>18),_=w+(A^g&(v^A))+I[8]+1163531501&4294967295,w=v+(_<<20&4294967295|_>>>12),_=g+(v^A&(w^v))+I[13]+2850285829&4294967295,g=w+(_<<5&4294967295|_>>>27),_=A+(w^v&(g^w))+I[2]+4243563512&4294967295,A=g+(_<<9&4294967295|_>>>23),_=v+(g^w&(A^g))+I[7]+1735328473&4294967295,v=A+(_<<14&4294967295|_>>>18),_=w+(A^g&(v^A))+I[12]+2368359562&4294967295,w=v+(_<<20&4294967295|_>>>12),_=g+(w^v^A)+I[5]+4294588738&4294967295,g=w+(_<<4&4294967295|_>>>28),_=A+(g^w^v)+I[8]+2272392833&4294967295,A=g+(_<<11&4294967295|_>>>21),_=v+(A^g^w)+I[11]+1839030562&4294967295,v=A+(_<<16&4294967295|_>>>16),_=w+(v^A^g)+I[14]+4259657740&4294967295,w=v+(_<<23&4294967295|_>>>9),_=g+(w^v^A)+I[1]+2763975236&4294967295,g=w+(_<<4&4294967295|_>>>28),_=A+(g^w^v)+I[4]+1272893353&4294967295,A=g+(_<<11&4294967295|_>>>21),_=v+(A^g^w)+I[7]+4139469664&4294967295,v=A+(_<<16&4294967295|_>>>16),_=w+(v^A^g)+I[10]+3200236656&4294967295,w=v+(_<<23&4294967295|_>>>9),_=g+(w^v^A)+I[13]+681279174&4294967295,g=w+(_<<4&4294967295|_>>>28),_=A+(g^w^v)+I[0]+3936430074&4294967295,A=g+(_<<11&4294967295|_>>>21),_=v+(A^g^w)+I[3]+3572445317&4294967295,v=A+(_<<16&4294967295|_>>>16),_=w+(v^A^g)+I[6]+76029189&4294967295,w=v+(_<<23&4294967295|_>>>9),_=g+(w^v^A)+I[9]+3654602809&4294967295,g=w+(_<<4&4294967295|_>>>28),_=A+(g^w^v)+I[12]+3873151461&4294967295,A=g+(_<<11&4294967295|_>>>21),_=v+(A^g^w)+I[15]+530742520&4294967295,v=A+(_<<16&4294967295|_>>>16),_=w+(v^A^g)+I[2]+3299628645&4294967295,w=v+(_<<23&4294967295|_>>>9),_=g+(v^(w|~A))+I[0]+4096336452&4294967295,g=w+(_<<6&4294967295|_>>>26),_=A+(w^(g|~v))+I[7]+1126891415&4294967295,A=g+(_<<10&4294967295|_>>>22),_=v+(g^(A|~w))+I[14]+2878612391&4294967295,v=A+(_<<15&4294967295|_>>>17),_=w+(A^(v|~g))+I[5]+4237533241&4294967295,w=v+(_<<21&4294967295|_>>>11),_=g+(v^(w|~A))+I[12]+1700485571&4294967295,g=w+(_<<6&4294967295|_>>>26),_=A+(w^(g|~v))+I[3]+2399980690&4294967295,A=g+(_<<10&4294967295|_>>>22),_=v+(g^(A|~w))+I[10]+4293915773&4294967295,v=A+(_<<15&4294967295|_>>>17),_=w+(A^(v|~g))+I[1]+2240044497&4294967295,w=v+(_<<21&4294967295|_>>>11),_=g+(v^(w|~A))+I[8]+1873313359&4294967295,g=w+(_<<6&4294967295|_>>>26),_=A+(w^(g|~v))+I[15]+4264355552&4294967295,A=g+(_<<10&4294967295|_>>>22),_=v+(g^(A|~w))+I[6]+2734768916&4294967295,v=A+(_<<15&4294967295|_>>>17),_=w+(A^(v|~g))+I[13]+1309151649&4294967295,w=v+(_<<21&4294967295|_>>>11),_=g+(v^(w|~A))+I[4]+4149444226&4294967295,g=w+(_<<6&4294967295|_>>>26),_=A+(w^(g|~v))+I[11]+3174756917&4294967295,A=g+(_<<10&4294967295|_>>>22),_=v+(g^(A|~w))+I[2]+718787259&4294967295,v=A+(_<<15&4294967295|_>>>17),_=w+(A^(v|~g))+I[9]+3951481745&4294967295,E.g[0]=E.g[0]+g&4294967295,E.g[1]=E.g[1]+(v+(_<<21&4294967295|_>>>11))&4294967295,E.g[2]=E.g[2]+v&4294967295,E.g[3]=E.g[3]+A&4294967295}n.prototype.u=function(E,g){g===void 0&&(g=E.length);for(var w=g-this.blockSize,I=this.B,v=this.h,A=0;A<g;){if(v==0)for(;A<=w;)s(this,E,A),A+=this.blockSize;if(typeof E=="string"){for(;A<g;)if(I[v++]=E.charCodeAt(A++),v==this.blockSize){s(this,I),v=0;break}}else for(;A<g;)if(I[v++]=E[A++],v==this.blockSize){s(this,I),v=0;break}}this.h=v,this.o+=g},n.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var g=1;g<E.length-8;++g)E[g]=0;var w=8*this.o;for(g=E.length-8;g<E.length;++g)E[g]=w&255,w/=256;for(this.u(E),E=Array(16),g=w=0;4>g;++g)for(var I=0;32>I;I+=8)E[w++]=this.g[g]>>>I&255;return E};function i(E,g){var w=c;return Object.prototype.hasOwnProperty.call(w,E)?w[E]:w[E]=g(E)}function a(E,g){this.h=g;for(var w=[],I=!0,v=E.length-1;0<=v;v--){var A=E[v]|0;I&&A==g||(w[v]=A,I=!1)}this.g=w}var c={};function l(E){return-128<=E&&128>E?i(E,function(g){return new a([g|0],0>g?-1:0)}):new a([E|0],0>E?-1:0)}function d(E){if(isNaN(E)||!isFinite(E))return p;if(0>E)return D(d(-E));for(var g=[],w=1,I=0;E>=w;I++)g[I]=E/w|0,w*=4294967296;return new a(g,0)}function m(E,g){if(E.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(E.charAt(0)=="-")return D(m(E.substring(1),g));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=d(Math.pow(g,8)),I=p,v=0;v<E.length;v+=8){var A=Math.min(8,E.length-v),_=parseInt(E.substring(v,v+A),g);8>A?(A=d(Math.pow(g,A)),I=I.j(A).add(d(_))):(I=I.j(w),I=I.add(d(_)))}return I}var p=l(0),y=l(1),S=l(16777216);r=a.prototype,r.m=function(){if(k(this))return-D(this).m();for(var E=0,g=1,w=0;w<this.g.length;w++){var I=this.i(w);E+=(0<=I?I:4294967296+I)*g,g*=4294967296}return E},r.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(C(this))return"0";if(k(this))return"-"+D(this).toString(E);for(var g=d(Math.pow(E,6)),w=this,I="";;){var v=X(w,g).g;w=G(w,v.j(g));var A=((0<w.g.length?w.g[0]:w.h)>>>0).toString(E);if(w=v,C(w))return A+I;for(;6>A.length;)A="0"+A;I=A+I}},r.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function C(E){if(E.h!=0)return!1;for(var g=0;g<E.g.length;g++)if(E.g[g]!=0)return!1;return!0}function k(E){return E.h==-1}r.l=function(E){return E=G(this,E),k(E)?-1:C(E)?0:1};function D(E){for(var g=E.g.length,w=[],I=0;I<g;I++)w[I]=~E.g[I];return new a(w,~E.h).add(y)}r.abs=function(){return k(this)?D(this):this},r.add=function(E){for(var g=Math.max(this.g.length,E.g.length),w=[],I=0,v=0;v<=g;v++){var A=I+(this.i(v)&65535)+(E.i(v)&65535),_=(A>>>16)+(this.i(v)>>>16)+(E.i(v)>>>16);I=_>>>16,A&=65535,_&=65535,w[v]=_<<16|A}return new a(w,w[w.length-1]&-2147483648?-1:0)};function G(E,g){return E.add(D(g))}r.j=function(E){if(C(this)||C(E))return p;if(k(this))return k(E)?D(this).j(D(E)):D(D(this).j(E));if(k(E))return D(this.j(D(E)));if(0>this.l(S)&&0>E.l(S))return d(this.m()*E.m());for(var g=this.g.length+E.g.length,w=[],I=0;I<2*g;I++)w[I]=0;for(I=0;I<this.g.length;I++)for(var v=0;v<E.g.length;v++){var A=this.i(I)>>>16,_=this.i(I)&65535,te=E.i(v)>>>16,fr=E.i(v)&65535;w[2*I+2*v]+=_*fr,q(w,2*I+2*v),w[2*I+2*v+1]+=A*fr,q(w,2*I+2*v+1),w[2*I+2*v+1]+=_*te,q(w,2*I+2*v+1),w[2*I+2*v+2]+=A*te,q(w,2*I+2*v+2)}for(I=0;I<g;I++)w[I]=w[2*I+1]<<16|w[2*I];for(I=g;I<2*g;I++)w[I]=0;return new a(w,0)};function q(E,g){for(;(E[g]&65535)!=E[g];)E[g+1]+=E[g]>>>16,E[g]&=65535,g++}function B(E,g){this.g=E,this.h=g}function X(E,g){if(C(g))throw Error("division by zero");if(C(E))return new B(p,p);if(k(E))return g=X(D(E),g),new B(D(g.g),D(g.h));if(k(g))return g=X(E,D(g)),new B(D(g.g),g.h);if(30<E.g.length){if(k(E)||k(g))throw Error("slowDivide_ only works with positive integers.");for(var w=y,I=g;0>=I.l(E);)w=et(w),I=et(I);var v=H(w,1),A=H(I,1);for(I=H(I,2),w=H(w,2);!C(I);){var _=A.add(I);0>=_.l(E)&&(v=v.add(w),A=_),I=H(I,1),w=H(w,1)}return g=G(E,v.j(g)),new B(v,g)}for(v=p;0<=E.l(g);){for(w=Math.max(1,Math.floor(E.m()/g.m())),I=Math.ceil(Math.log(w)/Math.LN2),I=48>=I?1:Math.pow(2,I-48),A=d(w),_=A.j(g);k(_)||0<_.l(E);)w-=I,A=d(w),_=A.j(g);C(A)&&(A=y),v=v.add(A),E=G(E,_)}return new B(v,E)}r.A=function(E){return X(this,E).h},r.and=function(E){for(var g=Math.max(this.g.length,E.g.length),w=[],I=0;I<g;I++)w[I]=this.i(I)&E.i(I);return new a(w,this.h&E.h)},r.or=function(E){for(var g=Math.max(this.g.length,E.g.length),w=[],I=0;I<g;I++)w[I]=this.i(I)|E.i(I);return new a(w,this.h|E.h)},r.xor=function(E){for(var g=Math.max(this.g.length,E.g.length),w=[],I=0;I<g;I++)w[I]=this.i(I)^E.i(I);return new a(w,this.h^E.h)};function et(E){for(var g=E.g.length+1,w=[],I=0;I<g;I++)w[I]=E.i(I)<<1|E.i(I-1)>>>31;return new a(w,E.h)}function H(E,g){var w=g>>5;g%=32;for(var I=E.g.length-w,v=[],A=0;A<I;A++)v[A]=0<g?E.i(A+w)>>>g|E.i(A+w+1)<<32-g:E.i(A+w);return new a(v,E.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,_a=zh.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=m,oe=zh.Integer=a}).apply(typeof jh<"u"?jh:typeof self<"u"?self:typeof window<"u"?window:{});var Ys=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ae={};var wa,Bg,Sn,Ea,Br,Zs,Ia,va,Ta;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,u,h){return o==Array.prototype||o==Object.prototype||(o[u]=h.value),o};function e(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ys=="object"&&Ys];for(var u=0;u<o.length;++u){var h=o[u];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var n=e(this);function s(o,u){if(u)t:{var h=n;o=o.split(".");for(var f=0;f<o.length-1;f++){var T=o[f];if(!(T in h))break t;h=h[T]}o=o[o.length-1],f=h[o],u=u(f),u!=f&&u!=null&&t(h,o,{configurable:!0,writable:!0,value:u})}}function i(o,u){o instanceof String&&(o+="");var h=0,f=!1,T={next:function(){if(!f&&h<o.length){var R=h++;return{value:u(R,o[R]),done:!1}}return f=!0,{done:!0,value:void 0}}};return T[Symbol.iterator]=function(){return T},T}s("Array.prototype.values",function(o){return o||function(){return i(this,function(u,h){return h})}});var a=a||{},c=this||self;function l(o){var u=typeof o;return u=u!="object"?u:o?Array.isArray(o)?"array":u:"null",u=="array"||u=="object"&&typeof o.length=="number"}function d(o){var u=typeof o;return u=="object"&&o!=null||u=="function"}function m(o,u,h){return o.call.apply(o.bind,arguments)}function p(o,u,h){if(!o)throw Error();if(2<arguments.length){var f=Array.prototype.slice.call(arguments,2);return function(){var T=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(T,f),o.apply(u,T)}}return function(){return o.apply(u,arguments)}}function y(o,u,h){return y=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?m:p,y.apply(null,arguments)}function S(o,u){var h=Array.prototype.slice.call(arguments,1);return function(){var f=h.slice();return f.push.apply(f,arguments),o.apply(this,f)}}function C(o,u){function h(){}h.prototype=u.prototype,o.aa=u.prototype,o.prototype=new h,o.prototype.constructor=o,o.Qb=function(f,T,R){for(var O=Array(arguments.length-2),nt=2;nt<arguments.length;nt++)O[nt-2]=arguments[nt];return u.prototype[T].apply(f,O)}}function k(o){let u=o.length;if(0<u){let h=Array(u);for(let f=0;f<u;f++)h[f]=o[f];return h}return[]}function D(o,u){for(let h=1;h<arguments.length;h++){let f=arguments[h];if(l(f)){let T=o.length||0,R=f.length||0;o.length=T+R;for(let O=0;O<R;O++)o[T+O]=f[O]}else o.push(f)}}class G{constructor(u,h){this.i=u,this.j=h,this.h=0,this.g=null}get(){let u;return 0<this.h?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function q(o){return/^[\s\xa0]*$/.test(o)}function B(){var o=c.navigator;return o&&(o=o.userAgent)?o:""}function X(o){return X[" "](o),o}X[" "]=function(){};var et=B().indexOf("Gecko")!=-1&&!(B().toLowerCase().indexOf("webkit")!=-1&&B().indexOf("Edge")==-1)&&!(B().indexOf("Trident")!=-1||B().indexOf("MSIE")!=-1)&&B().indexOf("Edge")==-1;function H(o,u,h){for(let f in o)u.call(h,o[f],f,o)}function E(o,u){for(let h in o)u.call(void 0,o[h],h,o)}function g(o){let u={};for(let h in o)u[h]=o[h];return u}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(o,u){let h,f;for(let T=1;T<arguments.length;T++){f=arguments[T];for(h in f)o[h]=f[h];for(let R=0;R<w.length;R++)h=w[R],Object.prototype.hasOwnProperty.call(f,h)&&(o[h]=f[h])}}function v(o){var u=1;o=o.split(":");let h=[];for(;0<u&&o.length;)h.push(o.shift()),u--;return o.length&&h.push(o.join(":")),h}function A(o){c.setTimeout(()=>{throw o},0)}function _(){var o=So;let u=null;return o.g&&(u=o.g,o.g=o.g.next,o.g||(o.h=null),u.next=null),u}class te{constructor(){this.h=this.g=null}add(u,h){let f=fr.get();f.set(u,h),this.h?this.h.next=f:this.g=f,this.h=f}}var fr=new G(()=>new $m,o=>o.reset());class $m{constructor(){this.next=this.g=this.h=null}set(u,h){this.h=u,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let mr,pr=!1,So=new te,ll=()=>{let o=c.Promise.resolve(void 0);mr=()=>{o.then(Km)}};var Km=()=>{for(var o;o=_();){try{o.h.call(o.g)}catch(h){A(h)}var u=fr;u.j(o),100>u.h&&(u.h++,o.next=u.g,u.g=o)}pr=!1};function de(){this.s=this.s,this.C=this.C}de.prototype.s=!1,de.prototype.ma=function(){this.s||(this.s=!0,this.N())},de.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function It(o,u){this.type=o,this.g=this.target=u,this.defaultPrevented=!1}It.prototype.h=function(){this.defaultPrevented=!0};var Qm=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var o=!1,u=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let h=()=>{};c.addEventListener("test",h,u),c.removeEventListener("test",h,u)}catch{}return o}();function gr(o,u){if(It.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var h=this.type=o.type,f=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=u,u=o.relatedTarget){if(et){t:{try{X(u.nodeName);var T=!0;break t}catch{}T=!1}T||(u=null)}}else h=="mouseover"?u=o.fromElement:h=="mouseout"&&(u=o.toElement);this.relatedTarget=u,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:Wm[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&gr.aa.h.call(this)}}C(gr,It);var Wm={2:"touch",3:"pen",4:"mouse"};gr.prototype.h=function(){gr.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var yr="closure_listenable_"+(1e6*Math.random()|0),Hm=0;function Jm(o,u,h,f,T){this.listener=o,this.proxy=null,this.src=u,this.type=h,this.capture=!!f,this.ha=T,this.key=++Hm,this.da=this.fa=!1}function Cs(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function Ds(o){this.src=o,this.g={},this.h=0}Ds.prototype.add=function(o,u,h,f,T){var R=o.toString();o=this.g[R],o||(o=this.g[R]=[],this.h++);var O=Po(o,u,f,T);return-1<O?(u=o[O],h||(u.fa=!1)):(u=new Jm(u,this.src,R,!!f,T),u.fa=h,o.push(u)),u};function Ro(o,u){var h=u.type;if(h in o.g){var f=o.g[h],T=Array.prototype.indexOf.call(f,u,void 0),R;(R=0<=T)&&Array.prototype.splice.call(f,T,1),R&&(Cs(u),o.g[h].length==0&&(delete o.g[h],o.h--))}}function Po(o,u,h,f){for(var T=0;T<o.length;++T){var R=o[T];if(!R.da&&R.listener==u&&R.capture==!!h&&R.ha==f)return T}return-1}var Co="closure_lm_"+(1e6*Math.random()|0),Do={};function hl(o,u,h,f,T){if(f&&f.once)return fl(o,u,h,f,T);if(Array.isArray(u)){for(var R=0;R<u.length;R++)hl(o,u[R],h,f,T);return null}return h=ko(h),o&&o[yr]?o.K(u,h,d(f)?!!f.capture:!!f,T):dl(o,u,h,!1,f,T)}function dl(o,u,h,f,T,R){if(!u)throw Error("Invalid event type");var O=d(T)?!!T.capture:!!T,nt=xo(o);if(nt||(o[Co]=nt=new Ds(o)),h=nt.add(u,h,f,O,R),h.proxy)return h;if(f=Xm(),h.proxy=f,f.src=o,f.listener=h,o.addEventListener)Qm||(T=O),T===void 0&&(T=!1),o.addEventListener(u.toString(),f,T);else if(o.attachEvent)o.attachEvent(pl(u.toString()),f);else if(o.addListener&&o.removeListener)o.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return h}function Xm(){function o(h){return u.call(o.src,o.listener,h)}let u=Ym;return o}function fl(o,u,h,f,T){if(Array.isArray(u)){for(var R=0;R<u.length;R++)fl(o,u[R],h,f,T);return null}return h=ko(h),o&&o[yr]?o.L(u,h,d(f)?!!f.capture:!!f,T):dl(o,u,h,!0,f,T)}function ml(o,u,h,f,T){if(Array.isArray(u))for(var R=0;R<u.length;R++)ml(o,u[R],h,f,T);else f=d(f)?!!f.capture:!!f,h=ko(h),o&&o[yr]?(o=o.i,u=String(u).toString(),u in o.g&&(R=o.g[u],h=Po(R,h,f,T),-1<h&&(Cs(R[h]),Array.prototype.splice.call(R,h,1),R.length==0&&(delete o.g[u],o.h--)))):o&&(o=xo(o))&&(u=o.g[u.toString()],o=-1,u&&(o=Po(u,h,f,T)),(h=-1<o?u[o]:null)&&Vo(h))}function Vo(o){if(typeof o!="number"&&o&&!o.da){var u=o.src;if(u&&u[yr])Ro(u.i,o);else{var h=o.type,f=o.proxy;u.removeEventListener?u.removeEventListener(h,f,o.capture):u.detachEvent?u.detachEvent(pl(h),f):u.addListener&&u.removeListener&&u.removeListener(f),(h=xo(u))?(Ro(h,o),h.h==0&&(h.src=null,u[Co]=null)):Cs(o)}}}function pl(o){return o in Do?Do[o]:Do[o]="on"+o}function Ym(o,u){if(o.da)o=!0;else{u=new gr(u,this);var h=o.listener,f=o.ha||o.src;o.fa&&Vo(o),o=h.call(f,u)}return o}function xo(o){return o=o[Co],o instanceof Ds?o:null}var No="__closure_events_fn_"+(1e9*Math.random()>>>0);function ko(o){return typeof o=="function"?o:(o[No]||(o[No]=function(u){return o.handleEvent(u)}),o[No])}function vt(){de.call(this),this.i=new Ds(this),this.M=this,this.F=null}C(vt,de),vt.prototype[yr]=!0,vt.prototype.removeEventListener=function(o,u,h,f){ml(this,o,u,h,f)};function Rt(o,u){var h,f=o.F;if(f)for(h=[];f;f=f.F)h.push(f);if(o=o.M,f=u.type||u,typeof u=="string")u=new It(u,o);else if(u instanceof It)u.target=u.target||o;else{var T=u;u=new It(f,o),I(u,T)}if(T=!0,h)for(var R=h.length-1;0<=R;R--){var O=u.g=h[R];T=Vs(O,f,!0,u)&&T}if(O=u.g=o,T=Vs(O,f,!0,u)&&T,T=Vs(O,f,!1,u)&&T,h)for(R=0;R<h.length;R++)O=u.g=h[R],T=Vs(O,f,!1,u)&&T}vt.prototype.N=function(){if(vt.aa.N.call(this),this.i){var o=this.i,u;for(u in o.g){for(var h=o.g[u],f=0;f<h.length;f++)Cs(h[f]);delete o.g[u],o.h--}}this.F=null},vt.prototype.K=function(o,u,h,f){return this.i.add(String(o),u,!1,h,f)},vt.prototype.L=function(o,u,h,f){return this.i.add(String(o),u,!0,h,f)};function Vs(o,u,h,f){if(u=o.i.g[String(u)],!u)return!0;u=u.concat();for(var T=!0,R=0;R<u.length;++R){var O=u[R];if(O&&!O.da&&O.capture==h){var nt=O.listener,gt=O.ha||O.src;O.fa&&Ro(o.i,O),T=nt.call(gt,f)!==!1&&T}}return T&&!f.defaultPrevented}function gl(o,u,h){if(typeof o=="function")h&&(o=y(o,h));else if(o&&typeof o.handleEvent=="function")o=y(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(u)?-1:c.setTimeout(o,u||0)}function yl(o){o.g=gl(()=>{o.g=null,o.i&&(o.i=!1,yl(o))},o.l);let u=o.h;o.h=null,o.m.apply(null,u)}class Zm extends de{constructor(u,h){super(),this.m=u,this.l=h,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:yl(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function _r(o){de.call(this),this.h=o,this.g={}}C(_r,de);var _l=[];function wl(o){H(o.g,function(u,h){this.g.hasOwnProperty(h)&&Vo(u)},o),o.g={}}_r.prototype.N=function(){_r.aa.N.call(this),wl(this)},_r.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Oo=c.JSON.stringify,tp=c.JSON.parse,ep=class{stringify(o){return c.JSON.stringify(o,void 0)}parse(o){return c.JSON.parse(o,void 0)}};function Mo(){}Mo.prototype.h=null;function El(o){return o.h||(o.h=o.i())}function Il(){}var wr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Fo(){It.call(this,"d")}C(Fo,It);function Lo(){It.call(this,"c")}C(Lo,It);var Le={},vl=null;function xs(){return vl=vl||new vt}Le.La="serverreachability";function Tl(o){It.call(this,Le.La,o)}C(Tl,It);function Er(o){let u=xs();Rt(u,new Tl(u))}Le.STAT_EVENT="statevent";function Al(o,u){It.call(this,Le.STAT_EVENT,o),this.stat=u}C(Al,It);function Pt(o){let u=xs();Rt(u,new Al(u,o))}Le.Ma="timingevent";function bl(o,u){It.call(this,Le.Ma,o),this.size=u}C(bl,It);function Ir(o,u){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){o()},u)}function vr(){this.g=!0}vr.prototype.xa=function(){this.g=!1};function np(o,u,h,f,T,R){o.info(function(){if(o.g)if(R)for(var O="",nt=R.split("&"),gt=0;gt<nt.length;gt++){var J=nt[gt].split("=");if(1<J.length){var Tt=J[0];J=J[1];var At=Tt.split("_");O=2<=At.length&&At[1]=="type"?O+(Tt+"="+J+"&"):O+(Tt+"=redacted&")}}else O=null;else O=R;return"XMLHTTP REQ ("+f+") [attempt "+T+"]: "+u+`
`+h+`
`+O})}function rp(o,u,h,f,T,R,O){o.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+T+"]: "+u+`
`+h+`
`+R+" "+O})}function En(o,u,h,f){o.info(function(){return"XMLHTTP TEXT ("+u+"): "+ip(o,h)+(f?" "+f:"")})}function sp(o,u){o.info(function(){return"TIMEOUT: "+u})}vr.prototype.info=function(){};function ip(o,u){if(!o.g)return u;if(!u)return null;try{var h=JSON.parse(u);if(h){for(o=0;o<h.length;o++)if(Array.isArray(h[o])){var f=h[o];if(!(2>f.length)){var T=f[1];if(Array.isArray(T)&&!(1>T.length)){var R=T[0];if(R!="noop"&&R!="stop"&&R!="close")for(var O=1;O<T.length;O++)T[O]=""}}}}return Oo(h)}catch{return u}}var Ns={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Sl={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Bo;function ks(){}C(ks,Mo),ks.prototype.g=function(){return new XMLHttpRequest},ks.prototype.i=function(){return{}},Bo=new ks;function fe(o,u,h,f){this.j=o,this.i=u,this.l=h,this.R=f||1,this.U=new _r(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Rl}function Rl(){this.i=null,this.g="",this.h=!1}var Pl={},Uo={};function qo(o,u,h){o.L=1,o.v=Ls(ee(u)),o.m=h,o.P=!0,Cl(o,null)}function Cl(o,u){o.F=Date.now(),Os(o),o.A=ee(o.v);var h=o.A,f=o.R;Array.isArray(f)||(f=[String(f)]),zl(h.i,"t",f),o.C=0,h=o.j.J,o.h=new Rl,o.g=ah(o.j,h?u:null,!o.m),0<o.O&&(o.M=new Zm(y(o.Y,o,o.g),o.O)),u=o.U,h=o.g,f=o.ca;var T="readystatechange";Array.isArray(T)||(T&&(_l[0]=T.toString()),T=_l);for(var R=0;R<T.length;R++){var O=hl(h,T[R],f||u.handleEvent,!1,u.h||u);if(!O)break;u.g[O.key]=O}u=o.H?g(o.H):{},o.m?(o.u||(o.u="POST"),u["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,u)):(o.u="GET",o.g.ea(o.A,o.u,null,u)),Er(),np(o.i,o.u,o.A,o.l,o.R,o.m)}fe.prototype.ca=function(o){o=o.target;let u=this.M;u&&ne(o)==3?u.j():this.Y(o)},fe.prototype.Y=function(o){try{if(o==this.g)t:{let At=ne(this.g);var u=this.g.Ba();let Tn=this.g.Z();if(!(3>At)&&(At!=3||this.g&&(this.h.h||this.g.oa()||Jl(this.g)))){this.J||At!=4||u==7||(u==8||0>=Tn?Er(3):Er(2)),jo(this);var h=this.g.Z();this.X=h;e:if(Dl(this)){var f=Jl(this.g);o="";var T=f.length,R=ne(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Be(this),Tr(this);var O="";break e}this.h.i=new c.TextDecoder}for(u=0;u<T;u++)this.h.h=!0,o+=this.h.i.decode(f[u],{stream:!(R&&u==T-1)});f.length=0,this.h.g+=o,this.C=0,O=this.h.g}else O=this.g.oa();if(this.o=h==200,rp(this.i,this.u,this.A,this.l,this.R,At,h),this.o){if(this.T&&!this.K){e:{if(this.g){var nt,gt=this.g;if((nt=gt.g?gt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!q(nt)){var J=nt;break e}}J=null}if(h=J)En(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,zo(this,h);else{this.o=!1,this.s=3,Pt(12),Be(this),Tr(this);break t}}if(this.P){h=!0;let jt;for(;!this.J&&this.C<O.length;)if(jt=op(this,O),jt==Uo){At==4&&(this.s=4,Pt(14),h=!1),En(this.i,this.l,null,"[Incomplete Response]");break}else if(jt==Pl){this.s=4,Pt(15),En(this.i,this.l,O,"[Invalid Chunk]"),h=!1;break}else En(this.i,this.l,jt,null),zo(this,jt);if(Dl(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),At!=4||O.length!=0||this.h.h||(this.s=1,Pt(16),h=!1),this.o=this.o&&h,!h)En(this.i,this.l,O,"[Invalid Chunked Response]"),Be(this),Tr(this);else if(0<O.length&&!this.W){this.W=!0;var Tt=this.j;Tt.g==this&&Tt.ba&&!Tt.M&&(Tt.j.info("Great, no buffering proxy detected. Bytes received: "+O.length),Ho(Tt),Tt.M=!0,Pt(11))}}else En(this.i,this.l,O,null),zo(this,O);At==4&&Be(this),this.o&&!this.J&&(At==4?rh(this.j,this):(this.o=!1,Os(this)))}else Tp(this.g),h==400&&0<O.indexOf("Unknown SID")?(this.s=3,Pt(12)):(this.s=0,Pt(13)),Be(this),Tr(this)}}}catch{}finally{}};function Dl(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function op(o,u){var h=o.C,f=u.indexOf(`
`,h);return f==-1?Uo:(h=Number(u.substring(h,f)),isNaN(h)?Pl:(f+=1,f+h>u.length?Uo:(u=u.slice(f,f+h),o.C=f+h,u)))}fe.prototype.cancel=function(){this.J=!0,Be(this)};function Os(o){o.S=Date.now()+o.I,Vl(o,o.I)}function Vl(o,u){if(o.B!=null)throw Error("WatchDog timer not null");o.B=Ir(y(o.ba,o),u)}function jo(o){o.B&&(c.clearTimeout(o.B),o.B=null)}fe.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(sp(this.i,this.A),this.L!=2&&(Er(),Pt(17)),Be(this),this.s=2,Tr(this)):Vl(this,this.S-o)};function Tr(o){o.j.G==0||o.J||rh(o.j,o)}function Be(o){jo(o);var u=o.M;u&&typeof u.ma=="function"&&u.ma(),o.M=null,wl(o.U),o.g&&(u=o.g,o.g=null,u.abort(),u.ma())}function zo(o,u){try{var h=o.j;if(h.G!=0&&(h.g==o||Go(h.h,o))){if(!o.K&&Go(h.h,o)&&h.G==3){try{var f=h.Da.g.parse(u)}catch{f=null}if(Array.isArray(f)&&f.length==3){var T=f;if(T[0]==0){t:if(!h.u){if(h.g)if(h.g.F+3e3<o.F)zs(h),qs(h);else break t;Wo(h),Pt(18)}}else h.za=T[1],0<h.za-h.T&&37500>T[2]&&h.F&&h.v==0&&!h.C&&(h.C=Ir(y(h.Za,h),6e3));if(1>=kl(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else qe(h,11)}else if((o.K||h.g==o)&&zs(h),!q(u))for(T=h.Da.g.parse(u),u=0;u<T.length;u++){let J=T[u];if(h.T=J[0],J=J[1],h.G==2)if(J[0]=="c"){h.K=J[1],h.ia=J[2];let Tt=J[3];Tt!=null&&(h.la=Tt,h.j.info("VER="+h.la));let At=J[4];At!=null&&(h.Aa=At,h.j.info("SVER="+h.Aa));let Tn=J[5];Tn!=null&&typeof Tn=="number"&&0<Tn&&(f=1.5*Tn,h.L=f,h.j.info("backChannelRequestTimeoutMs_="+f)),f=h;let jt=o.g;if(jt){let $s=jt.g?jt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if($s){var R=f.h;R.g||$s.indexOf("spdy")==-1&&$s.indexOf("quic")==-1&&$s.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&($o(R,R.h),R.h=null))}if(f.D){let Jo=jt.g?jt.g.getResponseHeader("X-HTTP-Session-Id"):null;Jo&&(f.ya=Jo,rt(f.I,f.D,Jo))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-o.F,h.j.info("Handshake RTT: "+h.R+"ms")),f=h;var O=o;if(f.qa=oh(f,f.J?f.ia:null,f.W),O.K){Ol(f.h,O);var nt=O,gt=f.L;gt&&(nt.I=gt),nt.B&&(jo(nt),Os(nt)),f.g=O}else eh(f);0<h.i.length&&js(h)}else J[0]!="stop"&&J[0]!="close"||qe(h,7);else h.G==3&&(J[0]=="stop"||J[0]=="close"?J[0]=="stop"?qe(h,7):Qo(h):J[0]!="noop"&&h.l&&h.l.ta(J),h.v=0)}}Er(4)}catch{}}var ap=class{constructor(o,u){this.g=o,this.map=u}};function xl(o){this.l=o||10,c.PerformanceNavigationTiming?(o=c.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Nl(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function kl(o){return o.h?1:o.g?o.g.size:0}function Go(o,u){return o.h?o.h==u:o.g?o.g.has(u):!1}function $o(o,u){o.g?o.g.add(u):o.h=u}function Ol(o,u){o.h&&o.h==u?o.h=null:o.g&&o.g.has(u)&&o.g.delete(u)}xl.prototype.cancel=function(){if(this.i=Ml(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function Ml(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let u=o.i;for(let h of o.g.values())u=u.concat(h.D);return u}return k(o.i)}function cp(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(l(o)){for(var u=[],h=o.length,f=0;f<h;f++)u.push(o[f]);return u}u=[],h=0;for(f in o)u[h++]=o[f];return u}function up(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(l(o)||typeof o=="string"){var u=[];o=o.length;for(var h=0;h<o;h++)u.push(h);return u}u=[],h=0;for(let f in o)u[h++]=f;return u}}}function Fl(o,u){if(o.forEach&&typeof o.forEach=="function")o.forEach(u,void 0);else if(l(o)||typeof o=="string")Array.prototype.forEach.call(o,u,void 0);else for(var h=up(o),f=cp(o),T=f.length,R=0;R<T;R++)u.call(void 0,f[R],h&&h[R],o)}var Ll=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function lp(o,u){if(o){o=o.split("&");for(var h=0;h<o.length;h++){var f=o[h].indexOf("="),T=null;if(0<=f){var R=o[h].substring(0,f);T=o[h].substring(f+1)}else R=o[h];u(R,T?decodeURIComponent(T.replace(/\+/g," ")):"")}}}function Ue(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof Ue){this.h=o.h,Ms(this,o.j),this.o=o.o,this.g=o.g,Fs(this,o.s),this.l=o.l;var u=o.i,h=new Sr;h.i=u.i,u.g&&(h.g=new Map(u.g),h.h=u.h),Bl(this,h),this.m=o.m}else o&&(u=String(o).match(Ll))?(this.h=!1,Ms(this,u[1]||"",!0),this.o=Ar(u[2]||""),this.g=Ar(u[3]||"",!0),Fs(this,u[4]),this.l=Ar(u[5]||"",!0),Bl(this,u[6]||"",!0),this.m=Ar(u[7]||"")):(this.h=!1,this.i=new Sr(null,this.h))}Ue.prototype.toString=function(){var o=[],u=this.j;u&&o.push(br(u,Ul,!0),":");var h=this.g;return(h||u=="file")&&(o.push("//"),(u=this.o)&&o.push(br(u,Ul,!0),"@"),o.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&o.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(br(h,h.charAt(0)=="/"?fp:dp,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",br(h,pp)),o.join("")};function ee(o){return new Ue(o)}function Ms(o,u,h){o.j=h?Ar(u,!0):u,o.j&&(o.j=o.j.replace(/:$/,""))}function Fs(o,u){if(u){if(u=Number(u),isNaN(u)||0>u)throw Error("Bad port number "+u);o.s=u}else o.s=null}function Bl(o,u,h){u instanceof Sr?(o.i=u,gp(o.i,o.h)):(h||(u=br(u,mp)),o.i=new Sr(u,o.h))}function rt(o,u,h){o.i.set(u,h)}function Ls(o){return rt(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function Ar(o,u){return o?u?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function br(o,u,h){return typeof o=="string"?(o=encodeURI(o).replace(u,hp),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function hp(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Ul=/[#\/\?@]/g,dp=/[#\?:]/g,fp=/[#\?]/g,mp=/[#\?@]/g,pp=/#/g;function Sr(o,u){this.h=this.g=null,this.i=o||null,this.j=!!u}function me(o){o.g||(o.g=new Map,o.h=0,o.i&&lp(o.i,function(u,h){o.add(decodeURIComponent(u.replace(/\+/g," ")),h)}))}r=Sr.prototype,r.add=function(o,u){me(this),this.i=null,o=In(this,o);var h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(u),this.h+=1,this};function ql(o,u){me(o),u=In(o,u),o.g.has(u)&&(o.i=null,o.h-=o.g.get(u).length,o.g.delete(u))}function jl(o,u){return me(o),u=In(o,u),o.g.has(u)}r.forEach=function(o,u){me(this),this.g.forEach(function(h,f){h.forEach(function(T){o.call(u,T,f,this)},this)},this)},r.na=function(){me(this);let o=Array.from(this.g.values()),u=Array.from(this.g.keys()),h=[];for(let f=0;f<u.length;f++){let T=o[f];for(let R=0;R<T.length;R++)h.push(u[f])}return h},r.V=function(o){me(this);let u=[];if(typeof o=="string")jl(this,o)&&(u=u.concat(this.g.get(In(this,o))));else{o=Array.from(this.g.values());for(let h=0;h<o.length;h++)u=u.concat(o[h])}return u},r.set=function(o,u){return me(this),this.i=null,o=In(this,o),jl(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[u]),this.h+=1,this},r.get=function(o,u){return o?(o=this.V(o),0<o.length?String(o[0]):u):u};function zl(o,u,h){ql(o,u),0<h.length&&(o.i=null,o.g.set(In(o,u),k(h)),o.h+=h.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],u=Array.from(this.g.keys());for(var h=0;h<u.length;h++){var f=u[h];let R=encodeURIComponent(String(f)),O=this.V(f);for(f=0;f<O.length;f++){var T=R;O[f]!==""&&(T+="="+encodeURIComponent(String(O[f]))),o.push(T)}}return this.i=o.join("&")};function In(o,u){return u=String(u),o.j&&(u=u.toLowerCase()),u}function gp(o,u){u&&!o.j&&(me(o),o.i=null,o.g.forEach(function(h,f){var T=f.toLowerCase();f!=T&&(ql(this,f),zl(this,T,h))},o)),o.j=u}function yp(o,u){let h=new vr;if(c.Image){let f=new Image;f.onload=S(pe,h,"TestLoadImage: loaded",!0,u,f),f.onerror=S(pe,h,"TestLoadImage: error",!1,u,f),f.onabort=S(pe,h,"TestLoadImage: abort",!1,u,f),f.ontimeout=S(pe,h,"TestLoadImage: timeout",!1,u,f),c.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=o}else u(!1)}function _p(o,u){let h=new vr,f=new AbortController,T=setTimeout(()=>{f.abort(),pe(h,"TestPingServer: timeout",!1,u)},1e4);fetch(o,{signal:f.signal}).then(R=>{clearTimeout(T),R.ok?pe(h,"TestPingServer: ok",!0,u):pe(h,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(T),pe(h,"TestPingServer: error",!1,u)})}function pe(o,u,h,f,T){try{T&&(T.onload=null,T.onerror=null,T.onabort=null,T.ontimeout=null),f(h)}catch{}}function wp(){this.g=new ep}function Ep(o,u,h){let f=h||"";try{Fl(o,function(T,R){let O=T;d(T)&&(O=Oo(T)),u.push(f+R+"="+encodeURIComponent(O))})}catch(T){throw u.push(f+"type="+encodeURIComponent("_badmap")),T}}function Rr(o){this.l=o.Ub||null,this.j=o.eb||!1}C(Rr,Mo),Rr.prototype.g=function(){return new Bs(this.l,this.j)},Rr.prototype.i=function(o){return function(){return o}}({});function Bs(o,u){vt.call(this),this.D=o,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}C(Bs,vt),r=Bs.prototype,r.open=function(o,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=u,this.readyState=1,Cr(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let u={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(u.body=o),(this.D||c).fetch(new Request(this.A,u)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Pr(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Cr(this)),this.g&&(this.readyState=3,Cr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Gl(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function Gl(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var u=o.value?o.value:new Uint8Array(0);(u=this.v.decode(u,{stream:!o.done}))&&(this.response=this.responseText+=u)}o.done?Pr(this):Cr(this),this.readyState==3&&Gl(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,Pr(this))},r.Qa=function(o){this.g&&(this.response=o,Pr(this))},r.ga=function(){this.g&&Pr(this)};function Pr(o){o.readyState=4,o.l=null,o.j=null,o.v=null,Cr(o)}r.setRequestHeader=function(o,u){this.u.append(o,u)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],u=this.h.entries();for(var h=u.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=u.next();return o.join(`\r
`)};function Cr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Bs.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function $l(o){let u="";return H(o,function(h,f){u+=f,u+=":",u+=h,u+=`\r
`}),u}function Ko(o,u,h){t:{for(f in h){var f=!1;break t}f=!0}f||(h=$l(h),typeof o=="string"?h!=null&&encodeURIComponent(String(h)):rt(o,u,h))}function at(o){vt.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}C(at,vt);var Ip=/^https?$/i,vp=["POST","PUT"];r=at.prototype,r.Ha=function(o){this.J=o},r.ea=function(o,u,h,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);u=u?u.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Bo.g(),this.v=this.o?El(this.o):El(Bo),this.g.onreadystatechange=y(this.Ea,this);try{this.B=!0,this.g.open(u,String(o),!0),this.B=!1}catch(R){Kl(this,R);return}if(o=h||"",h=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var T in f)h.set(T,f[T]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(let R of f.keys())h.set(R,f.get(R));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(h.keys()).find(R=>R.toLowerCase()=="content-type"),T=c.FormData&&o instanceof c.FormData,!(0<=Array.prototype.indexOf.call(vp,u,void 0))||f||T||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[R,O]of h)this.g.setRequestHeader(R,O);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Hl(this),this.u=!0,this.g.send(o),this.u=!1}catch(R){Kl(this,R)}};function Kl(o,u){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=u,o.m=5,Ql(o),Us(o)}function Ql(o){o.A||(o.A=!0,Rt(o,"complete"),Rt(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Rt(this,"complete"),Rt(this,"abort"),Us(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Us(this,!0)),at.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Wl(this):this.bb())},r.bb=function(){Wl(this)};function Wl(o){if(o.h&&typeof a<"u"&&(!o.v[1]||ne(o)!=4||o.Z()!=2)){if(o.u&&ne(o)==4)gl(o.Ea,0,o);else if(Rt(o,"readystatechange"),ne(o)==4){o.h=!1;try{let O=o.Z();t:switch(O){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break t;default:u=!1}var h;if(!(h=u)){var f;if(f=O===0){var T=String(o.D).match(Ll)[1]||null;!T&&c.self&&c.self.location&&(T=c.self.location.protocol.slice(0,-1)),f=!Ip.test(T?T.toLowerCase():"")}h=f}if(h)Rt(o,"complete"),Rt(o,"success");else{o.m=6;try{var R=2<ne(o)?o.g.statusText:""}catch{R=""}o.l=R+" ["+o.Z()+"]",Ql(o)}}finally{Us(o)}}}}function Us(o,u){if(o.g){Hl(o);let h=o.g,f=o.v[0]?()=>{}:null;o.g=null,o.v=null,u||Rt(o,"ready");try{h.onreadystatechange=f}catch{}}}function Hl(o){o.I&&(c.clearTimeout(o.I),o.I=null)}r.isActive=function(){return!!this.g};function ne(o){return o.g?o.g.readyState:0}r.Z=function(){try{return 2<ne(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var u=this.g.responseText;return o&&u.indexOf(o)==0&&(u=u.substring(o.length)),tp(u)}};function Jl(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function Tp(o){let u={};o=(o.g&&2<=ne(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<o.length;f++){if(q(o[f]))continue;var h=v(o[f]);let T=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();let R=u[T]||[];u[T]=R,R.push(h)}E(u,function(f){return f.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Dr(o,u,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||u}function Xl(o){this.Aa=0,this.i=[],this.j=new vr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Dr("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Dr("baseRetryDelayMs",5e3,o),this.cb=Dr("retryDelaySeedMs",1e4,o),this.Wa=Dr("forwardChannelMaxRetries",2,o),this.wa=Dr("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new xl(o&&o.concurrentRequestLimit),this.Da=new wp,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=Xl.prototype,r.la=8,r.G=1,r.connect=function(o,u,h,f){Pt(0),this.W=o,this.H=u||{},h&&f!==void 0&&(this.H.OSID=h,this.H.OAID=f),this.F=this.X,this.I=oh(this,null,this.W),js(this)};function Qo(o){if(Yl(o),o.G==3){var u=o.U++,h=ee(o.I);if(rt(h,"SID",o.K),rt(h,"RID",u),rt(h,"TYPE","terminate"),Vr(o,h),u=new fe(o,o.j,u),u.L=2,u.v=Ls(ee(h)),h=!1,c.navigator&&c.navigator.sendBeacon)try{h=c.navigator.sendBeacon(u.v.toString(),"")}catch{}!h&&c.Image&&(new Image().src=u.v,h=!0),h||(u.g=ah(u.j,null),u.g.ea(u.v)),u.F=Date.now(),Os(u)}ih(o)}function qs(o){o.g&&(Ho(o),o.g.cancel(),o.g=null)}function Yl(o){qs(o),o.u&&(c.clearTimeout(o.u),o.u=null),zs(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&c.clearTimeout(o.s),o.s=null)}function js(o){if(!Nl(o.h)&&!o.s){o.s=!0;var u=o.Ga;mr||ll(),pr||(mr(),pr=!0),So.add(u,o),o.B=0}}function Ap(o,u){return kl(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=u.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=Ir(y(o.Ga,o,u),sh(o,o.B)),o.B++,!0)}r.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let T=new fe(this,this.j,o),R=this.o;if(this.S&&(R?(R=g(R),I(R,this.S)):R=this.S),this.m!==null||this.O||(T.H=R,R=null),this.P)t:{for(var u=0,h=0;h<this.i.length;h++){e:{var f=this.i[h];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break e}f=void 0}if(f===void 0)break;if(u+=f,4096<u){u=h;break t}if(u===4096||h===this.i.length-1){u=h+1;break t}}u=1e3}else u=1e3;u=th(this,T,u),h=ee(this.I),rt(h,"RID",o),rt(h,"CVER",22),this.D&&rt(h,"X-HTTP-Session-Id",this.D),Vr(this,h),R&&(this.O?u="headers="+encodeURIComponent(String($l(R)))+"&"+u:this.m&&Ko(h,this.m,R)),$o(this.h,T),this.Ua&&rt(h,"TYPE","init"),this.P?(rt(h,"$req",u),rt(h,"SID","null"),T.T=!0,qo(T,h,null)):qo(T,h,u),this.G=2}}else this.G==3&&(o?Zl(this,o):this.i.length==0||Nl(this.h)||Zl(this))};function Zl(o,u){var h;u?h=u.l:h=o.U++;let f=ee(o.I);rt(f,"SID",o.K),rt(f,"RID",h),rt(f,"AID",o.T),Vr(o,f),o.m&&o.o&&Ko(f,o.m,o.o),h=new fe(o,o.j,h,o.B+1),o.m===null&&(h.H=o.o),u&&(o.i=u.D.concat(o.i)),u=th(o,h,1e3),h.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),$o(o.h,h),qo(h,f,u)}function Vr(o,u){o.H&&H(o.H,function(h,f){rt(u,f,h)}),o.l&&Fl({},function(h,f){rt(u,f,h)})}function th(o,u,h){h=Math.min(o.i.length,h);var f=o.l?y(o.l.Na,o.l,o):null;t:{var T=o.i;let R=-1;for(;;){let O=["count="+h];R==-1?0<h?(R=T[0].g,O.push("ofs="+R)):R=0:O.push("ofs="+R);let nt=!0;for(let gt=0;gt<h;gt++){let J=T[gt].g,Tt=T[gt].map;if(J-=R,0>J)R=Math.max(0,T[gt].g-100),nt=!1;else try{Ep(Tt,O,"req"+J+"_")}catch{f&&f(Tt)}}if(nt){f=O.join("&");break t}}}return o=o.i.splice(0,h),u.D=o,f}function eh(o){if(!o.g&&!o.u){o.Y=1;var u=o.Fa;mr||ll(),pr||(mr(),pr=!0),So.add(u,o),o.v=0}}function Wo(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=Ir(y(o.Fa,o),sh(o,o.v)),o.v++,!0)}r.Fa=function(){if(this.u=null,nh(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=Ir(y(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Pt(10),qs(this),nh(this))};function Ho(o){o.A!=null&&(c.clearTimeout(o.A),o.A=null)}function nh(o){o.g=new fe(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var u=ee(o.qa);rt(u,"RID","rpc"),rt(u,"SID",o.K),rt(u,"AID",o.T),rt(u,"CI",o.F?"0":"1"),!o.F&&o.ja&&rt(u,"TO",o.ja),rt(u,"TYPE","xmlhttp"),Vr(o,u),o.m&&o.o&&Ko(u,o.m,o.o),o.L&&(o.g.I=o.L);var h=o.g;o=o.ia,h.L=1,h.v=Ls(ee(u)),h.m=null,h.P=!0,Cl(h,o)}r.Za=function(){this.C!=null&&(this.C=null,qs(this),Wo(this),Pt(19))};function zs(o){o.C!=null&&(c.clearTimeout(o.C),o.C=null)}function rh(o,u){var h=null;if(o.g==u){zs(o),Ho(o),o.g=null;var f=2}else if(Go(o.h,u))h=u.D,Ol(o.h,u),f=1;else return;if(o.G!=0){if(u.o)if(f==1){h=u.m?u.m.length:0,u=Date.now()-u.F;var T=o.B;f=xs(),Rt(f,new bl(f,h)),js(o)}else eh(o);else if(T=u.s,T==3||T==0&&0<u.X||!(f==1&&Ap(o,u)||f==2&&Wo(o)))switch(h&&0<h.length&&(u=o.h,u.i=u.i.concat(h)),T){case 1:qe(o,5);break;case 4:qe(o,10);break;case 3:qe(o,6);break;default:qe(o,2)}}}function sh(o,u){let h=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(h*=2),h*u}function qe(o,u){if(o.j.info("Error code "+u),u==2){var h=y(o.fb,o),f=o.Xa;let T=!f;f=new Ue(f||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||Ms(f,"https"),Ls(f),T?yp(f.toString(),h):_p(f.toString(),h)}else Pt(2);o.G=0,o.l&&o.l.sa(u),ih(o),Yl(o)}r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Pt(2)):(this.j.info("Failed to ping google.com"),Pt(1))};function ih(o){if(o.G=0,o.ka=[],o.l){let u=Ml(o.h);(u.length!=0||o.i.length!=0)&&(D(o.ka,u),D(o.ka,o.i),o.h.i.length=0,k(o.i),o.i.length=0),o.l.ra()}}function oh(o,u,h){var f=h instanceof Ue?ee(h):new Ue(h);if(f.g!="")u&&(f.g=u+"."+f.g),Fs(f,f.s);else{var T=c.location;f=T.protocol,u=u?u+"."+T.hostname:T.hostname,T=+T.port;var R=new Ue(null);f&&Ms(R,f),u&&(R.g=u),T&&Fs(R,T),h&&(R.l=h),f=R}return h=o.D,u=o.ya,h&&u&&rt(f,h,u),rt(f,"VER",o.la),Vr(o,f),f}function ah(o,u,h){if(u&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return u=o.Ca&&!o.pa?new at(new Rr({eb:h})):new at(o.pa),u.Ha(o.J),u}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function ch(){}r=ch.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function Gs(){}Gs.prototype.g=function(o,u){return new Ot(o,u)};function Ot(o,u){vt.call(this),this.g=new Xl(u),this.l=o,this.h=u&&u.messageUrlParams||null,o=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(o?o["X-WebChannel-Content-Type"]=u.messageContentType:o={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.va&&(o?o["X-WebChannel-Client-Profile"]=u.va:o={"X-WebChannel-Client-Profile":u.va}),this.g.S=o,(o=u&&u.Sb)&&!q(o)&&(this.g.m=o),this.v=u&&u.supportsCrossDomainXhr||!1,this.u=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!q(u)&&(this.g.D=u,o=this.h,o!==null&&u in o&&(o=this.h,u in o&&delete o[u])),this.j=new vn(this)}C(Ot,vt),Ot.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ot.prototype.close=function(){Qo(this.g)},Ot.prototype.o=function(o){var u=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.u&&(h={},h.__data__=Oo(o),o=h);u.i.push(new ap(u.Ya++,o)),u.G==3&&js(u)},Ot.prototype.N=function(){this.g.l=null,delete this.j,Qo(this.g),delete this.g,Ot.aa.N.call(this)};function uh(o){Fo.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var u=o.__sm__;if(u){t:{for(let h in u){o=h;break t}o=void 0}(this.i=o)&&(o=this.i,u=u!==null&&o in u?u[o]:void 0),this.data=u}else this.data=o}C(uh,Fo);function lh(){Lo.call(this),this.status=1}C(lh,Lo);function vn(o){this.g=o}C(vn,ch),vn.prototype.ua=function(){Rt(this.g,"a")},vn.prototype.ta=function(o){Rt(this.g,new uh(o))},vn.prototype.sa=function(o){Rt(this.g,new lh)},vn.prototype.ra=function(){Rt(this.g,"b")},Gs.prototype.createWebChannel=Gs.prototype.g,Ot.prototype.send=Ot.prototype.o,Ot.prototype.open=Ot.prototype.m,Ot.prototype.close=Ot.prototype.close,Ta=ae.createWebChannelTransport=function(){return new Gs},va=ae.getStatEventTarget=function(){return xs()},Ia=ae.Event=Le,Zs=ae.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ns.NO_ERROR=0,Ns.TIMEOUT=8,Ns.HTTP_ERROR=6,Br=ae.ErrorCode=Ns,Sl.COMPLETE="complete",Ea=ae.EventType=Sl,Il.EventType=wr,wr.OPEN="a",wr.CLOSE="b",wr.ERROR="c",wr.MESSAGE="d",vt.prototype.listen=vt.prototype.K,Sn=ae.WebChannel=Il,Bg=ae.FetchXmlHttpFactory=Rr,at.prototype.listenOnce=at.prototype.L,at.prototype.getLastError=at.prototype.Ka,at.prototype.getLastErrorCode=at.prototype.Ba,at.prototype.getStatus=at.prototype.Z,at.prototype.getResponseJson=at.prototype.Oa,at.prototype.getResponseText=at.prototype.oa,at.prototype.send=at.prototype.ea,at.prototype.setWithCredentials=at.prototype.Ha,wa=ae.XhrIo=at}).apply(typeof Ys<"u"?Ys:typeof self<"u"?self:typeof window<"u"?window:{});var Gh="@firebase/firestore",$h="4.9.0";var ht=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};ht.UNAUTHENTICATED=new ht(null),ht.GOOGLE_CREDENTIALS=new ht("google-credentials-uid"),ht.FIRST_PARTY=new ht("first-party-uid"),ht.MOCK_USER=new ht("mock-user");var ur="12.0.0";var an=new bn("@firebase/firestore");function Nn(){return an.logLevel}function N(r,...t){if(an.logLevel<=Q.DEBUG){let e=t.map(xu);an.debug(`Firestore (${ur}): ${r}`,...e)}}function Ct(r,...t){if(an.logLevel<=Q.ERROR){let e=t.map(xu);an.error(`Firestore (${ur}): ${r}`,...e)}}function cn(r,...t){if(an.logLevel<=Q.WARN){let e=t.map(xu);an.warn(`Firestore (${ur}): ${r}`,...e)}}function xu(r){if(typeof r=="string")return r;try{return function(e){return JSON.stringify(e)}(r)}catch{return r}}function F(r,t,e){let n="Unexpected state";typeof t=="string"?n=t:e=t,rf(r,n,e)}function rf(r,t,e){let n=`FIRESTORE (${ur}) INTERNAL ASSERTION FAILED: ${t} (ID: ${r.toString(16)})`;if(e!==void 0)try{n+=" CONTEXT: "+JSON.stringify(e)}catch{n+=" CONTEXT: "+e}throw Ct(n),new Error(n)}function L(r,t,e,n){let s="Unexpected state";typeof e=="string"?s=e:n=e,r||rf(t,s,n)}function j(r,t){return r}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},x=class extends re{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Bt=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var fi=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},xa=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(ht.UNAUTHENTICATED))}shutdown(){}},Na=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},ka=class{constructor(t){this.t=t,this.currentUser=ht.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){L(this.o===void 0,42304);let n=this.i,s=l=>this.i!==n?(n=this.i,e(l)):Promise.resolve(),i=new Bt;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Bt,t.enqueueRetryable(()=>s(this.currentUser))};let a=()=>{let l=i;t.enqueueRetryable(()=>V(this,null,function*(){yield l.promise,yield s(this.currentUser)}))},c=l=>{N("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>c(l)),setTimeout(()=>{if(!this.auth){let l=this.t.getImmediate({optional:!0});l?c(l):(N("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Bt)}},0),a()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(n=>this.i!==t?(N("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(L(typeof n.accessToken=="string",31837,{l:n}),new fi(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return L(t===null||typeof t=="string",2055,{h:t}),new ht(t)}},Oa=class{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=ht.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},Ma=class{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new Oa(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(ht.FIRST_PARTY))}shutdown(){}invalidateToken(){}},mi=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Fa=class{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Fh(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){L(this.o===void 0,3512);let n=i=>{i.error!=null&&N("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);let a=i.token!==this.m;return this.m=i.token,N("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(i.token):Promise.resolve()};this.o=i=>{t.enqueueRetryable(()=>n(i))};let s=i=>{N("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){let i=this.V.getImmediate({optional:!0});i?s(i):N("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new mi(this.p));let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(L(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new mi(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function Ug(r){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<r;n++)e[n]=Math.floor(256*Math.random());return e}var Yr=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516),n="";for(;n.length<20;){let s=Ug(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%62))}return n}};function z(r,t){return r<t?-1:r>t?1:0}function La(r,t){let e=Math.min(r.length,t.length);for(let n=0;n<e;n++){let s=r.charAt(n),i=t.charAt(n);if(s!==i)return Aa(s)===Aa(i)?z(s,i):Aa(s)?1:-1}return z(r.length,t.length)}var qg=55296,jg=57343;function Aa(r){let t=r.charCodeAt(0);return t>=qg&&t<=jg}function jn(r,t,e){return r.length===t.length&&r.every((n,s)=>e(n,t[s]))}function sf(r){return r+"\0"}var Kh="__name__",pi=class r{constructor(t,e,n){e===void 0?e=0:e>t.length&&F(637,{offset:e,range:t.length}),n===void 0?n=t.length-e:n>t.length-e&&F(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return r.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof r?t.forEach(n=>{e.push(n)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let n=Math.min(t.length,e.length);for(let s=0;s<n;s++){let i=r.compareSegments(t.get(s),e.get(s));if(i!==0)return i}return z(t.length,e.length)}static compareSegments(t,e){let n=r.isNumericId(t),s=r.isNumericId(e);return n&&!s?-1:!n&&s?1:n&&s?r.extractNumericId(t).compare(r.extractNumericId(e)):La(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return oe.fromString(t.substring(4,t.length-2))}},Y=class r extends pi{construct(t,e,n){return new r(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let n of t){if(n.indexOf("//")>=0)throw new x(P.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(s=>s.length>0))}return new r(e)}static emptyPath(){return new r([])}},zg=/^[_a-zA-Z][_a-zA-Z0-9]*$/,dt=class r extends pi{construct(t,e,n){return new r(t,e,n)}static isValidIdentifier(t){return zg.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Kh}static keyField(){return new r([Kh])}static fromServerFormat(t){let e=[],n="",s=0,i=()=>{if(n.length===0)throw new x(P.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""},a=!1;for(;s<t.length;){let c=t[s];if(c==="\\"){if(s+1===t.length)throw new x(P.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let l=t[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new x(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=l,s+=2}else c==="`"?(a=!a,s++):c!=="."||a?(n+=c,s++):(i(),s++)}if(i(),a)throw new x(P.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new r(e)}static emptyPath(){return new r([])}};var M=class r{constructor(t){this.path=t}static fromPath(t){return new r(Y.fromString(t))}static fromName(t){return new r(Y.fromString(t).popFirst(5))}static empty(){return new r(Y.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Y.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return Y.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new r(new Y(t.slice()))}};function of(r,t,e){if(!e)throw new x(P.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function Gg(r,t,e,n){if(t===!0&&n===!0)throw new x(P.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function Qh(r){if(!M.isDocumentKey(r))throw new x(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Wh(r){if(M.isDocumentKey(r))throw new x(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function af(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}function mo(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let t=function(n){return n.constructor?n.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":F(12329,{type:typeof r})}function wt(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new x(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=mo(r);throw new x(P.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}function $g(r,t){if(t<=0)throw new x(P.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${t}.`)}function lt(r,t){let e={typeString:r};return t&&(e.value=t),e}function ws(r,t){if(!af(r))throw new x(P.INVALID_ARGUMENT,"JSON must be an object");let e;for(let n in t)if(t[n]){let s=t[n].typeString,i="value"in t[n]?{value:t[n].value}:void 0;if(!(n in r)){e=`JSON missing required field: '${n}'`;break}let a=r[n];if(s&&typeof a!==s){e=`JSON field '${n}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){e=`Expected '${n}' field to equal '${i.value}'`;break}}if(e)throw new x(P.INVALID_ARGUMENT,e);return!0}var Hh=-62135596800,Jh=1e6,it=class r{static now(){return r.fromMillis(Date.now())}static fromDate(t){return r.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*Jh);return new r(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new x(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new x(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<Hh)throw new x(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new x(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Jh}_compareTo(t){return this.seconds===t.seconds?z(this.nanoseconds,t.nanoseconds):z(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:r._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(ws(t,r._jsonSchema))return new r(t.seconds,t.nanoseconds)}valueOf(){let t=this.seconds-Hh;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};it._jsonSchemaVersion="firestore/timestamp/1.0",it._jsonSchema={type:lt("string",it._jsonSchemaVersion),seconds:lt("number"),nanoseconds:lt("number")};var U=class r{static fromTimestamp(t){return new r(t)}static min(){return new r(new it(0,0))}static max(){return new r(new it(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Zr=-1,zn=class{constructor(t,e,n,s){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=s}};function Ba(r){return r.fields.find(t=>t.kind===2)}function $e(r){return r.fields.filter(t=>t.kind!==2)}zn.UNKNOWN_ID=-1;var Ln=class{constructor(t,e){this.fieldPath=t,this.kind=e}};var ts=class r{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new r(0,qt.min())}};function Kg(r,t){let e=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,s=U.fromTimestamp(n===1e9?new it(e+1,0):new it(e,n));return new qt(s,M.empty(),t)}function cf(r){return new qt(r.readTime,r.key,Zr)}var qt=class r{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new r(U.min(),M.empty(),Zr)}static max(){return new r(U.max(),M.empty(),Zr)}};function Nu(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=M.comparator(r.documentKey,t.documentKey),e!==0?e:z(r.largestBatchId,t.largestBatchId))}var uf="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",gi=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function _n(r){return V(this,null,function*(){if(r.code!==P.FAILED_PRECONDITION||r.message!==uf)throw r;N("LocalStore","Unexpectedly lost primary lease")})}var b=class r{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&F(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new r((n,s)=>{this.nextCallback=i=>{this.wrapSuccess(t,i).next(n,s)},this.catchCallback=i=>{this.wrapFailure(e,i).next(n,s)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof r?e:r.resolve(e)}catch(e){return r.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):r.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):r.reject(e)}static resolve(t){return new r((e,n)=>{e(t)})}static reject(t){return new r((e,n)=>{n(t)})}static waitFor(t){return new r((e,n)=>{let s=0,i=0,a=!1;t.forEach(c=>{++s,c.next(()=>{++i,a&&i===s&&e()},l=>n(l))}),a=!0,i===s&&e()})}static or(t){let e=r.resolve(!1);for(let n of t)e=e.next(s=>s?r.resolve(s):n());return e}static forEach(t,e){let n=[];return t.forEach((s,i)=>{n.push(e.call(this,s,i))}),this.waitFor(n)}static mapArray(t,e){return new r((n,s)=>{let i=t.length,a=new Array(i),c=0;for(let l=0;l<i;l++){let d=l;e(t[d]).next(m=>{a[d]=m,++c,c===i&&n(a)},m=>s(m))}})}static doWhile(t,e){return new r((n,s)=>{let i=()=>{t()===!0?e().next(()=>{i()},s):n()};i()})}};var Mt="SimpleDb",yi=class r{static open(t,e,n,s){try{return new r(e,t.transaction(s,n))}catch(i){throw new tn(e,i)}}constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.S=new Bt,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{e.error?this.S.reject(new tn(t,e.error)):this.S.resolve()},this.transaction.onerror=n=>{let s=ku(n.target.error);this.S.reject(new tn(t,s))}}get D(){return this.S.promise}abort(t){t&&this.S.reject(t),this.aborted||(N(Mt,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new qa(e)}},Gn=class r{static delete(t){return N(Mt,"Removing database:",t),Qe(ta().indexedDB.deleteDatabase(t)).toPromise()}static v(){if(!Hs())return!1;if(r.F())return!0;let t=je(),e=r.M(t),n=0<e&&e<10,s=lf(t),i=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static F(){return typeof process<"u"&&process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE==="YES"}static O(t,e){return t.store(e)}static M(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(t,e,n){this.name=t,this.version=e,this.N=n,this.B=null,r.M(je())===12.2&&Ct("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}L(t){return V(this,null,function*(){return this.db||(N(Mt,"Opening database:",this.name),this.db=yield new Promise((e,n)=>{let s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{let a=i.target.result;e(a)},s.onblocked=()=>{n(new tn(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{let a=i.target.error;a.name==="VersionError"?n(new x(P.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new x(P.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new tn(t,a))},s.onupgradeneeded=i=>{N(Mt,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);let a=i.target.result;this.N.k(a,s.transaction,i.oldVersion,this.version).next(()=>{N(Mt,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=e=>this.q(e)),this.db})}$(t){this.q=t,this.db&&(this.db.onversionchange=e=>t(e))}runTransaction(t,e,n,s){return V(this,null,function*(){let i=e==="readonly",a=0;for(;;){++a;try{this.db=yield this.L(t);let c=yi.open(this.db,t,i?"readonly":"readwrite",n),l=s(c).next(d=>(c.C(),d)).catch(d=>(c.abort(d),b.reject(d))).toPromise();return l.catch(()=>{}),yield c.D,l}catch(c){let l=c,d=l.name!=="FirebaseError"&&a<3;if(N(Mt,"Transaction failed with error:",l.message,"Retrying:",d),this.close(),!d)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function lf(r){let t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}var Ua=class{constructor(t){this.U=t,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(t){this.U=t}done(){this.K=!0}j(t){this.W=t}delete(){return Qe(this.U.delete())}},tn=class extends x{constructor(t,e){super(P.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};function Me(r){return r.name==="IndexedDbTransactionError"}var qa=class{constructor(t){this.store=t}put(t,e){let n;return e!==void 0?(N(Mt,"PUT",this.store.name,t,e),n=this.store.put(e,t)):(N(Mt,"PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Qe(n)}add(t){return N(Mt,"ADD",this.store.name,t,t),Qe(this.store.add(t))}get(t){return Qe(this.store.get(t)).next(e=>(e===void 0&&(e=null),N(Mt,"GET",this.store.name,t,e),e))}delete(t){return N(Mt,"DELETE",this.store.name,t),Qe(this.store.delete(t))}count(){return N(Mt,"COUNT",this.store.name),Qe(this.store.count())}J(t,e){let n=this.options(t,e),s=n.index?this.store.index(n.index):this.store;if(typeof s.getAll=="function"){let i=s.getAll(n.range);return new b((a,c)=>{i.onerror=l=>{c(l.target.error)},i.onsuccess=l=>{a(l.target.result)}})}{let i=this.cursor(n),a=[];return this.H(i,(c,l)=>{a.push(l)}).next(()=>a)}}Y(t,e){let n=this.store.getAll(t,e===null?void 0:e);return new b((s,i)=>{n.onerror=a=>{i(a.target.error)},n.onsuccess=a=>{s(a.target.result)}})}Z(t,e){N(Mt,"DELETE ALL",this.store.name);let n=this.options(t,e);n.X=!1;let s=this.cursor(n);return this.H(s,(i,a,c)=>c.delete())}ee(t,e){let n;e?n=t:(n={},e=t);let s=this.cursor(n);return this.H(s,e)}te(t){let e=this.cursor({});return new b((n,s)=>{e.onerror=i=>{let a=ku(i.target.error);s(a)},e.onsuccess=i=>{let a=i.target.result;a?t(a.primaryKey,a.value).next(c=>{c?a.continue():n()}):n()}})}H(t,e){let n=[];return new b((s,i)=>{t.onerror=a=>{i(a.target.error)},t.onsuccess=a=>{let c=a.target.result;if(!c)return void s();let l=new Ua(c),d=e(c.primaryKey,c.value,l);if(d instanceof b){let m=d.catch(p=>(l.done(),b.reject(p)));n.push(m)}l.isDone?s():l.G===null?c.continue():c.continue(l.G)}}).next(()=>b.waitFor(n))}options(t,e){let n;return t!==void 0&&(typeof t=="string"?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let n=this.store.index(t.index);return t.X?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};function Qe(r){return new b((t,e)=>{r.onsuccess=n=>{let s=n.target.result;t(s)},r.onerror=n=>{let s=ku(n.target.error);e(s)}})}var Xh=!1;function ku(r){let t=Gn.M(je());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(e)>=0){let n=new x("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Xh||(Xh=!0,setTimeout(()=>{throw n},0)),n}}return r}var Kr="IndexBackfiller",ja=class{constructor(t,e){this.asyncQueue=t,this.ne=e,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(t){N(Kr,`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,()=>V(this,null,function*(){this.task=null;try{let e=yield this.ne.ie();N(Kr,`Documents written: ${e}`)}catch(e){Me(e)?N(Kr,"Ignoring IndexedDB error during index backfill: ",e):yield _n(e)}yield this.re(6e4)}))}},za=class{constructor(t,e){this.localStore=t,this.persistence=e}ie(t=50){return V(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.se(e,t))})}se(t,e){let n=new Set,s=e,i=!0;return b.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(a=>{if(a!==null&&!n.has(a))return N(Kr,`Processing collection: ${a}`),this.oe(t,a,s).next(c=>{s-=c,n.add(a)});i=!1})).next(()=>e-s)}oe(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(s=>this.localStore.localDocuments.getNextDocuments(t,e,s,n).next(i=>{let a=i.changes;return this.localStore.indexManager.updateIndexEntries(t,a).next(()=>this._e(s,i)).next(c=>(N(Kr,`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(t,e,c))).next(()=>a.size)}))}_e(t,e){let n=t;return e.changes.forEach((s,i)=>{let a=cf(i);Nu(a,n)>0&&(n=a)}),new qt(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}};var Gt=(()=>{class r{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>n.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}r.ce=-1;return r})(),en=-1;function po(r){return r==null}function es(r){return r===0&&1/r==-1/0}function Qg(r){return typeof r=="number"&&Number.isInteger(r)&&!es(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}var _i="";function St(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=Yh(t)),t=Wg(r.get(e),t);return Yh(t)}function Wg(r,t){let e=t,n=r.length;for(let s=0;s<n;s++){let i=r.charAt(s);switch(i){case"\0":e+="";break;case _i:e+="";break;default:e+=i}}return e}function Yh(r){return r+_i+""}function Wt(r){let t=r.length;if(L(t>=2,64408,{path:r}),t===2)return L(r.charAt(0)===_i&&r.charAt(1)==="",56145,{path:r}),Y.emptyPath();let e=t-2,n=[],s="";for(let i=0;i<t;){let a=r.indexOf(_i,i);switch((a<0||a>e)&&F(50515,{path:r}),r.charAt(a+1)){case"":let c=r.substring(i,a),l;s.length===0?l=c:(s+=c,l=s,s=""),n.push(l);break;case"":s+=r.substring(i,a),s+="\0";break;case"":s+=r.substring(i,a+1);break;default:F(61167,{path:r})}i=a+2}return new Y(n)}var Ke="remoteDocuments",Es="owner",Rn="owner",ns="mutationQueues",Hg="userId",zt="mutations",Zh="batchId",Xe="userMutationsIndex",td=["userId","batchId"];function ii(r,t){return[r,St(t)]}function hf(r,t,e){return[r,St(t),e]}var Jg={},$n="documentMutations",wi="remoteDocumentsV14",Xg=["prefixPath","collectionGroup","readTime","documentId"],oi="documentKeyIndex",Yg=["prefixPath","collectionGroup","documentId"],df="collectionGroupIndex",Zg=["collectionGroup","readTime","prefixPath","documentId"],rs="remoteDocumentGlobal",Ga="remoteDocumentGlobalKey",Kn="targets",ff="queryTargetsIndex",ty=["canonicalId","targetId"],Qn="targetDocuments",ey=["targetId","path"],Ou="documentTargetsIndex",ny=["path","targetId"],Ei="targetGlobalKey",nn="targetGlobal",ss="collectionParents",ry=["collectionId","parent"],Wn="clientMetadata",sy="clientId",go="bundles",iy="bundleId",yo="namedQueries",oy="name",Mu="indexConfiguration",ay="indexId",$a="collectionGroupIndex",cy="collectionGroup",Qr="indexState",uy=["indexId","uid"],mf="sequenceNumberIndex",ly=["uid","sequenceNumber"],Wr="indexEntries",hy=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],pf="documentKeyIndex",dy=["indexId","uid","orderedDocumentKey"],_o="documentOverlays",fy=["userId","collectionPath","documentId"],Ka="collectionPathOverlayIndex",my=["userId","collectionPath","largestBatchId"],gf="collectionGroupOverlayIndex",py=["userId","collectionGroup","largestBatchId"],Fu="globals",gy="name",yf=[ns,zt,$n,Ke,Kn,Es,nn,Qn,Wn,rs,ss,go,yo],yy=[...yf,_o],_f=[ns,zt,$n,wi,Kn,Es,nn,Qn,Wn,rs,ss,go,yo,_o],wf=_f,Lu=[...wf,Mu,Qr,Wr],_y=Lu,Ef=[...Lu,Fu],wy=Ef;var is=class extends gi{constructor(t,e){super(),this.le=t,this.currentSequenceNumber=e}};function pt(r,t){let e=j(r);return Gn.O(e.le,t)}function ed(r){let t=0;for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function Fe(r,t){for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function Ey(r,t){let e=[];for(let n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.push(t(r[n],n,r));return e}function If(r){for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}var ot=class r{constructor(t,e){this.comparator=t,this.root=e||Jt.EMPTY}insert(t,e){return new r(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Jt.BLACK,null,null))}remove(t){return new r(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Jt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){let s=this.comparator(t,n.key);if(s===0)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){let t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Fn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Fn(this.root,t,this.comparator,!1)}getReverseIterator(){return new Fn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Fn(this.root,t,this.comparator,!0)}},Fn=class{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(i===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},Jt=class r{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=n??r.RED,this.left=s??r.EMPTY,this.right=i??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new r(t??this.key,e??this.value,n??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this,i=n(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,n),null):i===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return r.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw F(43730,{key:this.key,value:this.value});if(this.right.isRed())throw F(14113,{key:this.key,value:this.value});let t=this.left.check();if(t!==this.right.check())throw F(27949);return t+(this.isRed()?0:1)}};Jt.EMPTY=null,Jt.RED=!0,Jt.BLACK=!1;Jt.EMPTY=new class{constructor(){this.size=0}get key(){throw F(57766)}get value(){throw F(16141)}get color(){throw F(16727)}get left(){throw F(29726)}get right(){throw F(36894)}copy(t,e,n,s,i){return this}insert(t,e,n){return new Jt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var tt=class r{constructor(t){this.comparator=t,this.data=new ot(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){let n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){let s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Ii(this.data.getIterator())}getIteratorFrom(t){return new Ii(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(n=>{e=e.add(n)}),e}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){let s=e.getNext().key,i=n.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new r(this.comparator);return e.data=t,e}},Ii=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Pn(r){return r.hasNext()?r.getNext():void 0}var Ft=class r{constructor(t){this.fields=t,t.sort(dt.comparator)}static empty(){return new r([])}unionWith(t){let e=new tt(dt.comparator);for(let n of this.fields)e=e.add(n);for(let n of t)e=e.add(n);return new r(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return jn(this.fields,t.fields,(e,n)=>e.isEqual(n))}};var vi=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var mt=class r{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new vi("Invalid base64 string: "+i):i}}(t);return new r(e)}static fromUint8Array(t){let e=function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i}(t);return new r(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return z(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};mt.EMPTY_BYTE_STRING=new mt("");var Iy=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ue(r){if(L(!!r,39018),typeof r=="string"){let t=0,e=Iy.exec(r);if(L(!!e,46558,{timestamp:r}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:st(r.seconds),nanos:st(r.nanos)}}function st(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function le(r){return typeof r=="string"?mt.fromBase64String(r):mt.fromUint8Array(r)}var vf="server_timestamp",Tf="__type__",Af="__previous_value__",bf="__local_write_time__";function wo(r){return(r?.mapValue?.fields||{})[Tf]?.stringValue===vf}function Eo(r){let t=r.mapValue.fields[Af];return wo(t)?Eo(t):t}function os(r){let t=ue(r.mapValue.fields[bf].timestampValue);return new it(t.seconds,t.nanos)}var Qa=class{constructor(t,e,n,s,i,a,c,l,d,m){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=l,this.useFetchStreams=d,this.isUsingEmulator=m}},Ti="(default)",Hn=class r{constructor(t,e){this.projectId=t,this.database=e||Ti}static empty(){return new r("","")}get isDefaultDatabase(){return this.database===Ti}isEqual(t){return t instanceof r&&t.projectId===this.projectId&&t.database===this.database}};var Bu="__type__",Sf="__max__",Te={mapValue:{fields:{__type__:{stringValue:Sf}}}},Uu="__vector__",Jn="value",ai={nullValue:"NULL_VALUE"};function Pe(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?wo(r)?4:Rf(r)?9007199254740991:Io(r)?10:11:F(28295,{value:r})}function Xt(r,t){if(r===t)return!0;let e=Pe(r);if(e!==Pe(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return os(r).isEqual(os(t));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;let a=ue(s.timestampValue),c=ue(i.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(s,i){return le(s.bytesValue).isEqual(le(i.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(s,i){return st(s.geoPointValue.latitude)===st(i.geoPointValue.latitude)&&st(s.geoPointValue.longitude)===st(i.geoPointValue.longitude)}(r,t);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return st(s.integerValue)===st(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){let a=st(s.doubleValue),c=st(i.doubleValue);return a===c?es(a)===es(c):isNaN(a)&&isNaN(c)}return!1}(r,t);case 9:return jn(r.arrayValue.values||[],t.arrayValue.values||[],Xt);case 10:case 11:return function(s,i){let a=s.mapValue.fields||{},c=i.mapValue.fields||{};if(ed(a)!==ed(c))return!1;for(let l in a)if(a.hasOwnProperty(l)&&(c[l]===void 0||!Xt(a[l],c[l])))return!1;return!0}(r,t);default:return F(52216,{left:r})}}function as(r,t){return(r.values||[]).find(e=>Xt(e,t))!==void 0}function Ce(r,t){if(r===t)return 0;let e=Pe(r),n=Pe(t);if(e!==n)return z(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return z(r.booleanValue,t.booleanValue);case 2:return function(i,a){let c=st(i.integerValue||i.doubleValue),l=st(a.integerValue||a.doubleValue);return c<l?-1:c>l?1:c===l?0:isNaN(c)?isNaN(l)?0:-1:1}(r,t);case 3:return nd(r.timestampValue,t.timestampValue);case 4:return nd(os(r),os(t));case 5:return La(r.stringValue,t.stringValue);case 6:return function(i,a){let c=le(i),l=le(a);return c.compareTo(l)}(r.bytesValue,t.bytesValue);case 7:return function(i,a){let c=i.split("/"),l=a.split("/");for(let d=0;d<c.length&&d<l.length;d++){let m=z(c[d],l[d]);if(m!==0)return m}return z(c.length,l.length)}(r.referenceValue,t.referenceValue);case 8:return function(i,a){let c=z(st(i.latitude),st(a.latitude));return c!==0?c:z(st(i.longitude),st(a.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return rd(r.arrayValue,t.arrayValue);case 10:return function(i,a){let c=i.fields||{},l=a.fields||{},d=c[Jn]?.arrayValue,m=l[Jn]?.arrayValue,p=z(d?.values?.length||0,m?.values?.length||0);return p!==0?p:rd(d,m)}(r.mapValue,t.mapValue);case 11:return function(i,a){if(i===Te.mapValue&&a===Te.mapValue)return 0;if(i===Te.mapValue)return 1;if(a===Te.mapValue)return-1;let c=i.fields||{},l=Object.keys(c),d=a.fields||{},m=Object.keys(d);l.sort(),m.sort();for(let p=0;p<l.length&&p<m.length;++p){let y=La(l[p],m[p]);if(y!==0)return y;let S=Ce(c[l[p]],d[m[p]]);if(S!==0)return S}return z(l.length,m.length)}(r.mapValue,t.mapValue);default:throw F(23264,{he:e})}}function nd(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return z(r,t);let e=ue(r),n=ue(t),s=z(e.seconds,n.seconds);return s!==0?s:z(e.nanos,n.nanos)}function rd(r,t){let e=r.values||[],n=t.values||[];for(let s=0;s<e.length&&s<n.length;++s){let i=Ce(e[s],n[s]);if(i)return i}return z(e.length,n.length)}function Xn(r){return Wa(r)}function Wa(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(e){let n=ue(e);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(e){return le(e).toBase64()}(r.bytesValue):"referenceValue"in r?function(e){return M.fromName(e).toString()}(r.referenceValue):"geoPointValue"in r?function(e){return`geo(${e.latitude},${e.longitude})`}(r.geoPointValue):"arrayValue"in r?function(e){let n="[",s=!0;for(let i of e.values||[])s?s=!1:n+=",",n+=Wa(i);return n+"]"}(r.arrayValue):"mapValue"in r?function(e){let n=Object.keys(e.fields||{}).sort(),s="{",i=!0;for(let a of n)i?i=!1:s+=",",s+=`${a}:${Wa(e.fields[a])}`;return s+"}"}(r.mapValue):F(61005,{value:r})}function ci(r){switch(Pe(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=Eo(r);return t?16+ci(t):16;case 5:return 2*r.stringValue.length;case 6:return le(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(n){return(n.values||[]).reduce((s,i)=>s+ci(i),0)}(r.arrayValue);case 10:case 11:return function(n){let s=0;return Fe(n.fields,(i,a)=>{s+=i.length+ci(a)}),s}(r.mapValue);default:throw F(13486,{value:r})}}function un(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function Ha(r){return!!r&&"integerValue"in r}function cs(r){return!!r&&"arrayValue"in r}function sd(r){return!!r&&"nullValue"in r}function id(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function ui(r){return!!r&&"mapValue"in r}function Io(r){return(r?.mapValue?.fields||{})[Bu]?.stringValue===Uu}function Hr(r){if(r.geoPointValue)return{geoPointValue:yt({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:yt({},r.timestampValue)};if(r.mapValue){let t={mapValue:{fields:{}}};return Fe(r.mapValue.fields,(e,n)=>t.mapValue.fields[e]=Hr(n)),t}if(r.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=Hr(r.arrayValue.values[e]);return t}return yt({},r)}function Rf(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===Sf}var Pf={mapValue:{fields:{[Bu]:{stringValue:Uu},[Jn]:{arrayValue:{}}}}};function vy(r){return"nullValue"in r?ai:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?un(Hn.empty(),M.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?Io(r)?Pf:{mapValue:{}}:F(35942,{value:r})}function Ty(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?un(Hn.empty(),M.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?Pf:"mapValue"in r?Io(r)?{mapValue:{}}:Te:F(61959,{value:r})}function od(r,t){let e=Ce(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?-1:!r.inclusive&&t.inclusive?1:0}function ad(r,t){let e=Ce(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?1:!r.inclusive&&t.inclusive?-1:0}var Dt=class r{constructor(t){this.value=t}static empty(){return new r({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!ui(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Hr(e)}setAll(t){let e=dt.emptyPath(),n={},s=[];t.forEach((a,c)=>{if(!e.isImmediateParentOf(c)){let l=this.getFieldsMap(e);this.applyChanges(l,n,s),n={},s=[],e=c.popLast()}a?n[c.lastSegment()]=Hr(a):s.push(c.lastSegment())});let i=this.getFieldsMap(e);this.applyChanges(i,n,s)}delete(t){let e=this.field(t.popLast());ui(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Xt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];ui(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){Fe(e,(s,i)=>t[s]=i);for(let s of n)delete t[s]}clone(){return new r(Hr(this.value))}};function Cf(r){let t=[];return Fe(r.fields,(e,n)=>{let s=new dt([e]);if(ui(n)){let i=Cf(n.mapValue).fields;if(i.length===0)t.push(s);else for(let a of i)t.push(s.child(a))}else t.push(s)}),new Ft(t)}var Et=class r{constructor(t,e,n,s,i,a,c){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.createTime=i,this.data=a,this.documentState=c}static newInvalidDocument(t){return new r(t,0,U.min(),U.min(),U.min(),Dt.empty(),0)}static newFoundDocument(t,e,n,s){return new r(t,1,e,U.min(),n,s,0)}static newNoDocument(t,e){return new r(t,2,e,U.min(),U.min(),Dt.empty(),0)}static newUnknownDocument(t,e){return new r(t,3,e,U.min(),U.min(),Dt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(U.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Dt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Dt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=U.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof r&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Yt=class{constructor(t,e){this.position=t,this.inclusive=e}};function cd(r,t,e){let n=0;for(let s=0;s<r.position.length;s++){let i=t[s],a=r.position[s];if(i.field.isKeyField()?n=M.comparator(M.fromName(a.referenceValue),e.key):n=Ce(a,e.data.field(i.field)),i.dir==="desc"&&(n*=-1),n!==0)break}return n}function ud(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!Xt(r.position[e],t.position[e]))return!1;return!0}var ln=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function Ay(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}var Ai=class{},K=class r extends Ai{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new Ya(t,e,n):e==="array-contains"?new ec(t,n):e==="in"?new bi(t,n):e==="not-in"?new nc(t,n):e==="array-contains-any"?new rc(t,n):new r(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new Za(t,n):new tc(t,n)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(Ce(e,this.value)):e!==null&&Pe(this.value)===Pe(e)&&this.matchesComparison(Ce(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return F(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Z=class r extends Ai{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new r(t,e)}matches(t){return Yn(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}};function Yn(r){return r.op==="and"}function Ja(r){return r.op==="or"}function qu(r){return Df(r)&&Yn(r)}function Df(r){for(let t of r.filters)if(t instanceof Z)return!1;return!0}function Xa(r){if(r instanceof K)return r.field.canonicalString()+r.op.toString()+Xn(r.value);if(qu(r))return r.filters.map(t=>Xa(t)).join(",");{let t=r.filters.map(e=>Xa(e)).join(",");return`${r.op}(${t})`}}function Vf(r,t){return r instanceof K?function(n,s){return s instanceof K&&n.op===s.op&&n.field.isEqual(s.field)&&Xt(n.value,s.value)}(r,t):r instanceof Z?function(n,s){return s instanceof Z&&n.op===s.op&&n.filters.length===s.filters.length?n.filters.reduce((i,a,c)=>i&&Vf(a,s.filters[c]),!0):!1}(r,t):void F(19439)}function xf(r,t){let e=r.filters.concat(t);return Z.create(e,r.op)}function Nf(r){return r instanceof K?function(e){return`${e.field.canonicalString()} ${e.op} ${Xn(e.value)}`}(r):r instanceof Z?function(e){return e.op.toString()+" {"+e.getFilters().map(Nf).join(" ,")+"}"}(r):"Filter"}var Ya=class extends K{constructor(t,e,n){super(t,e,n),this.key=M.fromName(n.referenceValue)}matches(t){let e=M.comparator(t.key,this.key);return this.matchesComparison(e)}},Za=class extends K{constructor(t,e){super(t,"in",e),this.keys=kf("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},tc=class extends K{constructor(t,e){super(t,"not-in",e),this.keys=kf("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function kf(r,t){return(t.arrayValue?.values||[]).map(e=>M.fromName(e.referenceValue))}var ec=class extends K{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return cs(e)&&as(e.arrayValue,this.value)}},bi=class extends K{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&as(this.value.arrayValue,e)}},nc=class extends K{constructor(t,e){super(t,"not-in",e)}matches(t){if(as(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!as(this.value.arrayValue,e)}},rc=class extends K{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!cs(e)||!e.arrayValue.values)&&e.arrayValue.values.some(n=>as(this.value.arrayValue,n))}};var sc=class{constructor(t,e=null,n=[],s=[],i=null,a=null,c=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=a,this.endAt=c,this.Te=null}};function ic(r,t=null,e=[],n=[],s=null,i=null,a=null){return new sc(r,t,e,n,s,i,a)}function hn(r){let t=j(r);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(n=>Xa(n)).join(","),e+="|ob:",e+=t.orderBy.map(n=>function(i){return i.field.canonicalString()+i.dir}(n)).join(","),po(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(n=>Xn(n)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(n=>Xn(n)).join(",")),t.Te=e}return t.Te}function Is(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!Ay(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!Vf(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!ud(r.startAt,t.startAt)&&ud(r.endAt,t.endAt)}function Si(r){return M.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function Ri(r,t){return r.filters.filter(e=>e instanceof K&&e.field.isEqual(t))}function ld(r,t,e){let n=ai,s=!0;for(let i of Ri(r,t)){let a=ai,c=!0;switch(i.op){case"<":case"<=":a=vy(i.value);break;case"==":case"in":case">=":a=i.value;break;case">":a=i.value,c=!1;break;case"!=":case"not-in":a=ai}od({value:n,inclusive:s},{value:a,inclusive:c})<0&&(n=a,s=c)}if(e!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(t)){let a=e.position[i];od({value:n,inclusive:s},{value:a,inclusive:e.inclusive})<0&&(n=a,s=e.inclusive);break}}return{value:n,inclusive:s}}function hd(r,t,e){let n=Te,s=!0;for(let i of Ri(r,t)){let a=Te,c=!0;switch(i.op){case">=":case">":a=Ty(i.value),c=!1;break;case"==":case"in":case"<=":a=i.value;break;case"<":a=i.value,c=!1;break;case"!=":case"not-in":a=Te}ad({value:n,inclusive:s},{value:a,inclusive:c})>0&&(n=a,s=c)}if(e!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(t)){let a=e.position[i];ad({value:n,inclusive:s},{value:a,inclusive:e.inclusive})>0&&(n=a,s=e.inclusive);break}}return{value:n,inclusive:s}}var he=class{constructor(t,e=null,n=[],s=[],i=null,a="F",c=null,l=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=a,this.startAt=c,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}};function by(r,t,e,n,s,i,a,c){return new he(r,t,e,n,s,i,a,c)}function vs(r){return new he(r)}function dd(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function ju(r){return r.collectionGroup!==null}function Bn(r){let t=j(r);if(t.Ie===null){t.Ie=[];let e=new Set;for(let i of t.explicitOrderBy)t.Ie.push(i),e.add(i.field.canonicalString());let n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new tt(dt.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(d=>{d.isInequality()&&(c=c.add(d.field))})}),c})(t).forEach(i=>{e.has(i.canonicalString())||i.isKeyField()||t.Ie.push(new ln(i,n))}),e.has(dt.keyField().canonicalString())||t.Ie.push(new ln(dt.keyField(),n))}return t.Ie}function Ut(r){let t=j(r);return t.Ee||(t.Ee=Of(t,Bn(r))),t.Ee}function Sy(r){let t=j(r);return t.de||(t.de=Of(t,r.explicitOrderBy)),t.de}function Of(r,t){if(r.limitType==="F")return ic(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(s=>{let i=s.dir==="desc"?"asc":"desc";return new ln(s.field,i)});let e=r.endAt?new Yt(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Yt(r.startAt.position,r.startAt.inclusive):null;return ic(r.path,r.collectionGroup,t,r.filters,r.limit,e,n)}}function oc(r,t){let e=r.filters.concat([t]);return new he(r.path,r.collectionGroup,r.explicitOrderBy.slice(),e,r.limit,r.limitType,r.startAt,r.endAt)}function Pi(r,t,e){return new he(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function vo(r,t){return Is(Ut(r),Ut(t))&&r.limitType===t.limitType}function Mf(r){return`${hn(Ut(r))}|lt:${r.limitType}`}function kn(r){return`Query(target=${function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map(s=>Nf(s)).join(", ")}]`),po(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(s=>Xn(s)).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(s=>Xn(s)).join(",")),`Target(${n})`}(Ut(r))}; limitType=${r.limitType})`}function Ts(r,t){return t.isFoundDocument()&&function(n,s){let i=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):M.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(r,t)&&function(n,s){for(let i of Bn(n))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(r,t)&&function(n,s){for(let i of n.filters)if(!i.matches(s))return!1;return!0}(r,t)&&function(n,s){return!(n.startAt&&!function(a,c,l){let d=cd(a,c,l);return a.inclusive?d<=0:d<0}(n.startAt,Bn(n),s)||n.endAt&&!function(a,c,l){let d=cd(a,c,l);return a.inclusive?d>=0:d>0}(n.endAt,Bn(n),s))}(r,t)}function Ry(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Ff(r){return(t,e)=>{let n=!1;for(let s of Bn(r)){let i=Py(s,t,e);if(i!==0)return i;n=n||s.field.isKeyField()}return 0}}function Py(r,t,e){let n=r.field.isKeyField()?M.comparator(t.key,e.key):function(i,a,c){let l=a.data.field(i),d=c.data.field(i);return l!==null&&d!==null?Ce(l,d):F(42886)}(r.field,t,e);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return F(19790,{direction:r.dir})}}var $t=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(let[s,i]of n)if(this.equalsFn(s,t))return i}}has(t){return this.get(t)!==void 0}set(t,e){let n=this.mapKeyFn(t),s=this.inner[n];if(s===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],t))return void(s[i]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return n.length===1?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){Fe(this.inner,(e,n)=>{for(let[s,i]of n)t(s,i)})}isEmpty(){return If(this.inner)}size(){return this.innerSize}};var Cy=new ot(M.comparator);function Lt(){return Cy}var Lf=new ot(M.comparator);function Gr(...r){let t=Lf;for(let e of r)t=t.insert(e.key,e);return t}function Bf(r){let t=Lf;return r.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function Ht(){return Jr()}function Uf(){return Jr()}function Jr(){return new $t(r=>r.toString(),(r,t)=>r.isEqual(t))}var Dy=new ot(M.comparator),Vy=new tt(M.comparator);function $(...r){let t=Vy;for(let e of r)t=t.add(e);return t}var xy=new tt(z);function Ny(){return xy}function zu(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:es(t)?"-0":t}}function qf(r){return{integerValue:""+r}}function ky(r,t){return Qg(t)?qf(t):zu(r,t)}var Zn=class{constructor(){this._=void 0}};function Oy(r,t,e){return r instanceof De?function(s,i){let a={fields:{[Tf]:{stringValue:vf},[bf]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&wo(i)&&(i=Eo(i)),i&&(a.fields[Af]=i),{mapValue:a}}(e,t):r instanceof Ve?zf(r,t):r instanceof xe?Gf(r,t):function(s,i){let a=jf(s,i),c=fd(a)+fd(s.Ae);return Ha(a)&&Ha(s.Ae)?qf(c):zu(s.serializer,c)}(r,t)}function My(r,t,e){return r instanceof Ve?zf(r,t):r instanceof xe?Gf(r,t):e}function jf(r,t){return r instanceof dn?function(n){return Ha(n)||function(i){return!!i&&"doubleValue"in i}(n)}(t)?t:{integerValue:0}:null}var De=class extends Zn{},Ve=class extends Zn{constructor(t){super(),this.elements=t}};function zf(r,t){let e=$f(t);for(let n of r.elements)e.some(s=>Xt(s,n))||e.push(n);return{arrayValue:{values:e}}}var xe=class extends Zn{constructor(t){super(),this.elements=t}};function Gf(r,t){let e=$f(t);for(let n of r.elements)e=e.filter(s=>!Xt(s,n));return{arrayValue:{values:e}}}var dn=class extends Zn{constructor(t,e){super(),this.serializer=t,this.Ae=e}};function fd(r){return st(r.integerValue||r.doubleValue)}function $f(r){return cs(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}var Ci=class{constructor(t,e){this.field=t,this.transform=e}};function Fy(r,t){return r.field.isEqual(t.field)&&function(n,s){return n instanceof Ve&&s instanceof Ve||n instanceof xe&&s instanceof xe?jn(n.elements,s.elements,Xt):n instanceof dn&&s instanceof dn?Xt(n.Ae,s.Ae):n instanceof De&&s instanceof De}(r.transform,t.transform)}var ac=class{constructor(t,e){this.version=t,this.transformResults=e}},_t=class r{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new r}static exists(t){return new r(void 0,t)}static updateTime(t){return new r(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function li(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}var tr=class{};function Kf(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new fn(r.key,_t.none()):new Ne(r.key,r.data,_t.none());{let e=r.data,n=Dt.empty(),s=new tt(dt.comparator);for(let i of t.fields)if(!s.has(i)){let a=e.field(i);a===null&&i.length>1&&(i=i.popLast(),a=e.field(i)),a===null?n.delete(i):n.set(i,a),s=s.add(i)}return new Kt(r.key,n,new Ft(s.toArray()),_t.none())}}function Ly(r,t,e){r instanceof Ne?function(s,i,a){let c=s.value.clone(),l=pd(s.fieldTransforms,i,a.transformResults);c.setAll(l),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(r,t,e):r instanceof Kt?function(s,i,a){if(!li(s.precondition,i))return void i.convertToUnknownDocument(a.version);let c=pd(s.fieldTransforms,i,a.transformResults),l=i.data;l.setAll(Qf(s)),l.setAll(c),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(r,t,e):function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,t,e)}function Xr(r,t,e,n){return r instanceof Ne?function(i,a,c,l){if(!li(i.precondition,a))return c;let d=i.value.clone(),m=gd(i.fieldTransforms,l,a);return d.setAll(m),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(r,t,e,n):r instanceof Kt?function(i,a,c,l){if(!li(i.precondition,a))return c;let d=gd(i.fieldTransforms,l,a),m=a.data;return m.setAll(Qf(i)),m.setAll(d),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),c===null?null:c.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(p=>p.field))}(r,t,e,n):function(i,a,c){return li(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c}(r,t,e)}function By(r,t){let e=null;for(let n of r.fieldTransforms){let s=t.data.field(n.field),i=jf(n.transform,s||null);i!=null&&(e===null&&(e=Dt.empty()),e.set(n.field,i))}return e||null}function md(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&jn(n,s,(i,a)=>Fy(i,a))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}var Ne=class extends tr{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}},Kt=class extends tr{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}};function Qf(r){let t=new Map;return r.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let n=r.data.field(e);t.set(e,n)}}),t}function pd(r,t,e){let n=new Map;L(r.length===e.length,32656,{Re:e.length,Ve:r.length});for(let s=0;s<e.length;s++){let i=r[s],a=i.transform,c=t.data.field(i.field);n.set(i.field,My(a,c,e[s]))}return n}function gd(r,t,e){let n=new Map;for(let s of r){let i=s.transform,a=e.data.field(s.field);n.set(s.field,Oy(i,a,t))}return n}var fn=class extends tr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Di=class extends tr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var us=class{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){let n=e.mutationResults;for(let s=0;s<this.mutations.length;s++){let i=this.mutations[s];i.key.isEqual(t.key)&&Ly(i,t,n[s])}}applyToLocalView(t,e){for(let n of this.baseMutations)n.key.isEqual(t.key)&&(e=Xr(n,t,e,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(t.key)&&(e=Xr(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let n=Uf();return this.mutations.forEach(s=>{let i=t.get(s.key),a=i.overlayedDocument,c=this.applyToLocalView(a,i.mutatedFields);c=e.has(s.key)?null:c;let l=Kf(a,c);l!==null&&n.set(s.key,l),a.isValidDocument()||a.convertToNoDocument(U.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),$())}isEqual(t){return this.batchId===t.batchId&&jn(this.mutations,t.mutations,(e,n)=>md(e,n))&&jn(this.baseMutations,t.baseMutations,(e,n)=>md(e,n))}},cc=class r{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){L(t.mutations.length===n.length,58842,{me:t.mutations.length,fe:n.length});let s=function(){return Dy}(),i=t.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,n[a].version);return new r(t,e,n,s)}};var ls=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var uc=class{constructor(t,e,n){this.alias=t,this.aggregateType=e,this.fieldPath=n}};var lc=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var ct,W;function Uy(r){switch(r){case P.OK:return F(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return F(15467,{code:r})}}function Wf(r){if(r===void 0)return Ct("GRPC error has no .code"),P.UNKNOWN;switch(r){case ct.OK:return P.OK;case ct.CANCELLED:return P.CANCELLED;case ct.UNKNOWN:return P.UNKNOWN;case ct.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case ct.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case ct.INTERNAL:return P.INTERNAL;case ct.UNAVAILABLE:return P.UNAVAILABLE;case ct.UNAUTHENTICATED:return P.UNAUTHENTICATED;case ct.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case ct.NOT_FOUND:return P.NOT_FOUND;case ct.ALREADY_EXISTS:return P.ALREADY_EXISTS;case ct.PERMISSION_DENIED:return P.PERMISSION_DENIED;case ct.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case ct.ABORTED:return P.ABORTED;case ct.OUT_OF_RANGE:return P.OUT_OF_RANGE;case ct.UNIMPLEMENTED:return P.UNIMPLEMENTED;case ct.DATA_LOSS:return P.DATA_LOSS;default:return F(39323,{code:r})}}(W=ct||(ct={}))[W.OK=0]="OK",W[W.CANCELLED=1]="CANCELLED",W[W.UNKNOWN=2]="UNKNOWN",W[W.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",W[W.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",W[W.NOT_FOUND=5]="NOT_FOUND",W[W.ALREADY_EXISTS=6]="ALREADY_EXISTS",W[W.PERMISSION_DENIED=7]="PERMISSION_DENIED",W[W.UNAUTHENTICATED=16]="UNAUTHENTICATED",W[W.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",W[W.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",W[W.ABORTED=10]="ABORTED",W[W.OUT_OF_RANGE=11]="OUT_OF_RANGE",W[W.UNIMPLEMENTED=12]="UNIMPLEMENTED",W[W.INTERNAL=13]="INTERNAL",W[W.UNAVAILABLE=14]="UNAVAILABLE",W[W.DATA_LOSS=15]="DATA_LOSS";var qy=null;function jy(){return new TextEncoder}var zy=new oe([4294967295,4294967295],0);function yd(r){let t=jy().encode(r),e=new _a;return e.update(t),new Uint8Array(e.digest())}function _d(r){let t=new DataView(r.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),s=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new oe([e,n],0),new oe([s,i],0)]}var hc=class r{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new Ye(`Invalid padding: ${e}`);if(n<0)throw new Ye(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new Ye(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new Ye(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=oe.fromNumber(this.ge)}ye(t,e,n){let s=t.add(e.multiply(oe.fromNumber(n)));return s.compare(zy)===1&&(s=new oe([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;let e=yd(t),[n,s]=_d(e);for(let i=0;i<this.hashCount;i++){let a=this.ye(n,s,i);if(!this.we(a))return!1}return!0}static create(t,e,n){let s=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),a=new r(i,s,e);return n.forEach(c=>a.insert(c)),a}insert(t){if(this.ge===0)return;let e=yd(t),[n,s]=_d(e);for(let i=0;i<this.hashCount;i++){let a=this.ye(n,s,i);this.Se(a)}}Se(t){let e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}},Ye=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Vi=class r{constructor(t,e,n,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){let s=new Map;return s.set(t,hs.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new r(U.min(),s,new ot(z),Lt(),$())}},hs=class r{constructor(t,e,n,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new r(n,e,$(),$(),$())}};var Un=class{constructor(t,e,n,s){this.be=t,this.removedTargetIds=e,this.key=n,this.De=s}},xi=class{constructor(t,e){this.targetId=t,this.Ce=e}},Ni=class{constructor(t,e,n=mt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}},ki=class{constructor(){this.ve=0,this.Fe=wd(),this.Me=mt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=$(),e=$(),n=$();return this.Fe.forEach((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:F(38017,{changeType:i})}}),new hs(this.Me,this.xe,t,e,n)}qe(){this.Oe=!1,this.Fe=wd()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,L(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}},dc=class{constructor(t){this.Ge=t,this.ze=new Map,this.je=Lt(),this.Je=ti(),this.He=ti(),this.Ye=new ot(z)}Ze(t){for(let e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(let e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,e=>{let n=this.nt(e);switch(t.state){case 0:this.rt(e)&&n.Le(t.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(t.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(n.We(),n.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),n.Le(t.resumeToken));break;default:F(56790,{state:t.state})}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach((n,s)=>{this.rt(s)&&e(s)})}st(t){let e=t.targetId,n=t.Ce.count,s=this.ot(e);if(s){let i=s.target;if(Si(i))if(n===0){let a=new M(i.path);this.et(e,a,Et.newNoDocument(a,U.min()))}else L(n===1,20013,{expectedCount:n});else{let a=this._t(e);if(a!==n){let c=this.ut(t),l=c?this.ct(c,t,a):1;if(l!==0){this.it(e);let d=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,d)}qy?.lt(function(m,p,y,S,C){let k={localCacheCount:m,existenceFilterCount:p.count,databaseId:y.database,projectId:y.projectId},D=p.unchangedNames;return D&&(k.bloomFilter={applied:C===0,hashCount:D?.hashCount??0,bitmapLength:D?.bits?.bitmap?.length??0,padding:D?.bits?.padding??0,mightContain:G=>S?.mightContain(G)??!1}),k}(a,t.Ce,this.Ge.ht(),c,l))}}}}ut(t){let e=t.Ce.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:n="",padding:s=0},hashCount:i=0}=e,a,c;try{a=le(n).toUint8Array()}catch(l){if(l instanceof vi)return cn("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{c=new hc(a,s,i)}catch(l){return cn(l instanceof Ye?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return c.ge===0?null:c}ct(t,e,n){return e.Ce.count===n-this.Pt(t,e.targetId)?0:2}Pt(t,e){let n=this.Ge.getRemoteKeysForTarget(e),s=0;return n.forEach(i=>{let a=this.Ge.ht(),c=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;t.mightContain(c)||(this.et(e,i,null),s++)}),s}Tt(t){let e=new Map;this.ze.forEach((i,a)=>{let c=this.ot(a);if(c){if(i.current&&Si(c.target)){let l=new M(c.target.path);this.It(l).has(a)||this.Et(a,l)||this.et(a,l,Et.newNoDocument(l,t))}i.Be&&(e.set(a,i.ke()),i.qe())}});let n=$();this.He.forEach((i,a)=>{let c=!0;a.forEachWhile(l=>{let d=this.ot(l);return!d||d.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(n=n.add(i))}),this.je.forEach((i,a)=>a.setReadTime(t));let s=new Vi(t,e,this.Ye,this.je,n);return this.je=Lt(),this.Je=ti(),this.He=ti(),this.Ye=new ot(z),s}Xe(t,e){if(!this.rt(t))return;let n=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,n),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,n){if(!this.rt(t))return;let s=this.nt(t);this.Et(t,e)?s.Qe(e,1):s.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),n&&(this.je=this.je.insert(e,n))}removeTarget(t){this.ze.delete(t)}_t(t){let e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new ki,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new tt(z),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new tt(z),this.Je=this.Je.insert(t,e)),e}rt(t){let e=this.ot(t)!==null;return e||N("WatchChangeAggregator","Detected inactive target",t),e}ot(t){let e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new ki),this.Ge.getRemoteKeysForTarget(t).forEach(e=>{this.et(t,e,null)})}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}};function ti(){return new ot(M.comparator)}function wd(){return new ot(M.comparator)}var Gy={asc:"ASCENDING",desc:"DESCENDING"},$y={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ky={and:"AND",or:"OR"},fc=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function mc(r,t){return r.useProto3Json||po(t)?t:{value:t}}function er(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Hf(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function Qy(r,t){return er(r,t.toTimestamp())}function Vt(r){return L(!!r,49232),U.fromTimestamp(function(e){let n=ue(e);return new it(n.seconds,n.nanos)}(r))}function Gu(r,t){return pc(r,t).canonicalString()}function pc(r,t){let e=function(s){return new Y(["projects",s.projectId,"databases",s.database])}(r).child("documents");return t===void 0?e:e.child(t)}function Jf(r){let t=Y.fromString(r);return L(sm(t),10190,{key:t.toString()}),t}function Oi(r,t){return Gu(r.databaseId,t.path)}function rn(r,t){let e=Jf(t);if(e.get(1)!==r.databaseId.projectId)throw new x(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new x(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new M(Zf(e))}function Xf(r,t){return Gu(r.databaseId,t)}function Yf(r){let t=Jf(r);return t.length===4?Y.emptyPath():Zf(t)}function gc(r){return new Y(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Zf(r){return L(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function Ed(r,t,e){return{name:Oi(r,t),fields:e.value.mapValue.fields}}function Wy(r,t,e){let n=rn(r,t.name),s=Vt(t.updateTime),i=t.createTime?Vt(t.createTime):U.min(),a=new Dt({mapValue:{fields:t.fields}}),c=Et.newFoundDocument(n,s,i,a);return e&&c.setHasCommittedMutations(),e?c.setHasCommittedMutations():c}function Hy(r,t){let e;if("targetChange"in t){t.targetChange;let n=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:F(39313,{state:d})}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=function(d,m){return d.useProto3Json?(L(m===void 0||typeof m=="string",58123),mt.fromBase64String(m||"")):(L(m===void 0||m instanceof Buffer||m instanceof Uint8Array,16193),mt.fromUint8Array(m||new Uint8Array))}(r,t.targetChange.resumeToken),a=t.targetChange.cause,c=a&&function(d){let m=d.code===void 0?P.UNKNOWN:Wf(d.code);return new x(m,d.message||"")}(a);e=new Ni(n,s,i,c||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let s=rn(r,n.document.name),i=Vt(n.document.updateTime),a=n.document.createTime?Vt(n.document.createTime):U.min(),c=new Dt({mapValue:{fields:n.document.fields}}),l=Et.newFoundDocument(s,i,a,c),d=n.targetIds||[],m=n.removedTargetIds||[];e=new Un(d,m,l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let s=rn(r,n.document),i=n.readTime?Vt(n.readTime):U.min(),a=Et.newNoDocument(s,i),c=n.removedTargetIds||[];e=new Un([],c,a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let s=rn(r,n.document),i=n.removedTargetIds||[];e=new Un([],i,s,null)}else{if(!("filter"in t))return F(11601,{Rt:t});{t.filter;let n=t.filter;n.targetId;let{count:s=0,unchangedNames:i}=n,a=new lc(s,i),c=n.targetId;e=new xi(c,a)}}return e}function Mi(r,t){let e;if(t instanceof Ne)e={update:Ed(r,t.key,t.value)};else if(t instanceof fn)e={delete:Oi(r,t.key)};else if(t instanceof Kt)e={update:Ed(r,t.key,t.data),updateMask:n_(t.fieldMask)};else{if(!(t instanceof Di))return F(16599,{Vt:t.type});e={verify:Oi(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(n=>function(i,a){let c=a.transform;if(c instanceof De)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Ve)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof xe)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof dn)return{fieldPath:a.field.canonicalString(),increment:c.Ae};throw F(20930,{transform:a.transform})}(0,n))),t.precondition.isNone||(e.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:Qy(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:F(27497)}(r,t.precondition)),e}function yc(r,t){let e=t.currentDocument?function(i){return i.updateTime!==void 0?_t.updateTime(Vt(i.updateTime)):i.exists!==void 0?_t.exists(i.exists):_t.none()}(t.currentDocument):_t.none(),n=t.updateTransforms?t.updateTransforms.map(s=>function(a,c){let l=null;if("setToServerValue"in c)L(c.setToServerValue==="REQUEST_TIME",16630,{proto:c}),l=new De;else if("appendMissingElements"in c){let m=c.appendMissingElements.values||[];l=new Ve(m)}else if("removeAllFromArray"in c){let m=c.removeAllFromArray.values||[];l=new xe(m)}else"increment"in c?l=new dn(a,c.increment):F(16584,{proto:c});let d=dt.fromServerFormat(c.fieldPath);return new Ci(d,l)}(r,s)):[];if(t.update){t.update.name;let s=rn(r,t.update.name),i=new Dt({mapValue:{fields:t.update.fields}});if(t.updateMask){let a=function(l){let d=l.fieldPaths||[];return new Ft(d.map(m=>dt.fromServerFormat(m)))}(t.updateMask);return new Kt(s,i,a,e,n)}return new Ne(s,i,e,n)}if(t.delete){let s=rn(r,t.delete);return new fn(s,e)}if(t.verify){let s=rn(r,t.verify);return new Di(s,e)}return F(1463,{proto:t})}function Jy(r,t){return r&&r.length>0?(L(t!==void 0,14353),r.map(e=>function(s,i){let a=s.updateTime?Vt(s.updateTime):Vt(i);return a.isEqual(U.min())&&(a=Vt(i)),new ac(a,s.transformResults||[])}(e,t))):[]}function tm(r,t){return{documents:[Xf(r,t.path)]}}function $u(r,t){let e={structuredQuery:{}},n=t.path,s;t.collectionGroup!==null?(s=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=Xf(r,s);let i=function(d){if(d.length!==0)return rm(Z.create(d,"and"))}(t.filters);i&&(e.structuredQuery.where=i);let a=function(d){if(d.length!==0)return d.map(m=>function(y){return{field:Ie(y.field),direction:Zy(y.dir)}}(m))}(t.orderBy);a&&(e.structuredQuery.orderBy=a);let c=mc(r,t.limit);return c!==null&&(e.structuredQuery.limit=c),t.startAt&&(e.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(t.endAt)),{ft:e,parent:s}}function Xy(r,t,e,n){let{ft:s,parent:i}=$u(r,t),a={},c=[],l=0;return e.forEach(d=>{let m=n?d.alias:"aggregate_"+l++;a[m]=d.alias,d.aggregateType==="count"?c.push({alias:m,count:{}}):d.aggregateType==="avg"?c.push({alias:m,avg:{field:Ie(d.fieldPath)}}):d.aggregateType==="sum"&&c.push({alias:m,sum:{field:Ie(d.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:c,structuredQuery:s.structuredQuery},parent:s.parent},gt:a,parent:i}}function em(r){let t=Yf(r.parent),e=r.structuredQuery,n=e.from?e.from.length:0,s=null;if(n>0){L(n===1,65062);let m=e.from[0];m.allDescendants?s=m.collectionId:t=t.child(m.collectionId)}let i=[];e.where&&(i=function(p){let y=nm(p);return y instanceof Z&&qu(y)?y.getFilters():[y]}(e.where));let a=[];e.orderBy&&(a=function(p){return p.map(y=>function(C){return new ln(On(C.field),function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(C.direction))}(y))}(e.orderBy));let c=null;e.limit&&(c=function(p){let y;return y=typeof p=="object"?p.value:p,po(y)?null:y}(e.limit));let l=null;e.startAt&&(l=function(p){let y=!!p.before,S=p.values||[];return new Yt(S,y)}(e.startAt));let d=null;return e.endAt&&(d=function(p){let y=!p.before,S=p.values||[];return new Yt(S,y)}(e.endAt)),by(t,s,a,i,c,"F",l,d)}function Yy(r,t){let e=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return F(28987,{purpose:s})}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function nm(r){return r.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let n=On(e.unaryFilter.field);return K.create(n,"==",{doubleValue:NaN});case"IS_NULL":let s=On(e.unaryFilter.field);return K.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let i=On(e.unaryFilter.field);return K.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=On(e.unaryFilter.field);return K.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return F(61313);default:return F(60726)}}(r):r.fieldFilter!==void 0?function(e){return K.create(On(e.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return F(58110);default:return F(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(e){return Z.create(e.compositeFilter.filters.map(n=>nm(n)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return F(1026)}}(e.compositeFilter.op))}(r):F(30097,{filter:r})}function Zy(r){return Gy[r]}function t_(r){return $y[r]}function e_(r){return Ky[r]}function Ie(r){return{fieldPath:r.canonicalString()}}function On(r){return dt.fromServerFormat(r.fieldPath)}function rm(r){return r instanceof K?function(e){if(e.op==="=="){if(id(e.value))return{unaryFilter:{field:Ie(e.field),op:"IS_NAN"}};if(sd(e.value))return{unaryFilter:{field:Ie(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(id(e.value))return{unaryFilter:{field:Ie(e.field),op:"IS_NOT_NAN"}};if(sd(e.value))return{unaryFilter:{field:Ie(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ie(e.field),op:t_(e.op),value:e.value}}}(r):r instanceof Z?function(e){let n=e.getFilters().map(s=>rm(s));return n.length===1?n[0]:{compositeFilter:{op:e_(e.op),filters:n}}}(r):F(54877,{filter:r})}function n_(r){let t=[];return r.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function sm(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}var nr=class r{constructor(t,e,n,s,i=U.min(),a=U.min(),c=mt.EMPTY_BYTE_STRING,l=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=l}withSequenceNumber(t){return new r(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var Fi=class{constructor(t){this.yt=t}};function r_(r,t){let e;if(t.document)e=Wy(r.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let n=M.fromSegments(t.noDocument.path),s=pn(t.noDocument.readTime);e=Et.newNoDocument(n,s),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return F(56709);{let n=M.fromSegments(t.unknownDocument.path),s=pn(t.unknownDocument.version);e=Et.newUnknownDocument(n,s)}}return t.readTime&&e.setReadTime(function(s){let i=new it(s[0],s[1]);return U.fromTimestamp(i)}(t.readTime)),e}function Id(r,t){let e=t.key,n={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:Li(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=function(i,a){return{name:Oi(i,a.key),fields:a.data.value.mapValue.fields,updateTime:er(i,a.version.toTimestamp()),createTime:er(i,a.createTime.toTimestamp())}}(r.yt,t);else if(t.isNoDocument())n.noDocument={path:e.path.toArray(),readTime:mn(t.version)};else{if(!t.isUnknownDocument())return F(57904,{document:t});n.unknownDocument={path:e.path.toArray(),version:mn(t.version)}}return n}function Li(r){let t=r.toTimestamp();return[t.seconds,t.nanoseconds]}function mn(r){let t=r.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function pn(r){let t=new it(r.seconds,r.nanoseconds);return U.fromTimestamp(t)}function We(r,t){let e=(t.baseMutations||[]).map(i=>yc(r.yt,i));for(let i=0;i<t.mutations.length-1;++i){let a=t.mutations[i];if(i+1<t.mutations.length&&t.mutations[i+1].transform!==void 0){let c=t.mutations[i+1];a.updateTransforms=c.transform.fieldTransforms,t.mutations.splice(i+1,1),++i}}let n=t.mutations.map(i=>yc(r.yt,i)),s=it.fromMillis(t.localWriteTimeMs);return new us(t.batchId,s,e,n)}function $r(r){let t=pn(r.readTime),e=r.lastLimboFreeSnapshotVersion!==void 0?pn(r.lastLimboFreeSnapshotVersion):U.min(),n;return n=function(i){return i.documents!==void 0}(r.query)?function(i){let a=i.documents.length;return L(a===1,1966,{count:a}),Ut(vs(Yf(i.documents[0])))}(r.query):function(i){return Ut(em(i))}(r.query),new nr(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,t,e,mt.fromBase64String(r.resumeToken))}function im(r,t){let e=mn(t.snapshotVersion),n=mn(t.lastLimboFreeSnapshotVersion),s;s=Si(t.target)?tm(r.yt,t.target):$u(r.yt,t.target).ft;let i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:hn(t.target),readTime:e,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:s}}function om(r){let t=em({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Pi(t,t.limit,"L"):t}function ba(r,t){return new ls(t.largestBatchId,yc(r.yt,t.overlayMutation))}function vd(r,t){let e=t.path.lastSegment();return[r,St(t.path.popLast()),e]}function Td(r,t,e,n){return{indexId:r,uid:t,sequenceNumber:e,readTime:mn(n.readTime),documentKey:St(n.documentKey.path),largestBatchId:n.largestBatchId}}var _c=class{getBundleMetadata(t,e){return Ad(t).get(e).next(n=>{if(n)return function(i){return{id:i.bundleId,createTime:pn(i.createTime),version:i.version}}(n)})}saveBundleMetadata(t,e){return Ad(t).put(function(s){return{bundleId:s.id,createTime:mn(Vt(s.createTime)),version:s.version}}(e))}getNamedQuery(t,e){return bd(t).get(e).next(n=>{if(n)return function(i){return{name:i.name,query:om(i.bundledQuery),readTime:pn(i.readTime)}}(n)})}saveNamedQuery(t,e){return bd(t).put(function(s){return{name:s.name,readTime:mn(Vt(s.readTime)),bundledQuery:s.bundledQuery}}(e))}};function Ad(r){return pt(r,go)}function bd(r){return pt(r,yo)}var Bi=class r{constructor(t,e){this.serializer=t,this.userId=e}static wt(t,e){let n=e.uid||"";return new r(t,n)}getOverlay(t,e){return Ur(t).get(vd(this.userId,e)).next(n=>n?ba(this.serializer,n):null)}getOverlays(t,e){let n=Ht();return b.forEach(e,s=>this.getOverlay(t,s).next(i=>{i!==null&&n.set(s,i)})).next(()=>n)}saveOverlays(t,e,n){let s=[];return n.forEach((i,a)=>{let c=new ls(e,a);s.push(this.St(t,c))}),b.waitFor(s)}removeOverlaysForBatchId(t,e,n){let s=new Set;e.forEach(a=>s.add(St(a.getCollectionPath())));let i=[];return s.forEach(a=>{let c=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);i.push(Ur(t).Z(Ka,c))}),b.waitFor(i)}getOverlaysForCollection(t,e,n){let s=Ht(),i=St(e),a=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Ur(t).J(Ka,a).next(c=>{for(let l of c){let d=ba(this.serializer,l);s.set(d.getKey(),d)}return s})}getOverlaysForCollectionGroup(t,e,n,s){let i=Ht(),a,c=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return Ur(t).ee({index:gf,range:c},(l,d,m)=>{let p=ba(this.serializer,d);i.size()<s||p.largestBatchId===a?(i.set(p.getKey(),p),a=p.largestBatchId):m.done()}).next(()=>i)}St(t,e){return Ur(t).put(function(s,i,a){let[c,l,d]=vd(i,a.mutation.key);return{userId:i,collectionPath:l,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Mi(s.yt,a.mutation)}}(this.serializer,this.userId,e))}};function Ur(r){return pt(r,_o)}var wc=class{bt(t){return pt(t,Fu)}getSessionToken(t){return this.bt(t).get("sessionToken").next(e=>{let n=e?.value;return n?mt.fromUint8Array(n):mt.EMPTY_BYTE_STRING})}setSessionToken(t,e){return this.bt(t).put({name:"sessionToken",value:e.toUint8Array()})}};var ce=class{constructor(){}Dt(t,e){this.Ct(t,e),e.vt()}Ct(t,e){if("nullValue"in t)this.Ft(e,5);else if("booleanValue"in t)this.Ft(e,10),e.Mt(t.booleanValue?1:0);else if("integerValue"in t)this.Ft(e,15),e.Mt(st(t.integerValue));else if("doubleValue"in t){let n=st(t.doubleValue);isNaN(n)?this.Ft(e,13):(this.Ft(e,15),es(n)?e.Mt(0):e.Mt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Ft(e,20),typeof n=="string"&&(n=ue(n)),e.xt(`${n.seconds||""}`),e.Mt(n.nanos||0)}else if("stringValue"in t)this.Ot(t.stringValue,e),this.Nt(e);else if("bytesValue"in t)this.Ft(e,30),e.Bt(le(t.bytesValue)),this.Nt(e);else if("referenceValue"in t)this.Lt(t.referenceValue,e);else if("geoPointValue"in t){let n=t.geoPointValue;this.Ft(e,45),e.Mt(n.latitude||0),e.Mt(n.longitude||0)}else"mapValue"in t?Rf(t)?this.Ft(e,Number.MAX_SAFE_INTEGER):Io(t)?this.kt(t.mapValue,e):(this.qt(t.mapValue,e),this.Nt(e)):"arrayValue"in t?(this.Qt(t.arrayValue,e),this.Nt(e)):F(19022,{$t:t})}Ot(t,e){this.Ft(e,25),this.Ut(t,e)}Ut(t,e){e.xt(t)}qt(t,e){let n=t.fields||{};this.Ft(e,55);for(let s of Object.keys(n))this.Ot(s,e),this.Ct(n[s],e)}kt(t,e){let n=t.fields||{};this.Ft(e,53);let s=Jn,i=n[s].arrayValue?.values?.length||0;this.Ft(e,15),e.Mt(st(i)),this.Ot(s,e),this.Ct(n[s],e)}Qt(t,e){let n=t.values||[];this.Ft(e,50);for(let s of n)this.Ct(s,e)}Lt(t,e){this.Ft(e,37),M.fromName(t).path.forEach(n=>{this.Ft(e,60),this.Ut(n,e)})}Ft(t,e){t.Mt(e)}Nt(t){t.Mt(2)}};ce.Kt=new ce;var Cn=255;function s_(r){if(r===0)return 8;let t=0;return r>>4||(t+=4,r<<=4),r>>6||(t+=2,r<<=2),r>>7||(t+=1),t}function Sd(r){let t=64-function(n){let s=0;for(let i=0;i<8;++i){let a=s_(255&n[i]);if(s+=a,a!==8)break}return s}(r);return Math.ceil(t/8)}var Ec=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.Gt(n.value),n=e.next();this.zt()}jt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.Jt(n.value),n=e.next();this.Ht()}Yt(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.Gt(n);else if(n<2048)this.Gt(960|n>>>6),this.Gt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Gt(480|n>>>12),this.Gt(128|63&n>>>6),this.Gt(128|63&n);else{let s=e.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.Jt(n);else if(n<2048)this.Jt(960|n>>>6),this.Jt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Jt(480|n>>>12),this.Jt(128|63&n>>>6),this.Jt(128|63&n);else{let s=e.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(t){let e=this.en(t),n=Sd(e);this.tn(1+n),this.buffer[this.position++]=255&n;for(let s=e.length-n;s<e.length;++s)this.buffer[this.position++]=255&e[s]}nn(t){let e=this.en(t),n=Sd(e);this.tn(1+n),this.buffer[this.position++]=~(255&n);for(let s=e.length-n;s<e.length;++s)this.buffer[this.position++]=~(255&e[s])}rn(){this.sn(Cn),this.sn(255)}_n(){this.an(Cn),this.an(255)}reset(){this.position=0}seed(t){this.tn(t.length),this.buffer.set(t,this.position),this.position+=t.length}un(){return this.buffer.slice(0,this.position)}en(t){let e=function(i){let a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,i,!1),new Uint8Array(a.buffer)}(t),n=!!(128&e[0]);e[0]^=n?255:128;for(let s=1;s<e.length;++s)e[s]^=n?255:0;return e}Gt(t){let e=255&t;e===0?(this.sn(0),this.sn(255)):e===Cn?(this.sn(Cn),this.sn(0)):this.sn(e)}Jt(t){let e=255&t;e===0?(this.an(0),this.an(255)):e===Cn?(this.an(Cn),this.an(0)):this.an(t)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(t){this.tn(1),this.buffer[this.position++]=t}an(t){this.tn(1),this.buffer[this.position++]=~t}tn(t){let e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);let s=new Uint8Array(n);s.set(this.buffer),this.buffer=s}},Ic=class{constructor(t){this.cn=t}Bt(t){this.cn.Wt(t)}xt(t){this.cn.Yt(t)}Mt(t){this.cn.Xt(t)}vt(){this.cn.rn()}},vc=class{constructor(t){this.cn=t}Bt(t){this.cn.jt(t)}xt(t){this.cn.Zt(t)}Mt(t){this.cn.nn(t)}vt(){this.cn._n()}},He=class{constructor(){this.cn=new Ec,this.ln=new Ic(this.cn),this.hn=new vc(this.cn)}seed(t){this.cn.seed(t)}Pn(t){return t===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}};var Je=class r{constructor(t,e,n,s){this.Tn=t,this.In=e,this.En=n,this.dn=s}An(){let t=this.dn.length,e=t===0||this.dn[t-1]===255?t+1:t,n=new Uint8Array(e);return n.set(this.dn,0),e!==t?n.set([0],this.dn.length):++n[n.length-1],new r(this.Tn,this.In,this.En,n)}Rn(t,e,n){return{indexId:this.Tn,uid:t,arrayValue:hi(this.En),directionalValue:hi(this.dn),orderedDocumentKey:hi(e),documentKey:n.path.toArray()}}Vn(t,e,n){let s=this.Rn(t,e,n);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}};function _e(r,t){let e=r.Tn-t.Tn;return e!==0?e:(e=Rd(r.En,t.En),e!==0?e:(e=Rd(r.dn,t.dn),e!==0?e:M.comparator(r.In,t.In)))}function Rd(r,t){for(let e=0;e<r.length&&e<t.length;++e){let n=r[e]-t[e];if(n!==0)return n}return r.length-t.length}function hi(r){return ra()?function(e){let n="";for(let s=0;s<e.length;s++)n+=String.fromCharCode(e[s]);return n}(r):r}function Pd(r){return typeof r!="string"?r:function(e){let n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n}(r)}var Ui=class{constructor(t){this.mn=new tt((e,n)=>dt.comparator(e.field,n.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.fn=t.orderBy,this.gn=[];for(let e of t.filters){let n=e;n.isInequality()?this.mn=this.mn.add(n):this.gn.push(n)}}get pn(){return this.mn.size>1}yn(t){if(L(t.collectionGroup===this.collectionId,49279),this.pn)return!1;let e=Ba(t);if(e!==void 0&&!this.wn(e))return!1;let n=$e(t),s=new Set,i=0,a=0;for(;i<n.length&&this.wn(n[i]);++i)s=s.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.mn.size>0){let c=this.mn.getIterator().getNext();if(!s.has(c.field.canonicalString())){let l=n[i];if(!this.Sn(c,l)||!this.bn(this.fn[a++],l))return!1}++i}for(;i<n.length;++i){let c=n[i];if(a>=this.fn.length||!this.bn(this.fn[a++],c))return!1}return!0}Dn(){if(this.pn)return null;let t=new tt(dt.comparator),e=[];for(let n of this.gn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")e.push(new Ln(n.field,2));else{if(t.has(n.field))continue;t=t.add(n.field),e.push(new Ln(n.field,0))}for(let n of this.fn)n.field.isKeyField()||t.has(n.field)||(t=t.add(n.field),e.push(new Ln(n.field,n.dir==="asc"?0:1)));return new zn(zn.UNKNOWN_ID,this.collectionId,e,ts.empty())}wn(t){for(let e of this.gn)if(this.Sn(e,t))return!0;return!1}Sn(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;let n=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===n}bn(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}};function am(r){if(L(r instanceof K||r instanceof Z,20012),r instanceof K){if(r instanceof bi){let e=r.value.arrayValue?.values?.map(n=>K.create(r.field,"==",n))||[];return Z.create(e,"or")}return r}let t=r.filters.map(e=>am(e));return Z.create(t,r.op)}function i_(r){if(r.getFilters().length===0)return[];let t=bc(am(r));return L(cm(t),7391),Tc(t)||Ac(t)?[t]:t.getFilters()}function Tc(r){return r instanceof K}function Ac(r){return r instanceof Z&&qu(r)}function cm(r){return Tc(r)||Ac(r)||function(e){if(e instanceof Z&&Ja(e)){for(let n of e.getFilters())if(!Tc(n)&&!Ac(n))return!1;return!0}return!1}(r)}function bc(r){if(L(r instanceof K||r instanceof Z,34018),r instanceof K)return r;if(r.filters.length===1)return bc(r.filters[0]);let t=r.filters.map(n=>bc(n)),e=Z.create(t,r.op);return e=qi(e),cm(e)?e:(L(e instanceof Z,64498),L(Yn(e),40251),L(e.filters.length>1,57927),e.filters.reduce((n,s)=>Ku(n,s)))}function Ku(r,t){let e;return L(r instanceof K||r instanceof Z,38388),L(t instanceof K||t instanceof Z,25473),e=r instanceof K?t instanceof K?function(s,i){return Z.create([s,i],"and")}(r,t):Cd(r,t):t instanceof K?Cd(t,r):function(s,i){if(L(s.filters.length>0&&i.filters.length>0,48005),Yn(s)&&Yn(i))return xf(s,i.getFilters());let a=Ja(s)?s:i,c=Ja(s)?i:s,l=a.filters.map(d=>Ku(d,c));return Z.create(l,"or")}(r,t),qi(e)}function Cd(r,t){if(Yn(t))return xf(t,r.getFilters());{let e=t.filters.map(n=>Ku(r,n));return Z.create(e,"or")}}function qi(r){if(L(r instanceof K||r instanceof Z,11850),r instanceof K)return r;let t=r.getFilters();if(t.length===1)return qi(t[0]);if(Df(r))return r;let e=t.map(s=>qi(s)),n=[];return e.forEach(s=>{s instanceof K?n.push(s):s instanceof Z&&(s.op===r.op?n.push(...s.filters):n.push(s))}),n.length===1?n[0]:Z.create(n,r.op)}var Sc=class{constructor(){this.Cn=new ds}addToCollectionParentIndex(t,e){return this.Cn.add(e),b.resolve()}getCollectionParents(t,e){return b.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return b.resolve()}deleteFieldIndex(t,e){return b.resolve()}deleteAllFieldIndexes(t){return b.resolve()}createTargetIndexes(t,e){return b.resolve()}getDocumentsMatchingTarget(t,e){return b.resolve(null)}getIndexType(t,e){return b.resolve(0)}getFieldIndexes(t,e){return b.resolve([])}getNextCollectionGroupToUpdate(t){return b.resolve(null)}getMinOffset(t,e){return b.resolve(qt.min())}getMinOffsetFromCollectionGroup(t,e){return b.resolve(qt.min())}updateCollectionGroup(t,e,n){return b.resolve()}updateIndexEntries(t,e){return b.resolve()}},ds=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new tt(Y.comparator),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){let e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new tt(Y.comparator)).toArray()}};var Dd="IndexedDbIndexManager",ei=new Uint8Array(0),Rc=class{constructor(t,e){this.databaseId=e,this.vn=new ds,this.Fn=new $t(n=>hn(n),(n,s)=>Is(n,s)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.vn.has(e)){let n=e.lastSegment(),s=e.popLast();t.addOnCommittedListener(()=>{this.vn.add(e)});let i={collectionId:n,parent:St(s)};return Vd(t).put(i)}return b.resolve()}getCollectionParents(t,e){let n=[],s=IDBKeyRange.bound([e,""],[sf(e),""],!1,!0);return Vd(t).J(s).next(i=>{for(let a of i){if(a.collectionId!==e)break;n.push(Wt(a.parent))}return n})}addFieldIndex(t,e){let n=qr(t),s=function(c){return{indexId:c.indexId,collectionGroup:c.collectionGroup,fields:c.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(e);delete s.indexId;let i=n.add(s);if(e.indexState){let a=Vn(t);return i.next(c=>{a.put(Td(c,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return i.next()}deleteFieldIndex(t,e){let n=qr(t),s=Vn(t),i=Dn(t);return n.delete(e.indexId).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){let e=qr(t),n=Dn(t),s=Vn(t);return e.Z().next(()=>n.Z()).next(()=>s.Z())}createTargetIndexes(t,e){return b.forEach(this.Mn(e),n=>this.getIndexType(t,n).next(s=>{if(s===0||s===1){let i=new Ui(n).Dn();if(i!=null)return this.addFieldIndex(t,i)}}))}getDocumentsMatchingTarget(t,e){let n=Dn(t),s=!0,i=new Map;return b.forEach(this.Mn(e),a=>this.xn(t,a).next(c=>{s&&(s=!!c),i.set(a,c)})).next(()=>{if(s){let a=$(),c=[];return b.forEach(i,(l,d)=>{N(Dd,`Using index ${function(B){return`id=${B.indexId}|cg=${B.collectionGroup}|f=${B.fields.map(X=>`${X.fieldPath}:${X.kind}`).join(",")}`}(l)} to execute ${hn(e)}`);let m=function(B,X){let et=Ba(X);if(et===void 0)return null;for(let H of Ri(B,et.fieldPath))switch(H.op){case"array-contains-any":return H.value.arrayValue.values||[];case"array-contains":return[H.value]}return null}(d,l),p=function(B,X){let et=new Map;for(let H of $e(X))for(let E of Ri(B,H.fieldPath))switch(E.op){case"==":case"in":et.set(H.fieldPath.canonicalString(),E.value);break;case"not-in":case"!=":return et.set(H.fieldPath.canonicalString(),E.value),Array.from(et.values())}return null}(d,l),y=function(B,X){let et=[],H=!0;for(let E of $e(X)){let g=E.kind===0?ld(B,E.fieldPath,B.startAt):hd(B,E.fieldPath,B.startAt);et.push(g.value),H&&(H=g.inclusive)}return new Yt(et,H)}(d,l),S=function(B,X){let et=[],H=!0;for(let E of $e(X)){let g=E.kind===0?hd(B,E.fieldPath,B.endAt):ld(B,E.fieldPath,B.endAt);et.push(g.value),H&&(H=g.inclusive)}return new Yt(et,H)}(d,l),C=this.On(l,d,y),k=this.On(l,d,S),D=this.Nn(l,d,p),G=this.Bn(l.indexId,m,C,y.inclusive,k,S.inclusive,D);return b.forEach(G,q=>n.Y(q,e.limit).next(B=>{B.forEach(X=>{let et=M.fromSegments(X.documentKey);a.has(et)||(a=a.add(et),c.push(et))})}))}).next(()=>c)}return b.resolve(null)})}Mn(t){let e=this.Fn.get(t);return e||(t.filters.length===0?e=[t]:e=i_(Z.create(t.filters,"and")).map(n=>ic(t.path,t.collectionGroup,t.orderBy,n.getFilters(),t.limit,t.startAt,t.endAt)),this.Fn.set(t,e),e)}Bn(t,e,n,s,i,a,c){let l=(e!=null?e.length:1)*Math.max(n.length,i.length),d=l/(e!=null?e.length:1),m=[];for(let p=0;p<l;++p){let y=e?this.Ln(e[p/d]):ei,S=this.kn(t,y,n[p%d],s),C=this.qn(t,y,i[p%d],a),k=c.map(D=>this.kn(t,y,D,!0));m.push(...this.createRange(S,C,k))}return m}kn(t,e,n,s){let i=new Je(t,M.empty(),e,n);return s?i:i.An()}qn(t,e,n,s){let i=new Je(t,M.empty(),e,n);return s?i.An():i}xn(t,e){let n=new Ui(e),s=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,s).next(i=>{let a=null;for(let c of i)n.yn(c)&&(!a||c.fields.length>a.fields.length)&&(a=c);return a})}getIndexType(t,e){let n=2,s=this.Mn(e);return b.forEach(s,i=>this.xn(t,i).next(a=>{a?n!==0&&a.fields.length<function(l){let d=new tt(dt.comparator),m=!1;for(let p of l.filters)for(let y of p.getFlattenedFilters())y.field.isKeyField()||(y.op==="array-contains"||y.op==="array-contains-any"?m=!0:d=d.add(y.field));for(let p of l.orderBy)p.field.isKeyField()||(d=d.add(p.field));return d.size+(m?1:0)}(i)&&(n=1):n=0})).next(()=>function(a){return a.limit!==null}(e)&&s.length>1&&n===2?1:n)}Qn(t,e){let n=new He;for(let s of $e(t)){let i=e.data.field(s.fieldPath);if(i==null)return null;let a=n.Pn(s.kind);ce.Kt.Dt(i,a)}return n.un()}Ln(t){let e=new He;return ce.Kt.Dt(t,e.Pn(0)),e.un()}$n(t,e){let n=new He;return ce.Kt.Dt(un(this.databaseId,e),n.Pn(function(i){let a=$e(i);return a.length===0?0:a[a.length-1].kind}(t))),n.un()}Nn(t,e,n){if(n===null)return[];let s=[];s.push(new He);let i=0;for(let a of $e(t)){let c=n[i++];for(let l of s)if(this.Un(e,a.fieldPath)&&cs(c))s=this.Kn(s,a,c);else{let d=l.Pn(a.kind);ce.Kt.Dt(c,d)}}return this.Wn(s)}On(t,e,n){return this.Nn(t,e,n.position)}Wn(t){let e=[];for(let n=0;n<t.length;++n)e[n]=t[n].un();return e}Kn(t,e,n){let s=[...t],i=[];for(let a of n.arrayValue.values||[])for(let c of s){let l=new He;l.seed(c.un()),ce.Kt.Dt(a,l.Pn(e.kind)),i.push(l)}return i}Un(t,e){return!!t.filters.find(n=>n instanceof K&&n.field.isEqual(e)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(t,e){let n=qr(t),s=Vn(t);return(e?n.J($a,IDBKeyRange.bound(e,e)):n.J()).next(i=>{let a=[];return b.forEach(i,c=>s.get([c.indexId,this.uid]).next(l=>{a.push(function(m,p){let y=p?new ts(p.sequenceNumber,new qt(pn(p.readTime),new M(Wt(p.documentKey)),p.largestBatchId)):ts.empty(),S=m.fields.map(([C,k])=>new Ln(dt.fromServerFormat(C),k));return new zn(m.indexId,m.collectionGroup,S,y)}(c,l))})).next(()=>a)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((n,s)=>{let i=n.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:z(n.collectionGroup,s.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,n){let s=qr(t),i=Vn(t);return this.Gn(t).next(a=>s.J($a,IDBKeyRange.bound(e,e)).next(c=>b.forEach(c,l=>i.put(Td(l.indexId,this.uid,a,n)))))}updateIndexEntries(t,e){let n=new Map;return b.forEach(e,(s,i)=>{let a=n.get(s.collectionGroup);return(a?b.resolve(a):this.getFieldIndexes(t,s.collectionGroup)).next(c=>(n.set(s.collectionGroup,c),b.forEach(c,l=>this.zn(t,s,l).next(d=>{let m=this.jn(i,l);return d.isEqual(m)?b.resolve():this.Jn(t,i,l,d,m)}))))})}Hn(t,e,n,s){return Dn(t).put(s.Rn(this.uid,this.$n(n,e.key),e.key))}Yn(t,e,n,s){return Dn(t).delete(s.Vn(this.uid,this.$n(n,e.key),e.key))}zn(t,e,n){let s=Dn(t),i=new tt(_e);return s.ee({index:pf,range:IDBKeyRange.only([n.indexId,this.uid,hi(this.$n(n,e))])},(a,c)=>{i=i.add(new Je(n.indexId,e,Pd(c.arrayValue),Pd(c.directionalValue)))}).next(()=>i)}jn(t,e){let n=new tt(_e),s=this.Qn(e,t);if(s==null)return n;let i=Ba(e);if(i!=null){let a=t.data.field(i.fieldPath);if(cs(a))for(let c of a.arrayValue.values||[])n=n.add(new Je(e.indexId,t.key,this.Ln(c),s))}else n=n.add(new Je(e.indexId,t.key,ei,s));return n}Jn(t,e,n,s,i){N(Dd,"Updating index entries for document '%s'",e.key);let a=[];return function(l,d,m,p,y){let S=l.getIterator(),C=d.getIterator(),k=Pn(S),D=Pn(C);for(;k||D;){let G=!1,q=!1;if(k&&D){let B=m(k,D);B<0?q=!0:B>0&&(G=!0)}else k!=null?q=!0:G=!0;G?(p(D),D=Pn(C)):q?(y(k),k=Pn(S)):(k=Pn(S),D=Pn(C))}}(s,i,_e,c=>{a.push(this.Hn(t,e,n,c))},c=>{a.push(this.Yn(t,e,n,c))}),b.waitFor(a)}Gn(t){let e=1;return Vn(t).ee({index:mf,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,s,i)=>{i.done(),e=s.sequenceNumber+1}).next(()=>e)}createRange(t,e,n){n=n.sort((a,c)=>_e(a,c)).filter((a,c,l)=>!c||_e(a,l[c-1])!==0);let s=[];s.push(t);for(let a of n){let c=_e(a,t),l=_e(a,e);if(c===0)s[0]=t.An();else if(c>0&&l<0)s.push(a),s.push(a.An());else if(l>0)break}s.push(e);let i=[];for(let a=0;a<s.length;a+=2){if(this.Zn(s[a],s[a+1]))return[];let c=s[a].Vn(this.uid,ei,M.empty()),l=s[a+1].Vn(this.uid,ei,M.empty());i.push(IDBKeyRange.bound(c,l))}return i}Zn(t,e){return _e(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(xd)}getMinOffset(t,e){return b.mapArray(this.Mn(e),n=>this.xn(t,n).next(s=>s||F(44426))).next(xd)}};function Vd(r){return pt(r,ss)}function Dn(r){return pt(r,Wr)}function qr(r){return pt(r,Mu)}function Vn(r){return pt(r,Qr)}function xd(r){L(r.length!==0,28825);let t=r[0].indexState.offset,e=t.largestBatchId;for(let n=1;n<r.length;n++){let s=r[n].indexState.offset;Nu(s,t)<0&&(t=s),e<s.largestBatchId&&(e=s.largestBatchId)}return new qt(t.readTime,t.documentKey,e)}var Nd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},um=41943040,Nt=class r{static withCacheSize(t){return new r(t,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}};function lm(r,t,e){let n=r.store(zt),s=r.store($n),i=[],a=IDBKeyRange.only(e.batchId),c=0,l=n.ee({range:a},(m,p,y)=>(c++,y.delete()));i.push(l.next(()=>{L(c===1,47070,{batchId:e.batchId})}));let d=[];for(let m of e.mutations){let p=hf(t,m.key.path,e.batchId);i.push(s.delete(p)),d.push(m.key)}return b.waitFor(i).next(()=>d)}function ji(r){if(!r)return 0;let t;if(r.document)t=r.document;else if(r.unknownDocument)t=r.unknownDocument;else{if(!r.noDocument)throw F(14731);t=r.noDocument}return JSON.stringify(t).length}Nt.DEFAULT_COLLECTION_PERCENTILE=10,Nt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Nt.DEFAULT=new Nt(um,Nt.DEFAULT_COLLECTION_PERCENTILE,Nt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Nt.DISABLED=new Nt(-1,0,0);var zi=class r{constructor(t,e,n,s){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=s,this.Xn={}}static wt(t,e,n,s){L(t.uid!=="",64387);let i=t.isAuthenticated()?t.uid:"";return new r(i,e,n,s)}checkEmpty(t){let e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return we(t).ee({index:Xe,range:n},(s,i,a)=>{e=!1,a.done()}).next(()=>e)}addMutationBatch(t,e,n,s){let i=Mn(t),a=we(t);return a.add({}).next(c=>{L(typeof c=="number",49019);let l=new us(c,e,n,s),d=function(S,C,k){let D=k.baseMutations.map(q=>Mi(S.yt,q)),G=k.mutations.map(q=>Mi(S.yt,q));return{userId:C,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:D,mutations:G}}(this.serializer,this.userId,l),m=[],p=new tt((y,S)=>z(y.canonicalString(),S.canonicalString()));for(let y of s){let S=hf(this.userId,y.key.path,c);p=p.add(y.key.path.popLast()),m.push(a.put(d)),m.push(i.put(S,Jg))}return p.forEach(y=>{m.push(this.indexManager.addToCollectionParentIndex(t,y))}),t.addOnCommittedListener(()=>{this.Xn[c]=l.keys()}),b.waitFor(m).next(()=>l)})}lookupMutationBatch(t,e){return we(t).get(e).next(n=>n?(L(n.userId===this.userId,48,"Unexpected user for mutation batch",{userId:n.userId,batchId:e}),We(this.serializer,n)):null)}er(t,e){return this.Xn[e]?b.resolve(this.Xn[e]):this.lookupMutationBatch(t,e).next(n=>{if(n){let s=n.keys();return this.Xn[e]=s,s}return null})}getNextMutationBatchAfterBatchId(t,e){let n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]),i=null;return we(t).ee({index:Xe,range:s},(a,c,l)=>{c.userId===this.userId&&(L(c.batchId>=n,47524,{tr:n}),i=We(this.serializer,c)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(t){let e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=en;return we(t).ee({index:Xe,range:e,reverse:!0},(s,i,a)=>{n=i.batchId,a.done()}).next(()=>n)}getAllMutationBatches(t){let e=IDBKeyRange.bound([this.userId,en],[this.userId,Number.POSITIVE_INFINITY]);return we(t).J(Xe,e).next(n=>n.map(s=>We(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(t,e){let n=ii(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return Mn(t).ee({range:s},(a,c,l)=>{let[d,m,p]=a,y=Wt(m);if(d===this.userId&&e.path.isEqual(y))return we(t).get(p).next(S=>{if(!S)throw F(61480,{nr:a,batchId:p});L(S.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:S.userId,batchId:p}),i.push(We(this.serializer,S))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new tt(z),s=[];return e.forEach(i=>{let a=ii(this.userId,i.path),c=IDBKeyRange.lowerBound(a),l=Mn(t).ee({range:c},(d,m,p)=>{let[y,S,C]=d,k=Wt(S);y===this.userId&&i.path.isEqual(k)?n=n.add(C):p.done()});s.push(l)}),b.waitFor(s).next(()=>this.rr(t,n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,s=n.length+1,i=ii(this.userId,n),a=IDBKeyRange.lowerBound(i),c=new tt(z);return Mn(t).ee({range:a},(l,d,m)=>{let[p,y,S]=l,C=Wt(y);p===this.userId&&n.isPrefixOf(C)?C.length===s&&(c=c.add(S)):m.done()}).next(()=>this.rr(t,c))}rr(t,e){let n=[],s=[];return e.forEach(i=>{s.push(we(t).get(i).next(a=>{if(a===null)throw F(35274,{batchId:i});L(a.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:a.userId,batchId:i}),n.push(We(this.serializer,a))}))}),b.waitFor(s).next(()=>n)}removeMutationBatch(t,e){return lm(t.le,this.userId,e).next(n=>(t.addOnCommittedListener(()=>{this.ir(e.batchId)}),b.forEach(n,s=>this.referenceDelegate.markPotentiallyOrphaned(t,s))))}ir(t){delete this.Xn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return b.resolve();let n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),s=[];return Mn(t).ee({range:n},(i,a,c)=>{if(i[0]===this.userId){let l=Wt(i[1]);s.push(l)}else c.done()}).next(()=>{L(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(t,e){return hm(t,this.userId,e)}_r(t){return dm(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:en,lastStreamToken:""})}};function hm(r,t,e){let n=ii(t,e.path),s=n[1],i=IDBKeyRange.lowerBound(n),a=!1;return Mn(r).ee({range:i,X:!0},(c,l,d)=>{let[m,p,y]=c;m===t&&p===s&&(a=!0),d.done()}).next(()=>a)}function we(r){return pt(r,zt)}function Mn(r){return pt(r,$n)}function dm(r){return pt(r,ns)}var rr=class r{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new r(0)}static cr(){return new r(-1)}};var Pc=class{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.lr(t).next(e=>{let n=new rr(e.highestTargetId);return e.highestTargetId=n.next(),this.hr(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.lr(t).next(e=>U.fromTimestamp(new it(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.lr(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,n){return this.lr(t).next(s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.hr(t,s)))}addTargetData(t,e){return this.Pr(t,e).next(()=>this.lr(t).next(n=>(n.targetCount+=1,this.Tr(e,n),this.hr(t,n))))}updateTargetData(t,e){return this.Pr(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>xn(t).delete(e.targetId)).next(()=>this.lr(t)).next(n=>(L(n.targetCount>0,8065),n.targetCount-=1,this.hr(t,n)))}removeTargets(t,e,n){let s=0,i=[];return xn(t).ee((a,c)=>{let l=$r(c);l.sequenceNumber<=e&&n.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(t,l)))}).next(()=>b.waitFor(i)).next(()=>s)}forEachTarget(t,e){return xn(t).ee((n,s)=>{let i=$r(s);e(i)})}lr(t){return kd(t).get(Ei).next(e=>(L(e!==null,2888),e))}hr(t,e){return kd(t).put(Ei,e)}Pr(t,e){return xn(t).put(im(this.serializer,e))}Tr(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.lr(t).next(e=>e.targetCount)}getTargetData(t,e){let n=hn(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return xn(t).ee({range:s,index:ff},(a,c,l)=>{let d=$r(c);Is(e,d.target)&&(i=d,l.done())}).next(()=>i)}addMatchingKeys(t,e,n){let s=[],i=ve(t);return e.forEach(a=>{let c=St(a.path);s.push(i.put({targetId:n,path:c})),s.push(this.referenceDelegate.addReference(t,n,a))}),b.waitFor(s)}removeMatchingKeys(t,e,n){let s=ve(t);return b.forEach(e,i=>{let a=St(i.path);return b.waitFor([s.delete([n,a]),this.referenceDelegate.removeReference(t,n,i)])})}removeMatchingKeysForTargetId(t,e){let n=ve(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(t,e){let n=IDBKeyRange.bound([e],[e+1],!1,!0),s=ve(t),i=$();return s.ee({range:n,X:!0},(a,c,l)=>{let d=Wt(a[1]),m=new M(d);i=i.add(m)}).next(()=>i)}containsKey(t,e){let n=St(e.path),s=IDBKeyRange.bound([n],[sf(n)],!1,!0),i=0;return ve(t).ee({index:Ou,X:!0,range:s},([a,c],l,d)=>{a!==0&&(i++,d.done())}).next(()=>i>0)}At(t,e){return xn(t).get(e).next(n=>n?$r(n):null)}};function xn(r){return pt(r,Kn)}function kd(r){return pt(r,nn)}function ve(r){return pt(r,Qn)}var Od="LruGarbageCollector",o_=1048576;function Md([r,t],[e,n]){let s=z(r,e);return s===0?z(t,n):s}var Cc=class{constructor(t){this.Ir=t,this.buffer=new tt(Md),this.Er=0}dr(){return++this.Er}Ar(t){let e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{let n=this.buffer.last();Md(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}},Gi=class{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(t){N(Od,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>V(this,null,function*(){this.Rr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){Me(e)?N(Od,"Ignoring IndexedDB error during garbage collection: ",e):yield _n(e)}yield this.Vr(3e5)}))}},Dc=class{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next(n=>Math.floor(e/100*n))}nthSequenceNumber(t,e){if(e===0)return b.resolve(Gt.ce);let n=new Cc(e);return this.mr.forEachTarget(t,s=>n.Ar(s.sequenceNumber)).next(()=>this.mr.pr(t,s=>n.Ar(s))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.mr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(N("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(Nd)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Nd):this.yr(t,e))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let n,s,i,a,c,l,d,m=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(N("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),s=this.params.maximumSequenceNumbersToCollect):s=p,a=Date.now(),this.nthSequenceNumber(t,s))).next(p=>(n=p,c=Date.now(),this.removeTargets(t,n,e))).next(p=>(i=p,l=Date.now(),this.removeOrphanedDocuments(t,n))).next(p=>(d=Date.now(),Nn()<=Q.DEBUG&&N("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-m}ms
	Determined least recently used ${s} in `+(c-a)+`ms
	Removed ${i} targets in `+(l-c)+`ms
	Removed ${p} documents in `+(d-l)+`ms
Total Duration: ${d-m}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:p})))}};function fm(r,t){return new Dc(r,t)}var Vc=class{constructor(t,e){this.db=t,this.garbageCollector=fm(this,e)}gr(t){let e=this.wr(t);return this.db.getTargetCache().getTargetCount(t).next(n=>e.next(s=>n+s))}wr(t){let e=0;return this.pr(t,n=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}pr(t,e){return this.Sr(t,(n,s)=>e(s))}addReference(t,e,n){return ni(t,n)}removeReference(t,e,n){return ni(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return ni(t,e)}br(t,e){return function(s,i){let a=!1;return dm(s).te(c=>hm(s,c,i).next(l=>(l&&(a=!0),b.resolve(!l)))).next(()=>a)}(t,e)}removeOrphanedDocuments(t,e){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],i=0;return this.Sr(t,(a,c)=>{if(c<=e){let l=this.br(t,a).next(d=>{if(!d)return i++,n.getEntry(t,a).next(()=>(n.removeEntry(a,U.min()),ve(t).delete(function(p){return[0,St(p.path)]}(a))))});s.push(l)}}).next(()=>b.waitFor(s)).next(()=>n.apply(t)).next(()=>i)}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return ni(t,e)}Sr(t,e){let n=ve(t),s,i=Gt.ce;return n.ee({index:Ou},([a,c],{path:l,sequenceNumber:d})=>{a===0?(i!==Gt.ce&&e(new M(Wt(s)),i),i=d,s=l):i=Gt.ce}).next(()=>{i!==Gt.ce&&e(new M(Wt(s)),i)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}};function ni(r,t){return ve(r).put(function(n,s){return{targetId:0,path:St(n.path),sequenceNumber:s}}(t,r.currentSequenceNumber))}var $i=class{constructor(){this.changes=new $t(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Et.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let n=this.changes.get(e);return n!==void 0?b.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var xc=class{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return Ge(t).put(n)}removeEntry(t,e,n){return Ge(t).delete(function(i,a){let c=i.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],Li(a),c[c.length-1]]}(e,n))}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.Dr(t,n)))}getEntry(t,e){let n=Et.newInvalidDocument(e);return Ge(t).ee({index:oi,range:IDBKeyRange.only(jr(e))},(s,i)=>{n=this.Cr(e,i)}).next(()=>n)}vr(t,e){let n={size:0,document:Et.newInvalidDocument(e)};return Ge(t).ee({index:oi,range:IDBKeyRange.only(jr(e))},(s,i)=>{n={document:this.Cr(e,i),size:ji(i)}}).next(()=>n)}getEntries(t,e){let n=Lt();return this.Fr(t,e,(s,i)=>{let a=this.Cr(s,i);n=n.insert(s,a)}).next(()=>n)}Mr(t,e){let n=Lt(),s=new ot(M.comparator);return this.Fr(t,e,(i,a)=>{let c=this.Cr(i,a);n=n.insert(i,c),s=s.insert(i,ji(a))}).next(()=>({documents:n,Or:s}))}Fr(t,e,n){if(e.isEmpty())return b.resolve();let s=new tt(Bd);e.forEach(l=>s=s.add(l));let i=IDBKeyRange.bound(jr(s.first()),jr(s.last())),a=s.getIterator(),c=a.getNext();return Ge(t).ee({index:oi,range:i},(l,d,m)=>{let p=M.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;c&&Bd(c,p)<0;)n(c,null),c=a.getNext();c&&c.isEqual(p)&&(n(c,d),c=a.hasNext()?a.getNext():null),c?m.j(jr(c)):m.done()}).next(()=>{for(;c;)n(c,null),c=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(t,e,n,s,i){let a=e.path,c=[a.popLast().toArray(),a.lastSegment(),Li(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],l=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ge(t).J(IDBKeyRange.bound(c,l,!0)).next(d=>{i?.incrementDocumentReadCount(d.length);let m=Lt();for(let p of d){let y=this.Cr(M.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);y.isFoundDocument()&&(Ts(e,y)||s.has(y.key))&&(m=m.insert(y.key,y))}return m})}getAllFromCollectionGroup(t,e,n,s){let i=Lt(),a=Ld(e,n),c=Ld(e,qt.max());return Ge(t).ee({index:df,range:IDBKeyRange.bound(a,c,!0)},(l,d,m)=>{let p=this.Cr(M.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);i=i.insert(p.key,p),i.size===s&&m.done()}).next(()=>i)}newChangeBuffer(t){return new Nc(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return Fd(t).get(Ga).next(e=>(L(!!e,20021),e))}Dr(t,e){return Fd(t).put(Ga,e)}Cr(t,e){if(e){let n=r_(this.serializer,e);if(!(n.isNoDocument()&&n.version.isEqual(U.min())))return n}return Et.newInvalidDocument(t)}};function mm(r){return new xc(r)}var Nc=class extends $i{constructor(t,e){super(),this.Nr=t,this.trackRemovals=e,this.Br=new $t(n=>n.toString(),(n,s)=>n.isEqual(s))}applyChanges(t){let e=[],n=0,s=new tt((i,a)=>z(i.canonicalString(),a.canonicalString()));return this.changes.forEach((i,a)=>{let c=this.Br.get(i);if(e.push(this.Nr.removeEntry(t,i,c.readTime)),a.isValidDocument()){let l=Id(this.Nr.serializer,a);s=s.add(i.path.popLast());let d=ji(l);n+=d-c.size,e.push(this.Nr.addEntry(t,i,l))}else if(n-=c.size,this.trackRemovals){let l=Id(this.Nr.serializer,a.convertToNoDocument(U.min()));e.push(this.Nr.addEntry(t,i,l))}}),s.forEach(i=>{e.push(this.Nr.indexManager.addToCollectionParentIndex(t,i))}),e.push(this.Nr.updateMetadata(t,n)),b.waitFor(e)}getFromCache(t,e){return this.Nr.vr(t,e).next(n=>(this.Br.set(e,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(t,e){return this.Nr.Mr(t,e).next(({documents:n,Or:s})=>(s.forEach((i,a)=>{this.Br.set(i,{size:a,readTime:n.get(i).readTime})}),n))}};function Fd(r){return pt(r,rs)}function Ge(r){return pt(r,wi)}function jr(r){let t=r.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Ld(r,t){let e=t.documentKey.path.toArray();return[r,Li(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function Bd(r,t){let e=r.path.toArray(),n=t.path.toArray(),s=0;for(let i=0;i<e.length-2&&i<n.length-2;++i)if(s=z(e[i],n[i]),s)return s;return s=z(e.length,n.length),s||(s=z(e[e.length-2],n[n.length-2]),s||z(e[e.length-1],n[n.length-1]))}var kc=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var Ki=class{constructor(t,e,n,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=s}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(s=>(n=s,this.remoteDocumentCache.getEntry(t,e))).next(s=>(n!==null&&Xr(n.mutation,s,Ft.empty(),it.now()),s))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.getLocalViewOfDocuments(t,n,$()).next(()=>n))}getLocalViewOfDocuments(t,e,n=$()){let s=Ht();return this.populateOverlays(t,s,e).next(()=>this.computeViews(t,e,s,n).next(i=>{let a=Gr();return i.forEach((c,l)=>{a=a.insert(c,l.overlayedDocument)}),a}))}getOverlayedDocuments(t,e){let n=Ht();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,$()))}populateOverlays(t,e,n){let s=[];return n.forEach(i=>{e.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(t,s).next(i=>{i.forEach((a,c)=>{e.set(a,c)})})}computeViews(t,e,n,s){let i=Lt(),a=Jr(),c=function(){return Jr()}();return e.forEach((l,d)=>{let m=n.get(d.key);s.has(d.key)&&(m===void 0||m.mutation instanceof Kt)?i=i.insert(d.key,d):m!==void 0?(a.set(d.key,m.mutation.getFieldMask()),Xr(m.mutation,d,m.mutation.getFieldMask(),it.now())):a.set(d.key,Ft.empty())}),this.recalculateAndSaveOverlays(t,i).next(l=>(l.forEach((d,m)=>a.set(d,m)),e.forEach((d,m)=>c.set(d,new kc(m,a.get(d)??null))),c))}recalculateAndSaveOverlays(t,e){let n=Jr(),s=new ot((a,c)=>a-c),i=$();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(a=>{for(let c of a)c.keys().forEach(l=>{let d=e.get(l);if(d===null)return;let m=n.get(l)||Ft.empty();m=c.applyToLocalView(d,m),n.set(l,m);let p=(s.get(c.batchId)||$()).add(l);s=s.insert(c.batchId,p)})}).next(()=>{let a=[],c=s.getReverseIterator();for(;c.hasNext();){let l=c.getNext(),d=l.key,m=l.value,p=Uf();m.forEach(y=>{if(!i.has(y)){let S=Kf(e.get(y),n.get(y));S!==null&&p.set(y,S),i=i.add(y)}}),a.push(this.documentOverlayCache.saveOverlays(t,d,p))}return b.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.recalculateAndSaveOverlays(t,n))}getDocumentsMatchingQuery(t,e,n,s){return function(a){return M.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):ju(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,s):this.getDocumentsMatchingCollectionQuery(t,e,n,s)}getNextDocuments(t,e,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,s).next(i=>{let a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,s-i.size):b.resolve(Ht()),c=Zr,l=i;return a.next(d=>b.forEach(d,(m,p)=>(c<p.largestBatchId&&(c=p.largestBatchId),i.get(m)?b.resolve():this.remoteDocumentCache.getEntry(t,m).next(y=>{l=l.insert(m,y)}))).next(()=>this.populateOverlays(t,d,i)).next(()=>this.computeViews(t,l,d,$())).next(m=>({batchId:c,changes:Bf(m)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new M(e)).next(n=>{let s=Gr();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s})}getDocumentsMatchingCollectionGroupQuery(t,e,n,s){let i=e.collectionGroup,a=Gr();return this.indexManager.getCollectionParents(t,i).next(c=>b.forEach(c,l=>{let d=function(p,y){return new he(y,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(e,l.child(i));return this.getDocumentsMatchingCollectionQuery(t,d,n,s).next(m=>{m.forEach((p,y)=>{a=a.insert(p,y)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,e,n,s){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,s))).next(a=>{i.forEach((l,d)=>{let m=d.getKey();a.get(m)===null&&(a=a.insert(m,Et.newInvalidDocument(m)))});let c=Gr();return a.forEach((l,d)=>{let m=i.get(l);m!==void 0&&Xr(m.mutation,d,Ft.empty(),it.now()),Ts(e,d)&&(c=c.insert(l,d))}),c})}};var Oc=class{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return b.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,function(s){return{id:s.id,version:s.version,createTime:Vt(s.createTime)}}(e)),b.resolve()}getNamedQuery(t,e){return b.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,function(s){return{name:s.name,query:om(s.bundledQuery),readTime:Vt(s.readTime)}}(e)),b.resolve()}};var Mc=class{constructor(){this.overlays=new ot(M.comparator),this.qr=new Map}getOverlay(t,e){return b.resolve(this.overlays.get(e))}getOverlays(t,e){let n=Ht();return b.forEach(e,s=>this.getOverlay(t,s).next(i=>{i!==null&&n.set(s,i)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((s,i)=>{this.St(t,e,i)}),b.resolve()}removeOverlaysForBatchId(t,e,n){let s=this.qr.get(n);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(n)),b.resolve()}getOverlaysForCollection(t,e,n){let s=Ht(),i=e.length+1,a=new M(e.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){let l=c.getNext().value,d=l.getKey();if(!e.isPrefixOf(d.path))break;d.path.length===i&&l.largestBatchId>n&&s.set(l.getKey(),l)}return b.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let i=new ot((d,m)=>d-m),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>n){let m=i.get(d.largestBatchId);m===null&&(m=Ht(),i=i.insert(d.largestBatchId,m)),m.set(d.getKey(),d)}}let c=Ht(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,m)=>c.set(d,m)),!(c.size()>=s)););return b.resolve(c)}St(t,e,n){let s=this.overlays.get(n.key);if(s!==null){let a=this.qr.get(s.largestBatchId).delete(n.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new ls(e,n));let i=this.qr.get(e);i===void 0&&(i=$(),this.qr.set(e,i)),this.qr.set(e,i.add(n.key))}};var Fc=class{constructor(){this.sessionToken=mt.EMPTY_BYTE_STRING}getSessionToken(t){return b.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,b.resolve()}};var fs=class{constructor(){this.Qr=new tt(ut.$r),this.Ur=new tt(ut.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){let n=new ut(t,e);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(t,e){t.forEach(n=>this.addReference(n,e))}removeReference(t,e){this.Gr(new ut(t,e))}zr(t,e){t.forEach(n=>this.removeReference(n,e))}jr(t){let e=new M(new Y([])),n=new ut(e,t),s=new ut(e,t+1),i=[];return this.Ur.forEachInRange([n,s],a=>{this.Gr(a),i.push(a.key)}),i}Jr(){this.Qr.forEach(t=>this.Gr(t))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){let e=new M(new Y([])),n=new ut(e,t),s=new ut(e,t+1),i=$();return this.Ur.forEachInRange([n,s],a=>{i=i.add(a.key)}),i}containsKey(t){let e=new ut(t,0),n=this.Qr.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}},ut=class{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return M.comparator(t.key,e.key)||z(t.Yr,e.Yr)}static Kr(t,e){return z(t.Yr,e.Yr)||M.comparator(t.key,e.key)}};var Lc=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new tt(ut.$r)}checkEmpty(t){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,s){let i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new us(i,e,n,s);this.mutationQueue.push(a);for(let c of s)this.Zr=this.Zr.add(new ut(c.key,i)),this.indexManager.addToCollectionParentIndex(t,c.key.path.popLast());return b.resolve(a)}lookupMutationBatch(t,e){return b.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){let n=e+1,s=this.ei(n),i=s<0?0:s;return b.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?en:this.tr-1)}getAllMutationBatches(t){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let n=new ut(e,0),s=new ut(e,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([n,s],a=>{let c=this.Xr(a.Yr);i.push(c)}),b.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new tt(z);return e.forEach(s=>{let i=new ut(s,0),a=new ut(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,a],c=>{n=n.add(c.Yr)})}),b.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,s=n.length+1,i=n;M.isDocumentKey(i)||(i=i.child(""));let a=new ut(new M(i),0),c=new tt(z);return this.Zr.forEachWhile(l=>{let d=l.key.path;return!!n.isPrefixOf(d)&&(d.length===s&&(c=c.add(l.Yr)),!0)},a),b.resolve(this.ti(c))}ti(t){let e=[];return t.forEach(n=>{let s=this.Xr(n);s!==null&&e.push(s)}),e}removeMutationBatch(t,e){L(this.ni(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Zr;return b.forEach(e.mutations,s=>{let i=new ut(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)}).next(()=>{this.Zr=n})}ir(t){}containsKey(t,e){let n=new ut(e,0),s=this.Zr.firstAfterOrEqual(n);return b.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,b.resolve()}ni(t,e){return this.ei(t)}ei(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Xr(t){let e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var Bc=class{constructor(t){this.ri=t,this.docs=function(){return new ot(M.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let n=e.key,s=this.docs.get(n),i=s?s.size:0,a=this.ri(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let n=this.docs.get(e);return b.resolve(n?n.document.mutableCopy():Et.newInvalidDocument(e))}getEntries(t,e){let n=Lt();return e.forEach(s=>{let i=this.docs.get(s);n=n.insert(s,i?i.document.mutableCopy():Et.newInvalidDocument(s))}),b.resolve(n)}getDocumentsMatchingQuery(t,e,n,s){let i=Lt(),a=e.path,c=new M(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(c);for(;l.hasNext();){let{key:d,value:{document:m}}=l.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Nu(cf(m),n)<=0||(s.has(m.key)||Ts(e,m))&&(i=i.insert(m.key,m.mutableCopy()))}return b.resolve(i)}getAllFromCollectionGroup(t,e,n,s){F(9500)}ii(t,e){return b.forEach(this.docs,n=>e(n))}newChangeBuffer(t){return new Uc(this)}getSize(t){return b.resolve(this.size)}},Uc=class extends $i{constructor(t){super(),this.Nr=t}applyChanges(t){let e=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?e.push(this.Nr.addEntry(t,s)):this.Nr.removeEntry(n)}),b.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}};var qc=class{constructor(t){this.persistence=t,this.si=new $t(e=>hn(e),Is),this.lastRemoteSnapshotVersion=U.min(),this.highestTargetId=0,this.oi=0,this._i=new fs,this.targetCount=0,this.ai=rr.ur()}forEachTarget(t,e){return this.si.forEach((n,s)=>e(s)),b.resolve()}getLastRemoteSnapshotVersion(t){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return b.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.oi&&(this.oi=e),b.resolve()}Pr(t){this.si.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.ai=new rr(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,b.resolve()}updateTargetData(t,e){return this.Pr(e),b.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,b.resolve()}removeTargets(t,e,n){let s=0,i=[];return this.si.forEach((a,c)=>{c.sequenceNumber<=e&&n.get(c.targetId)===null&&(this.si.delete(a),i.push(this.removeMatchingKeysForTargetId(t,c.targetId)),s++)}),b.waitFor(i).next(()=>s)}getTargetCount(t){return b.resolve(this.targetCount)}getTargetData(t,e){let n=this.si.get(e)||null;return b.resolve(n)}addMatchingKeys(t,e,n){return this._i.Wr(e,n),b.resolve()}removeMatchingKeys(t,e,n){this._i.zr(e,n);let s=this.persistence.referenceDelegate,i=[];return s&&e.forEach(a=>{i.push(s.markPotentiallyOrphaned(t,a))}),b.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),b.resolve()}getMatchingKeysForTargetId(t,e){let n=this._i.Hr(e);return b.resolve(n)}containsKey(t,e){return b.resolve(this._i.containsKey(e))}};var ms=class{constructor(t,e){this.ui={},this.overlays={},this.ci=new Gt(0),this.li=!1,this.li=!0,this.hi=new Fc,this.referenceDelegate=t(this),this.Pi=new qc(this),this.indexManager=new Sc,this.remoteDocumentCache=function(s){return new Bc(s)}(n=>this.referenceDelegate.Ti(n)),this.serializer=new Fi(e),this.Ii=new Oc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Mc,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.ui[t.toKey()];return n||(n=new Lc(e,this.referenceDelegate),this.ui[t.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,n){N("MemoryPersistence","Starting transaction:",t);let s=new jc(this.ci.next());return this.referenceDelegate.Ei(),n(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(t,e){return b.or(Object.values(this.ui).map(n=>()=>n.containsKey(t,e)))}},jc=class extends gi{constructor(t){super(),this.currentSequenceNumber=t}},Qi=class r{constructor(t){this.persistence=t,this.Ri=new fs,this.Vi=null}static mi(t){return new r(t)}get fi(){if(this.Vi)return this.Vi;throw F(60996)}addReference(t,e,n){return this.Ri.addReference(n,e),this.fi.delete(n.toString()),b.resolve()}removeReference(t,e,n){return this.Ri.removeReference(n,e),this.fi.add(n.toString()),b.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),b.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach(s=>this.fi.add(s.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>n.removeTargetData(t,e))}Ei(){this.Vi=new Set}di(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.fi,n=>{let s=M.fromPath(n);return this.gi(t,s).next(i=>{i||e.removeEntry(s,U.min())})}).next(()=>(this.Vi=null,e.apply(t)))}updateLimboDocument(t,e){return this.gi(t,e).next(n=>{n?this.fi.delete(e.toString()):this.fi.add(e.toString())})}Ti(t){return 0}gi(t,e){return b.or([()=>b.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}},Wi=class r{constructor(t,e){this.persistence=t,this.pi=new $t(n=>St(n.path),(n,s)=>n.isEqual(s)),this.garbageCollector=fm(this,e)}static mi(t,e){return new r(t,e)}Ei(){}di(t){return b.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){let e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next(n=>e.next(s=>n+s))}wr(t){let e=0;return this.pr(t,n=>{e++}).next(()=>e)}pr(t,e){return b.forEach(this.pi,(n,s)=>this.br(t,n,s).next(i=>i?b.resolve():e(s)))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0,s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(t,a=>this.br(t,a,e).next(c=>{c||(n++,i.removeEntry(a,U.min()))})).next(()=>i.apply(t)).next(()=>n)}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),b.resolve()}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),b.resolve()}removeReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),b.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),b.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=ci(t.data.value)),e}br(t,e,n){return b.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{let s=this.pi.get(e);return b.resolve(s!==void 0&&s>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}};var zc=class{constructor(t){this.serializer=t}k(t,e,n,s){let i=new yi("createOrUpgrade",e);n<1&&s>=1&&(function(l){l.createObjectStore(Es)}(t),function(l){l.createObjectStore(ns,{keyPath:Hg}),l.createObjectStore(zt,{keyPath:Zh,autoIncrement:!0}).createIndex(Xe,td,{unique:!0}),l.createObjectStore($n)}(t),Ud(t),function(l){l.createObjectStore(Ke)}(t));let a=b.resolve();return n<3&&s>=3&&(n!==0&&(function(l){l.deleteObjectStore(Qn),l.deleteObjectStore(Kn),l.deleteObjectStore(nn)}(t),Ud(t)),a=a.next(()=>function(l){let d=l.store(nn),m={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:U.min().toTimestamp(),targetCount:0};return d.put(Ei,m)}(i))),n<4&&s>=4&&(n!==0&&(a=a.next(()=>function(l,d){return d.store(zt).J().next(p=>{l.deleteObjectStore(zt),l.createObjectStore(zt,{keyPath:Zh,autoIncrement:!0}).createIndex(Xe,td,{unique:!0});let y=d.store(zt),S=p.map(C=>y.put(C));return b.waitFor(S)})}(t,i))),a=a.next(()=>{(function(l){l.createObjectStore(Wn,{keyPath:sy})})(t)})),n<5&&s>=5&&(a=a.next(()=>this.yi(i))),n<6&&s>=6&&(a=a.next(()=>(function(l){l.createObjectStore(rs)}(t),this.wi(i)))),n<7&&s>=7&&(a=a.next(()=>this.Si(i))),n<8&&s>=8&&(a=a.next(()=>this.bi(t,i))),n<9&&s>=9&&(a=a.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(t)})),n<10&&s>=10&&(a=a.next(()=>this.Di(i))),n<11&&s>=11&&(a=a.next(()=>{(function(l){l.createObjectStore(go,{keyPath:iy})})(t),function(l){l.createObjectStore(yo,{keyPath:oy})}(t)})),n<12&&s>=12&&(a=a.next(()=>{(function(l){let d=l.createObjectStore(_o,{keyPath:fy});d.createIndex(Ka,my,{unique:!1}),d.createIndex(gf,py,{unique:!1})})(t)})),n<13&&s>=13&&(a=a.next(()=>function(l){let d=l.createObjectStore(wi,{keyPath:Xg});d.createIndex(oi,Yg),d.createIndex(df,Zg)}(t)).next(()=>this.Ci(t,i)).next(()=>t.deleteObjectStore(Ke))),n<14&&s>=14&&(a=a.next(()=>this.Fi(t,i))),n<15&&s>=15&&(a=a.next(()=>function(l){l.createObjectStore(Mu,{keyPath:ay,autoIncrement:!0}).createIndex($a,cy,{unique:!1}),l.createObjectStore(Qr,{keyPath:uy}).createIndex(mf,ly,{unique:!1}),l.createObjectStore(Wr,{keyPath:hy}).createIndex(pf,dy,{unique:!1})}(t))),n<16&&s>=16&&(a=a.next(()=>{e.objectStore(Qr).clear()}).next(()=>{e.objectStore(Wr).clear()})),n<17&&s>=17&&(a=a.next(()=>{(function(l){l.createObjectStore(Fu,{keyPath:gy})})(t)})),n<18&&s>=18&&ra()&&(a=a.next(()=>{e.objectStore(Qr).clear()}).next(()=>{e.objectStore(Wr).clear()})),a}wi(t){let e=0;return t.store(Ke).ee((n,s)=>{e+=ji(s)}).next(()=>{let n={byteSize:e};return t.store(rs).put(Ga,n)})}yi(t){let e=t.store(ns),n=t.store(zt);return e.J().next(s=>b.forEach(s,i=>{let a=IDBKeyRange.bound([i.userId,en],[i.userId,i.lastAcknowledgedBatchId]);return n.J(Xe,a).next(c=>b.forEach(c,l=>{L(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});let d=We(this.serializer,l);return lm(t,i.userId,d).next(()=>{})}))}))}Si(t){let e=t.store(Qn),n=t.store(Ke);return t.store(nn).get(Ei).next(s=>{let i=[];return n.ee((a,c)=>{let l=new Y(a),d=function(p){return[0,St(p)]}(l);i.push(e.get(d).next(m=>m?b.resolve():(p=>e.put({targetId:0,path:St(p),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>b.waitFor(i))})}bi(t,e){t.createObjectStore(ss,{keyPath:ry});let n=e.store(ss),s=new ds,i=a=>{if(s.add(a)){let c=a.lastSegment(),l=a.popLast();return n.put({collectionId:c,parent:St(l)})}};return e.store(Ke).ee({X:!0},(a,c)=>{let l=new Y(a);return i(l.popLast())}).next(()=>e.store($n).ee({X:!0},([a,c,l],d)=>{let m=Wt(c);return i(m.popLast())}))}Di(t){let e=t.store(Kn);return e.ee((n,s)=>{let i=$r(s),a=im(this.serializer,i);return e.put(a)})}Ci(t,e){let n=e.store(Ke),s=[];return n.ee((i,a)=>{let c=e.store(wi),l=function(p){return p.document?new M(Y.fromString(p.document.name).popFirst(5)):p.noDocument?M.fromSegments(p.noDocument.path):p.unknownDocument?M.fromSegments(p.unknownDocument.path):F(36783)}(a).path.toArray(),d={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};s.push(c.put(d))}).next(()=>b.waitFor(s))}Fi(t,e){let n=e.store(zt),s=mm(this.serializer),i=new ms(Qi.mi,this.serializer.yt);return n.J().next(a=>{let c=new Map;return a.forEach(l=>{let d=c.get(l.userId)??$();We(this.serializer,l).keys().forEach(m=>d=d.add(m)),c.set(l.userId,d)}),b.forEach(c,(l,d)=>{let m=new ht(d),p=Bi.wt(this.serializer,m),y=i.getIndexManager(m),S=zi.wt(m,this.serializer,y,i.referenceDelegate);return new Ki(s,S,p,y).recalculateAndSaveOverlaysForDocumentKeys(new is(e,Gt.ce),l).next()})})}};function Ud(r){r.createObjectStore(Qn,{keyPath:ey}).createIndex(Ou,ny,{unique:!0}),r.createObjectStore(Kn,{keyPath:"targetId"}).createIndex(ff,ty,{unique:!0}),r.createObjectStore(nn)}var Ee="IndexedDbPersistence",Sa=18e5,Ra=5e3,Pa="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",a_="main",Gc=class r{constructor(t,e,n,s,i,a,c,l,d,m,p=18){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Mi=i,this.window=a,this.document=c,this.xi=d,this.Oi=m,this.Ni=p,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=y=>Promise.resolve(),!r.v())throw new x(P.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Vc(this,s),this.$i=e+a_,this.serializer=new Fi(l),this.Ui=new Gn(this.$i,this.Ni,new zc(this.serializer)),this.hi=new wc,this.Pi=new Pc(this.referenceDelegate,this.serializer),this.remoteDocumentCache=mm(this.serializer),this.Ii=new _c,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,m===!1&&Ct(Ee,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new x(P.FAILED_PRECONDITION,Pa);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Pi.getHighestSequenceNumber(t))}).then(t=>{this.ci=new Gt(t,this.xi)}).then(()=>{this.li=!0}).catch(t=>(this.Ui&&this.Ui.close(),Promise.reject(t)))}Ji(t){return this.Qi=e=>V(this,null,function*(){if(this.started)return t(e)}),t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ui.$(e=>V(this,null,function*(){e.newVersion===null&&(yield t())}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Mi.enqueueAndForget(()=>V(this,null,function*(){this.started&&(yield this.Wi())})))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>ri(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(t).next(e=>{e||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(t)).next(e=>this.isPrimary&&!e?this.Zi(t).next(()=>!1):!!e&&this.Xi(t).next(()=>!0))).catch(t=>{if(Me(t))return N(Ee,"Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return N(Ee,"Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.Mi.enqueueRetryable(()=>this.Qi(t)),this.isPrimary=t})}Hi(t){return zr(t).get(Rn).next(e=>b.resolve(this.es(e)))}ts(t){return ri(t).delete(this.clientId)}ns(){return V(this,null,function*(){if(this.isPrimary&&!this.rs(this.qi,Sa)){this.qi=Date.now();let t=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let n=pt(e,Wn);return n.J().next(s=>{let i=this.ss(s,Sa),a=s.filter(c=>i.indexOf(c)===-1);return b.forEach(a,c=>n.delete(c.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Ki)for(let e of t)this.Ki.removeItem(this._s(e.clientId))}})}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(t){return!!t&&t.ownerId===this.clientId}Yi(t){return this.Oi?b.resolve(!0):zr(t).get(Rn).next(e=>{if(e!==null&&this.rs(e.leaseTimestampMs,Ra)&&!this.us(e.ownerId)){if(this.es(e)&&this.networkEnabled)return!0;if(!this.es(e)){if(!e.allowTabSynchronization)throw new x(P.FAILED_PRECONDITION,Pa);return!1}}return!(!this.networkEnabled||!this.inForeground)||ri(t).J().next(n=>this.ss(n,Ra).find(s=>{if(this.clientId!==s.clientId){let i=!this.networkEnabled&&s.networkEnabled,a=!this.inForeground&&s.inForeground,c=this.networkEnabled===s.networkEnabled;if(i||a&&c)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&N(Ee,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){return V(this,null,function*(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),yield this.Ui.runTransaction("shutdown","readwrite",[Es,Wn],t=>{let e=new is(t,Gt.ce);return this.Zi(e).next(()=>this.ts(e))}),this.Ui.close(),this.Ps()})}ss(t,e){return t.filter(n=>this.rs(n.updateTimeMs,e)&&!this.us(n.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",t=>ri(t).J().next(e=>this.ss(e,Sa).map(n=>n.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(t,e){return zi.wt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new Rc(t,this.serializer.yt.databaseId)}getDocumentOverlayCache(t){return Bi.wt(this.serializer,t)}getBundleCache(){return this.Ii}runTransaction(t,e,n){N(Ee,"Starting transaction:",t);let s=e==="readonly"?"readonly":"readwrite",i=function(l){return l===18?wy:l===17?Ef:l===16?_y:l===15?Lu:l===14?wf:l===13?_f:l===12?yy:l===11?yf:void F(60245)}(this.Ni),a;return this.Ui.runTransaction(t,s,i,c=>(a=new is(c,this.ci?this.ci.next():Gt.ce),e==="readwrite-primary"?this.Hi(a).next(l=>!!l||this.Yi(a)).next(l=>{if(!l)throw Ct(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new x(P.FAILED_PRECONDITION,uf);return n(a)}).next(l=>this.Xi(a).next(()=>l)):this.Is(a).next(()=>n(a)))).then(c=>(a.raiseOnCommittedEvent(),c))}Is(t){return zr(t).get(Rn).next(e=>{if(e!==null&&this.rs(e.leaseTimestampMs,Ra)&&!this.us(e.ownerId)&&!this.es(e)&&!(this.Oi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new x(P.FAILED_PRECONDITION,Pa)})}Xi(t){let e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return zr(t).put(Rn,e)}static v(){return Gn.v()}Zi(t){let e=zr(t);return e.get(Rn).next(n=>this.es(n)?(N(Ee,"Releasing primary lease."),e.delete(Rn)):b.resolve())}rs(t,e){let n=Date.now();return!(t<n-e)&&(!(t>n)||(Ct(`Detected an update time that is in the future: ${t} > ${n}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){typeof this.window?.addEventListener=="function"&&(this.Bi=()=>{this.cs();let t=/(?:Version|Mobile)\/1[456]/;na()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(t){try{let e=this.Ki?.getItem(this._s(t))!==null;return N(Ee,`Client '${t}' ${e?"is":"is not"} zombied in LocalStorage`),e}catch(e){return Ct(Ee,"Failed to get zombied client id.",e),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(t){Ct("Failed to set zombie client id.",t)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(t){return`firestore_zombie_${this.persistenceKey}_${t}`}};function zr(r){return pt(r,Es)}function ri(r){return pt(r,Wn)}function c_(r,t){let e=r.projectId;return r.isDefaultDatabase||(e+="."+r.database),"firestore/"+t+"/"+e+"/"}var $c=class r{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Es=n,this.ds=s}static As(t,e){let n=$(),s=$();for(let i of e.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new r(t,e.fromCache,n,s)}};var Kc=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var Hi=class{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return na()?8:lf(je())>0?6:4}()}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,n,s){let i={result:null};return this.ys(t,e).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.ws(t,e,s,n).next(a=>{i.result=a})}).next(()=>{if(i.result)return;let a=new Kc;return this.Ss(t,e,a).next(c=>{if(i.result=c,this.Vs)return this.bs(t,e,a,c.size)})}).next(()=>i.result)}bs(t,e,n,s){return n.documentReadCount<this.fs?(Nn()<=Q.DEBUG&&N("QueryEngine","SDK will not create cache indexes for query:",kn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),b.resolve()):(Nn()<=Q.DEBUG&&N("QueryEngine","Query:",kn(e),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.gs*s?(Nn()<=Q.DEBUG&&N("QueryEngine","The SDK decides to create cache indexes for query:",kn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Ut(e))):b.resolve())}ys(t,e){if(dd(e))return b.resolve(null);let n=Ut(e);return this.indexManager.getIndexType(t,n).next(s=>s===0?null:(e.limit!==null&&s===1&&(e=Pi(e,null,"F"),n=Ut(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(i=>{let a=$(...i);return this.ps.getDocuments(t,a).next(c=>this.indexManager.getMinOffset(t,n).next(l=>{let d=this.Ds(e,c);return this.Cs(e,d,a,l.readTime)?this.ys(t,Pi(e,null,"F")):this.vs(t,d,e,l)}))})))}ws(t,e,n,s){return dd(e)||s.isEqual(U.min())?b.resolve(null):this.ps.getDocuments(t,n).next(i=>{let a=this.Ds(e,i);return this.Cs(e,a,n,s)?b.resolve(null):(Nn()<=Q.DEBUG&&N("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),kn(e)),this.vs(t,a,e,Kg(s,Zr)).next(c=>c))})}Ds(t,e){let n=new tt(Ff(t));return e.forEach((s,i)=>{Ts(t,i)&&(n=n.add(i))}),n}Cs(t,e,n,s){if(t.limit===null)return!1;if(n.size!==e.size)return!0;let i=t.limitType==="F"?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(t,e,n){return Nn()<=Q.DEBUG&&N("QueryEngine","Using full collection scan to execute query:",kn(e)),this.ps.getDocumentsMatchingQuery(t,e,qt.min(),n)}vs(t,e,n,s){return this.ps.getDocumentsMatchingQuery(t,n,s).next(i=>(e.forEach(a=>{i=i.insert(a.key,a)}),i))}};var Qu="LocalStore",u_=3e8,Qc=class{constructor(t,e,n,s){this.persistence=t,this.Fs=e,this.serializer=s,this.Ms=new ot(z),this.xs=new $t(i=>hn(i),Is),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(n)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Ki(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ms))}};function pm(r,t,e,n){return new Qc(r,t,e,n)}function gm(r,t){return V(this,null,function*(){let e=j(r);return yield e.persistence.runTransaction("Handle user change","readonly",n=>{let s;return e.mutationQueue.getAllMutationBatches(n).next(i=>(s=i,e.Bs(t),e.mutationQueue.getAllMutationBatches(n))).next(i=>{let a=[],c=[],l=$();for(let d of s){a.push(d.batchId);for(let m of d.mutations)l=l.add(m.key)}for(let d of i){c.push(d.batchId);for(let m of d.mutations)l=l.add(m.key)}return e.localDocuments.getDocuments(n,l).next(d=>({Ls:d,removedBatchIds:a,addedBatchIds:c}))})})})}function l_(r,t){let e=j(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let s=t.batch.keys(),i=e.Ns.newChangeBuffer({trackRemovals:!0});return function(c,l,d,m){let p=d.batch,y=p.keys(),S=b.resolve();return y.forEach(C=>{S=S.next(()=>m.getEntry(l,C)).next(k=>{let D=d.docVersions.get(C);L(D!==null,48541),k.version.compareTo(D)<0&&(p.applyToRemoteDocument(k,d),k.isValidDocument()&&(k.setReadTime(d.commitVersion),m.addEntry(k)))})}),S.next(()=>c.mutationQueue.removeMutationBatch(l,p))}(e,n,t,i).next(()=>i.apply(n)).next(()=>e.mutationQueue.performConsistencyCheck(n)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(n,s,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(c){let l=$();for(let d=0;d<c.mutationResults.length;++d)c.mutationResults[d].transformResults.length>0&&(l=l.add(c.batch.mutations[d].key));return l}(t))).next(()=>e.localDocuments.getDocuments(n,s))})}function ym(r){let t=j(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Pi.getLastRemoteSnapshotVersion(e))}function h_(r,t){let e=j(r),n=t.snapshotVersion,s=e.Ms;return e.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{let a=e.Ns.newChangeBuffer({trackRemovals:!0});s=e.Ms;let c=[];t.targetChanges.forEach((m,p)=>{let y=s.get(p);if(!y)return;c.push(e.Pi.removeMatchingKeys(i,m.removedDocuments,p).next(()=>e.Pi.addMatchingKeys(i,m.addedDocuments,p)));let S=y.withSequenceNumber(i.currentSequenceNumber);t.targetMismatches.get(p)!==null?S=S.withResumeToken(mt.EMPTY_BYTE_STRING,U.min()).withLastLimboFreeSnapshotVersion(U.min()):m.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(m.resumeToken,n)),s=s.insert(p,S),function(k,D,G){return k.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=u_?!0:G.addedDocuments.size+G.modifiedDocuments.size+G.removedDocuments.size>0}(y,S,m)&&c.push(e.Pi.updateTargetData(i,S))});let l=Lt(),d=$();if(t.documentUpdates.forEach(m=>{t.resolvedLimboDocuments.has(m)&&c.push(e.persistence.referenceDelegate.updateLimboDocument(i,m))}),c.push(d_(i,a,t.documentUpdates).next(m=>{l=m.ks,d=m.qs})),!n.isEqual(U.min())){let m=e.Pi.getLastRemoteSnapshotVersion(i).next(p=>e.Pi.setTargetsMetadata(i,i.currentSequenceNumber,n));c.push(m)}return b.waitFor(c).next(()=>a.apply(i)).next(()=>e.localDocuments.getLocalViewOfDocuments(i,l,d)).next(()=>l)}).then(i=>(e.Ms=s,i))}function d_(r,t,e){let n=$(),s=$();return e.forEach(i=>n=n.add(i)),t.getEntries(r,n).next(i=>{let a=Lt();return e.forEach((c,l)=>{let d=i.get(c);l.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(c)),l.isNoDocument()&&l.version.isEqual(U.min())?(t.removeEntry(c,l.readTime),a=a.insert(c,l)):!d.isValidDocument()||l.version.compareTo(d.version)>0||l.version.compareTo(d.version)===0&&d.hasPendingWrites?(t.addEntry(l),a=a.insert(c,l)):N(Qu,"Ignoring outdated watch update for ",c,". Current version:",d.version," Watch version:",l.version)}),{ks:a,qs:s}})}function f_(r,t){let e=j(r);return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(t===void 0&&(t=en),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}function m_(r,t){let e=j(r);return e.persistence.runTransaction("Allocate target","readwrite",n=>{let s;return e.Pi.getTargetData(n,t).next(i=>i?(s=i,b.resolve(s)):e.Pi.allocateTargetId(n).next(a=>(s=new nr(t,a,"TargetPurposeListen",n.currentSequenceNumber),e.Pi.addTargetData(n,s).next(()=>s))))}).then(n=>{let s=e.Ms.get(n.targetId);return(s===null||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.Ms=e.Ms.insert(n.targetId,n),e.xs.set(t,n.targetId)),n})}function Wc(r,t,e){return V(this,null,function*(){let n=j(r),s=n.Ms.get(t),i=e?"readwrite":"readwrite-primary";try{e||(yield n.persistence.runTransaction("Release target",i,a=>n.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!Me(a))throw a;N(Qu,`Failed to update sequence numbers for target ${t}: ${a}`)}n.Ms=n.Ms.remove(t),n.xs.delete(s.target)})}function qd(r,t,e){let n=j(r),s=U.min(),i=$();return n.persistence.runTransaction("Execute query","readwrite",a=>function(l,d,m){let p=j(l),y=p.xs.get(m);return y!==void 0?b.resolve(p.Ms.get(y)):p.Pi.getTargetData(d,m)}(n,a,Ut(t)).next(c=>{if(c)return s=c.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(a,c.targetId).next(l=>{i=l})}).next(()=>n.Fs.getDocumentsMatchingQuery(a,t,e?s:U.min(),e?i:$())).next(c=>(p_(n,Ry(t),c),{documents:c,Qs:i})))}function p_(r,t,e){let n=r.Os.get(t)||U.min();e.forEach((s,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)}),r.Os.set(t,n)}var Ji=class{constructor(){this.activeTargetIds=Ny()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}};var Xi=class{constructor(){this.Mo=new Ji,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,n){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new Ji,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var Hc=class{Oo(t){}shutdown(){}};var jd="ConnectivityMonitor",Yi=class{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){N(jd,"Network connectivity changed: AVAILABLE");for(let t of this.qo)t(0)}ko(){N(jd,"Network connectivity changed: UNAVAILABLE");for(let t of this.qo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var si=null;function Jc(){return si===null?si=function(){return 268435456+Math.round(2147483648*Math.random())}():si++,"0x"+si.toString(16)}var Ca="RestConnection",g_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},Xc=class{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${n}/databases/${s}`,this.Wo=this.databaseId.database===Ti?`project_id=${n}`:`project_id=${n}&database_id=${s}`}Go(t,e,n,s,i){let a=Jc(),c=this.zo(t,e.toUriEncodedString());N(Ca,`Sending RPC '${t}' ${a}:`,c,n);let l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,s,i);let{host:d}=new URL(c),m=Ws(d);return this.Jo(t,c,l,n,m).then(p=>(N(Ca,`Received RPC '${t}' ${a}: `,p),p),p=>{throw cn(Ca,`RPC '${t}' ${a} failed with error: `,p,"url: ",c,"request:",n),p})}Ho(t,e,n,s,i,a){return this.Go(t,e,n,s,i)}jo(t,e,n){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ur}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((s,i)=>t[i]=s),n&&n.headers.forEach((s,i)=>t[i]=s)}zo(t,e){let n=g_[t];return`${this.Uo}/v1/${e}:${n}`}terminate(){}};var Yc=class{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}};var bt="WebChannelConnection",Zc=class extends Xc{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,n,s,i){let a=Jc();return new Promise((c,l)=>{let d=new wa;d.setWithCredentials(!0),d.listenOnce(Ea.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Br.NO_ERROR:let p=d.getResponseJson();N(bt,`XHR for RPC '${t}' ${a} received:`,JSON.stringify(p)),c(p);break;case Br.TIMEOUT:N(bt,`RPC '${t}' ${a} timed out`),l(new x(P.DEADLINE_EXCEEDED,"Request time out"));break;case Br.HTTP_ERROR:let y=d.getStatus();if(N(bt,`RPC '${t}' ${a} failed with status:`,y,"response text:",d.getResponseText()),y>0){let S=d.getResponseJson();Array.isArray(S)&&(S=S[0]);let C=S?.error;if(C&&C.status&&C.message){let k=function(G){let q=G.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(q)>=0?q:P.UNKNOWN}(C.status);l(new x(k,C.message))}else l(new x(P.UNKNOWN,"Server responded with status "+d.getStatus()))}else l(new x(P.UNAVAILABLE,"Connection failed."));break;default:F(9055,{l_:t,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{N(bt,`RPC '${t}' ${a} completed.`)}});let m=JSON.stringify(s);N(bt,`RPC '${t}' ${a} sending request:`,s),d.send(e,"POST",m,n,15)})}T_(t,e,n){let s=Jc(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=Ta(),c=va(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(l.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,e,n),l.encodeInitMessageHeaders=!0;let m=i.join("");N(bt,`Creating RPC '${t}' stream ${s}: ${m}`,l);let p=a.createWebChannel(m,l);this.I_(p);let y=!1,S=!1,C=new Yc({Yo:D=>{S?N(bt,`Not sending because RPC '${t}' stream ${s} is closed:`,D):(y||(N(bt,`Opening RPC '${t}' stream ${s} transport.`),p.open(),y=!0),N(bt,`RPC '${t}' stream ${s} sending:`,D),p.send(D))},Zo:()=>p.close()}),k=(D,G,q)=>{D.listen(G,B=>{try{q(B)}catch(X){setTimeout(()=>{throw X},0)}})};return k(p,Sn.EventType.OPEN,()=>{S||(N(bt,`RPC '${t}' stream ${s} transport opened.`),C.o_())}),k(p,Sn.EventType.CLOSE,()=>{S||(S=!0,N(bt,`RPC '${t}' stream ${s} transport closed`),C.a_(),this.E_(p))}),k(p,Sn.EventType.ERROR,D=>{S||(S=!0,cn(bt,`RPC '${t}' stream ${s} transport errored. Name:`,D.name,"Message:",D.message),C.a_(new x(P.UNAVAILABLE,"The operation could not be completed")))}),k(p,Sn.EventType.MESSAGE,D=>{if(!S){let G=D.data[0];L(!!G,16349);let q=G,B=q?.error||q[0]?.error;if(B){N(bt,`RPC '${t}' stream ${s} received error:`,B);let X=B.status,et=function(g){let w=ct[g];if(w!==void 0)return Wf(w)}(X),H=B.message;et===void 0&&(et=P.INTERNAL,H="Unknown error status: "+X+" with message "+B.message),S=!0,C.a_(new x(et,H)),p.close()}else N(bt,`RPC '${t}' stream ${s} received:`,G),C.u_(G)}}),k(c,Ia.STAT_EVENT,D=>{D.stat===Zs.PROXY?N(bt,`RPC '${t}' stream ${s} detected buffering proxy`):D.stat===Zs.NOPROXY&&N(bt,`RPC '${t}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{C.__()},0),C}terminate(){this.c_.forEach(t=>t.close()),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter(e=>e===t)}};function y_(){return typeof window<"u"?window:null}function di(){return typeof document<"u"?document:null}function To(r){return new fc(r,!0)}var Zi=class{constructor(t,e,n=1e3,s=1.5,i=6e4){this.Mi=t,this.timerId=e,this.d_=n,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();let e=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),s=Math.max(0,e-n);s>0&&N("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),t())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}};var zd="PersistentStream",to=class{constructor(t,e,n,s,i,a,c,l){this.Mi=t,this.S_=n,this.b_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Zi(t,e)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}stop(){return V(this,null,function*(){this.x_()&&(yield this.close(0))})}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(t){this.Q_(),this.stream.send(t)}k_(){return V(this,null,function*(){if(this.O_())return this.close(0)})}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(t,e){return V(this,null,function*(){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():e&&e.code===P.RESOURCE_EXHAUSTED?(Ct(e.toString()),Ct("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.r_(e)})}K_(){}auth(){this.state=1;let t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,s])=>{this.D_===e&&this.G_(n,s)},n=>{t(()=>{let s=new x(P.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(s)})})}G_(t,e){let n=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{n(()=>this.z_(s))}),this.stream.onMessage(s=>{n(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(()=>V(this,null,function*(){this.state=0,this.start()}))}z_(t){return N(zd,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget(()=>this.D_===t?e():(N(zd,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},tu=class extends to{constructor(t,e,n,s,i,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,a),this.serializer=i}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();let e=Hy(this.serializer,t),n=function(i){if(!("targetChange"in i))return U.min();let a=i.targetChange;return a.targetIds&&a.targetIds.length?U.min():a.readTime?Vt(a.readTime):U.min()}(t);return this.listener.H_(e,n)}Y_(t){let e={};e.database=gc(this.serializer),e.addTarget=function(i,a){let c,l=a.target;if(c=Si(l)?{documents:tm(i,l)}:{query:$u(i,l).ft},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=Hf(i,a.resumeToken);let d=mc(i,a.expectedCount);d!==null&&(c.expectedCount=d)}else if(a.snapshotVersion.compareTo(U.min())>0){c.readTime=er(i,a.snapshotVersion.toTimestamp());let d=mc(i,a.expectedCount);d!==null&&(c.expectedCount=d)}return c}(this.serializer,t);let n=Yy(this.serializer,t);n&&(e.labels=n),this.q_(e)}Z_(t){let e={};e.database=gc(this.serializer),e.removeTarget=t,this.q_(e)}},eu=class extends to{constructor(t,e,n,s,i,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,a),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return L(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,L(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){L(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();let e=Jy(t.writeResults,t.commitTime),n=Vt(t.commitTime);return this.listener.na(n,e)}ra(){let t={};t.database=gc(this.serializer),this.q_(t)}ea(t){let e={streamToken:this.lastStreamToken,writes:t.map(n=>Mi(this.serializer,n))};this.q_(e)}};var nu=class{},ru=class extends nu{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new x(P.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,n,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Go(t,pc(e,n),s,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new x(P.UNKNOWN,i.toString())})}Ho(t,e,n,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,c])=>this.connection.Ho(t,pc(e,n),s,a,c,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new x(P.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}},su=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ct(e),this.aa=!1):N("OnlineStateTracker",e)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}};var gn="RemoteStore",iu=class{constructor(t,e,n,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(a=>{n.enqueueAndForget(()=>V(this,null,function*(){wn(this)&&(N(gn,"Restarting streams for network reachability change."),yield function(l){return V(this,null,function*(){let d=j(l);d.Ea.add(4),yield As(d),d.Ra.set("Unknown"),d.Ea.delete(4),yield Ao(d)})}(this))}))}),this.Ra=new su(n,s)}};function Ao(r){return V(this,null,function*(){if(wn(r))for(let t of r.da)yield t(!0)})}function As(r){return V(this,null,function*(){for(let t of r.da)yield t(!1)})}function _m(r,t){let e=j(r);e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),Xu(e)?Ju(e):lr(e).O_()&&Hu(e,t))}function Wu(r,t){let e=j(r),n=lr(e);e.Ia.delete(t),n.O_()&&wm(e,t),e.Ia.size===0&&(n.O_()?n.L_():wn(e)&&e.Ra.set("Unknown"))}function Hu(r,t){if(r.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(U.min())>0){let e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}lr(r).Y_(t)}function wm(r,t){r.Va.Ue(t),lr(r).Z_(t)}function Ju(r){r.Va=new dc({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),At:t=>r.Ia.get(t)||null,ht:()=>r.datastore.serializer.databaseId}),lr(r).start(),r.Ra.ua()}function Xu(r){return wn(r)&&!lr(r).x_()&&r.Ia.size>0}function wn(r){return j(r).Ea.size===0}function Em(r){r.Va=void 0}function __(r){return V(this,null,function*(){r.Ra.set("Online")})}function w_(r){return V(this,null,function*(){r.Ia.forEach((t,e)=>{Hu(r,t)})})}function E_(r,t){return V(this,null,function*(){Em(r),Xu(r)?(r.Ra.ha(t),Ju(r)):r.Ra.set("Unknown")})}function I_(r,t,e){return V(this,null,function*(){if(r.Ra.set("Online"),t instanceof Ni&&t.state===2&&t.cause)try{yield function(s,i){return V(this,null,function*(){let a=i.cause;for(let c of i.targetIds)s.Ia.has(c)&&(yield s.remoteSyncer.rejectListen(c,a),s.Ia.delete(c),s.Va.removeTarget(c))})}(r,t)}catch(n){N(gn,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),yield eo(r,n)}else if(t instanceof Un?r.Va.Ze(t):t instanceof xi?r.Va.st(t):r.Va.tt(t),!e.isEqual(U.min()))try{let n=yield ym(r.localStore);e.compareTo(n)>=0&&(yield function(i,a){let c=i.Va.Tt(a);return c.targetChanges.forEach((l,d)=>{if(l.resumeToken.approximateByteSize()>0){let m=i.Ia.get(d);m&&i.Ia.set(d,m.withResumeToken(l.resumeToken,a))}}),c.targetMismatches.forEach((l,d)=>{let m=i.Ia.get(l);if(!m)return;i.Ia.set(l,m.withResumeToken(mt.EMPTY_BYTE_STRING,m.snapshotVersion)),wm(i,l);let p=new nr(m.target,l,d,m.sequenceNumber);Hu(i,p)}),i.remoteSyncer.applyRemoteEvent(c)}(r,e))}catch(n){N(gn,"Failed to raise snapshot:",n),yield eo(r,n)}})}function eo(r,t,e){return V(this,null,function*(){if(!Me(t))throw t;r.Ea.add(1),yield As(r),r.Ra.set("Offline"),e||(e=()=>ym(r.localStore)),r.asyncQueue.enqueueRetryable(()=>V(null,null,function*(){N(gn,"Retrying IndexedDB access"),yield e(),r.Ea.delete(1),yield Ao(r)}))})}function Im(r,t){return t().catch(e=>eo(r,e,t))}function bs(r){return V(this,null,function*(){let t=j(r),e=ke(t),n=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:en;for(;v_(t);)try{let s=yield f_(t.localStore,n);if(s===null){t.Ta.length===0&&e.L_();break}n=s.batchId,T_(t,s)}catch(s){yield eo(t,s)}vm(t)&&Tm(t)})}function v_(r){return wn(r)&&r.Ta.length<10}function T_(r,t){r.Ta.push(t);let e=ke(r);e.O_()&&e.X_&&e.ea(t.mutations)}function vm(r){return wn(r)&&!ke(r).x_()&&r.Ta.length>0}function Tm(r){ke(r).start()}function A_(r){return V(this,null,function*(){ke(r).ra()})}function b_(r){return V(this,null,function*(){let t=ke(r);for(let e of r.Ta)t.ea(e.mutations)})}function S_(r,t,e){return V(this,null,function*(){let n=r.Ta.shift(),s=cc.from(n,t,e);yield Im(r,()=>r.remoteSyncer.applySuccessfulWrite(s)),yield bs(r)})}function R_(r,t){return V(this,null,function*(){t&&ke(r).X_&&(yield function(n,s){return V(this,null,function*(){if(function(a){return Uy(a)&&a!==P.ABORTED}(s.code)){let i=n.Ta.shift();ke(n).B_(),yield Im(n,()=>n.remoteSyncer.rejectFailedWrite(i.batchId,s)),yield bs(n)}})}(r,t)),vm(r)&&Tm(r)})}function Gd(r,t){return V(this,null,function*(){let e=j(r);e.asyncQueue.verifyOperationInProgress(),N(gn,"RemoteStore received new credentials");let n=wn(e);e.Ea.add(3),yield As(e),n&&e.Ra.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),yield Ao(e)})}function P_(r,t){return V(this,null,function*(){let e=j(r);t?(e.Ea.delete(2),yield Ao(e)):t||(e.Ea.add(2),yield As(e),e.Ra.set("Unknown"))})}function lr(r){return r.ma||(r.ma=function(e,n,s){let i=j(e);return i.sa(),new tu(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Xo:__.bind(null,r),t_:w_.bind(null,r),r_:E_.bind(null,r),H_:I_.bind(null,r)}),r.da.push(t=>V(null,null,function*(){t?(r.ma.B_(),Xu(r)?Ju(r):r.Ra.set("Unknown")):(yield r.ma.stop(),Em(r))}))),r.ma}function ke(r){return r.fa||(r.fa=function(e,n,s){let i=j(e);return i.sa(),new eu(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Xo:()=>Promise.resolve(),t_:A_.bind(null,r),r_:R_.bind(null,r),ta:b_.bind(null,r),na:S_.bind(null,r)}),r.da.push(t=>V(null,null,function*(){t?(r.fa.B_(),yield bs(r)):(yield r.fa.stop(),r.Ta.length>0&&(N(gn,`Stopping write stream with ${r.Ta.length} pending writes`),r.Ta=[]))}))),r.fa}var ou=class r{constructor(t,e,n,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new Bt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,s,i){let a=Date.now()+n,c=new r(t,e,a,s,i);return c.start(n),c}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(P.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Yu(r,t){if(Ct("AsyncQueue",`${t}: ${r}`),Me(r))return new x(P.UNAVAILABLE,`${t}: ${r}`);throw r}var no=class r{static emptySet(t){return new r(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||M.comparator(e.key,n.key):(e,n)=>M.comparator(e.key,n.key),this.keyedMap=Gr(),this.sortedSet=new ot(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){let s=e.getNext().key,i=n.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let n=new r;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}};var ro=class{constructor(){this.ga=new ot(M.comparator)}track(t){let e=t.doc.key,n=this.ga.get(e);n?t.type!==0&&n.type===3?this.ga=this.ga.insert(e,t):t.type===3&&n.type!==1?this.ga=this.ga.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.ga=this.ga.remove(e):t.type===1&&n.type===2?this.ga=this.ga.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):F(63341,{Rt:t,pa:n}):this.ga=this.ga.insert(e,t)}ya(){let t=[];return this.ga.inorderTraversal((e,n)=>{t.push(n)}),t}},sr=class r{constructor(t,e,n,s,i,a,c,l,d){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=l,this.hasCachedResults=d}static fromInitialDocuments(t,e,n,s,i){let a=[];return e.forEach(c=>{a.push({type:0,doc:c})}),new r(t,e,no.emptySet(e),a,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&vo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==n[s].type||!e[s].doc.isEqual(n[s].doc))return!1;return!0}};var au=class{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(t=>t.Da())}},cu=class{constructor(){this.queries=$d(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,n){let s=j(e),i=s.queries;s.queries=$d(),i.forEach((a,c)=>{for(let l of c.Sa)l.onError(n)})})(this,new x(P.ABORTED,"Firestore shutting down"))}};function $d(){return new $t(r=>Mf(r),vo)}function Zu(r,t){return V(this,null,function*(){let e=j(r),n=3,s=t.query,i=e.queries.get(s);i?!i.ba()&&t.Da()&&(n=2):(i=new au,n=t.Da()?0:1);try{switch(n){case 0:i.wa=yield e.onListen(s,!0);break;case 1:i.wa=yield e.onListen(s,!1);break;case 2:yield e.onFirstRemoteStoreListen(s)}}catch(a){let c=Yu(a,`Initialization of query '${kn(t.query)}' failed`);return void t.onError(c)}e.queries.set(s,i),i.Sa.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&el(e)})}function tl(r,t){return V(this,null,function*(){let e=j(r),n=t.query,s=3,i=e.queries.get(n);if(i){let a=i.Sa.indexOf(t);a>=0&&(i.Sa.splice(a,1),i.Sa.length===0?s=t.Da()?0:1:!i.ba()&&t.Da()&&(s=2))}switch(s){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}})}function C_(r,t){let e=j(r),n=!1;for(let s of t){let i=s.query,a=e.queries.get(i);if(a){for(let c of a.Sa)c.Fa(s)&&(n=!0);a.wa=s}}n&&el(e)}function D_(r,t,e){let n=j(r),s=n.queries.get(t);if(s)for(let i of s.Sa)i.onError(e);n.queries.delete(t)}function el(r){r.Ca.forEach(t=>{t.next()})}var uu,Kd;(Kd=uu||(uu={})).Ma="default",Kd.Cache="cache";var ps=class{constructor(t,e,n){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(t){if(!this.options.includeMetadataChanges){let n=[];for(let s of t.docChanges)s.type!==3&&n.push(s);t=new sr(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache||!this.Da())return!0;let n=e!=="Offline";return(!this.options.qa||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;let e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ka(t){t=sr.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==uu.Cache}};var so=class{constructor(t){this.key=t}},io=class{constructor(t){this.key=t}},lu=class{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=$(),this.mutatedKeys=$(),this.eu=Ff(t),this.tu=new no(this.eu)}get nu(){return this.Ya}ru(t,e){let n=e?e.iu:new ro,s=e?e.tu:this.tu,i=e?e.mutatedKeys:this.mutatedKeys,a=s,c=!1,l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal((m,p)=>{let y=s.get(m),S=Ts(this.query,p)?p:null,C=!!y&&this.mutatedKeys.has(y.key),k=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations),D=!1;y&&S?y.data.isEqual(S.data)?C!==k&&(n.track({type:3,doc:S}),D=!0):this.su(y,S)||(n.track({type:2,doc:S}),D=!0,(l&&this.eu(S,l)>0||d&&this.eu(S,d)<0)&&(c=!0)):!y&&S?(n.track({type:0,doc:S}),D=!0):y&&!S&&(n.track({type:1,doc:y}),D=!0,(l||d)&&(c=!0)),D&&(S?(a=a.add(S),i=k?i.add(m):i.delete(m)):(a=a.delete(m),i=i.delete(m)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let m=this.query.limitType==="F"?a.last():a.first();a=a.delete(m.key),i=i.delete(m.key),n.track({type:1,doc:m})}return{tu:a,iu:n,Cs:c,mutatedKeys:i}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,s){let i=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;let a=t.iu.ya();a.sort((m,p)=>function(S,C){let k=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return F(20277,{Rt:D})}};return k(S)-k(C)}(m.type,p.type)||this.eu(m.doc,p.doc)),this.ou(n),s=s??!1;let c=e&&!s?this._u():[],l=this.Xa.size===0&&this.current&&!s?1:0,d=l!==this.Za;return this.Za=l,a.length!==0||d?{snapshot:new sr(this.query,t.tu,i,a,t.mutatedKeys,l===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:c}:{au:c}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new ro,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=t.current)}_u(){if(!this.current)return[];let t=this.Xa;this.Xa=$(),this.tu.forEach(n=>{this.uu(n.key)&&(this.Xa=this.Xa.add(n.key))});let e=[];return t.forEach(n=>{this.Xa.has(n)||e.push(new io(n))}),this.Xa.forEach(n=>{t.has(n)||e.push(new so(n))}),e}cu(t){this.Ya=t.Qs,this.Xa=$();let e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return sr.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}},nl="SyncEngine",hu=class{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}},du=class{constructor(t){this.key=t,this.hu=!1}},fu=class{constructor(t,e,n,s,i,a){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new $t(c=>Mf(c),vo),this.Iu=new Map,this.Eu=new Set,this.du=new ot(M.comparator),this.Au=new Map,this.Ru=new fs,this.Vu={},this.mu=new Map,this.fu=rr.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}};function V_(r,t,e=!0){return V(this,null,function*(){let n=Cm(r),s,i=n.Tu.get(t);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=yield Am(n,t,e,!0),s})}function x_(r,t){return V(this,null,function*(){let e=Cm(r);yield Am(e,t,!0,!1)})}function Am(r,t,e,n){return V(this,null,function*(){let s=yield m_(r.localStore,Ut(t)),i=s.targetId,a=r.sharedClientState.addLocalQueryTarget(i,e),c;return n&&(c=yield N_(r,t,i,a==="current",s.resumeToken)),r.isPrimaryClient&&e&&_m(r.remoteStore,s),c})}function N_(r,t,e,n,s){return V(this,null,function*(){r.pu=(p,y,S)=>function(k,D,G,q){return V(this,null,function*(){let B=D.view.ru(G);B.Cs&&(B=yield qd(k.localStore,D.query,!1).then(({documents:E})=>D.view.ru(E,B)));let X=q&&q.targetChanges.get(D.targetId),et=q&&q.targetMismatches.get(D.targetId)!=null,H=D.view.applyChanges(B,k.isPrimaryClient,X,et);return Wd(k,D.targetId,H.au),H.snapshot})}(r,p,y,S);let i=yield qd(r.localStore,t,!0),a=new lu(t,i.Qs),c=a.ru(i.documents),l=hs.createSynthesizedTargetChangeForCurrentChange(e,n&&r.onlineState!=="Offline",s),d=a.applyChanges(c,r.isPrimaryClient,l);Wd(r,e,d.au);let m=new hu(t,e,a);return r.Tu.set(t,m),r.Iu.has(e)?r.Iu.get(e).push(t):r.Iu.set(e,[t]),d.snapshot})}function k_(r,t,e){return V(this,null,function*(){let n=j(r),s=n.Tu.get(t),i=n.Iu.get(s.targetId);if(i.length>1)return n.Iu.set(s.targetId,i.filter(a=>!vo(a,t))),void n.Tu.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||(yield Wc(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),e&&Wu(n.remoteStore,s.targetId),mu(n,s.targetId)}).catch(_n))):(mu(n,s.targetId),yield Wc(n.localStore,s.targetId,!0))})}function O_(r,t){return V(this,null,function*(){let e=j(r),n=e.Tu.get(t),s=e.Iu.get(n.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),Wu(e.remoteStore,n.targetId))})}function M_(r,t,e){return V(this,null,function*(){let n=Dm(r);try{let s=yield function(a,c){let l=j(a),d=it.now(),m=c.reduce((S,C)=>S.add(C.key),$()),p,y;return l.persistence.runTransaction("Locally write mutations","readwrite",S=>{let C=Lt(),k=$();return l.Ns.getEntries(S,m).next(D=>{C=D,C.forEach((G,q)=>{q.isValidDocument()||(k=k.add(G))})}).next(()=>l.localDocuments.getOverlayedDocuments(S,C)).next(D=>{p=D;let G=[];for(let q of c){let B=By(q,p.get(q.key).overlayedDocument);B!=null&&G.push(new Kt(q.key,B,Cf(B.value.mapValue),_t.exists(!0)))}return l.mutationQueue.addMutationBatch(S,d,G,c)}).next(D=>{y=D;let G=D.applyToLocalDocumentSet(p,k);return l.documentOverlayCache.saveOverlays(S,D.batchId,G)})}).then(()=>({batchId:y.batchId,changes:Bf(p)}))}(n.localStore,t);n.sharedClientState.addPendingMutation(s.batchId),function(a,c,l){let d=a.Vu[a.currentUser.toKey()];d||(d=new ot(z)),d=d.insert(c,l),a.Vu[a.currentUser.toKey()]=d}(n,s.batchId,e),yield Ss(n,s.changes),yield bs(n.remoteStore)}catch(s){let i=Yu(s,"Failed to persist write");e.reject(i)}})}function bm(r,t){return V(this,null,function*(){let e=j(r);try{let n=yield h_(e.localStore,t);t.targetChanges.forEach((s,i)=>{let a=e.Au.get(i);a&&(L(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?L(a.hu,14607):s.removedDocuments.size>0&&(L(a.hu,42227),a.hu=!1))}),yield Ss(e,n,t)}catch(n){yield _n(n)}})}function Qd(r,t,e){let n=j(r);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){let s=[];n.Tu.forEach((i,a)=>{let c=a.view.va(t);c.snapshot&&s.push(c.snapshot)}),function(a,c){let l=j(a);l.onlineState=c;let d=!1;l.queries.forEach((m,p)=>{for(let y of p.Sa)y.va(c)&&(d=!0)}),d&&el(l)}(n.eventManager,t),s.length&&n.Pu.H_(s),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}function F_(r,t,e){return V(this,null,function*(){let n=j(r);n.sharedClientState.updateQueryState(t,"rejected",e);let s=n.Au.get(t),i=s&&s.key;if(i){let a=new ot(M.comparator);a=a.insert(i,Et.newNoDocument(i,U.min()));let c=$().add(i),l=new Vi(U.min(),new Map,new ot(z),a,c);yield bm(n,l),n.du=n.du.remove(i),n.Au.delete(t),rl(n)}else yield Wc(n.localStore,t,!1).then(()=>mu(n,t,e)).catch(_n)})}function L_(r,t){return V(this,null,function*(){let e=j(r),n=t.batch.batchId;try{let s=yield l_(e.localStore,t);Rm(e,n,null),Sm(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),yield Ss(e,s)}catch(s){yield _n(s)}})}function B_(r,t,e){return V(this,null,function*(){let n=j(r);try{let s=yield function(a,c){let l=j(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let m;return l.mutationQueue.lookupMutationBatch(d,c).next(p=>(L(p!==null,37113),m=p.keys(),l.mutationQueue.removeMutationBatch(d,p))).next(()=>l.mutationQueue.performConsistencyCheck(d)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(d,m,c)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,m)).next(()=>l.localDocuments.getDocuments(d,m))})}(n.localStore,t);Rm(n,t,e),Sm(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),yield Ss(n,s)}catch(s){yield _n(s)}})}function Sm(r,t){(r.mu.get(t)||[]).forEach(e=>{e.resolve()}),r.mu.delete(t)}function Rm(r,t,e){let n=j(r),s=n.Vu[n.currentUser.toKey()];if(s){let i=s.get(t);i&&(e?i.reject(e):i.resolve(),s=s.remove(t)),n.Vu[n.currentUser.toKey()]=s}}function mu(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(let n of r.Iu.get(t))r.Tu.delete(n),e&&r.Pu.yu(n,e);r.Iu.delete(t),r.isPrimaryClient&&r.Ru.jr(t).forEach(n=>{r.Ru.containsKey(n)||Pm(r,n)})}function Pm(r,t){r.Eu.delete(t.path.canonicalString());let e=r.du.get(t);e!==null&&(Wu(r.remoteStore,e),r.du=r.du.remove(t),r.Au.delete(e),rl(r))}function Wd(r,t,e){for(let n of e)n instanceof so?(r.Ru.addReference(n.key,t),U_(r,n)):n instanceof io?(N(nl,"Document no longer in limbo: "+n.key),r.Ru.removeReference(n.key,t),r.Ru.containsKey(n.key)||Pm(r,n.key)):F(19791,{wu:n})}function U_(r,t){let e=t.key,n=e.path.canonicalString();r.du.get(e)||r.Eu.has(n)||(N(nl,"New document in limbo: "+e),r.Eu.add(n),rl(r))}function rl(r){for(;r.Eu.size>0&&r.du.size<r.maxConcurrentLimboResolutions;){let t=r.Eu.values().next().value;r.Eu.delete(t);let e=new M(Y.fromString(t)),n=r.fu.next();r.Au.set(n,new du(e)),r.du=r.du.insert(e,n),_m(r.remoteStore,new nr(Ut(vs(e.path)),n,"TargetPurposeLimboResolution",Gt.ce))}}function Ss(r,t,e){return V(this,null,function*(){let n=j(r),s=[],i=[],a=[];n.Tu.isEmpty()||(n.Tu.forEach((c,l)=>{a.push(n.pu(l,t,e).then(d=>{if((d||e)&&n.isPrimaryClient){let m=d?!d.fromCache:e?.targetChanges.get(l.targetId)?.current;n.sharedClientState.updateQueryState(l.targetId,m?"current":"not-current")}if(d){s.push(d);let m=$c.As(l.targetId,d);i.push(m)}}))}),yield Promise.all(a),n.Pu.H_(s),yield function(l,d){return V(this,null,function*(){let m=j(l);try{yield m.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>b.forEach(d,y=>b.forEach(y.Es,S=>m.persistence.referenceDelegate.addReference(p,y.targetId,S)).next(()=>b.forEach(y.ds,S=>m.persistence.referenceDelegate.removeReference(p,y.targetId,S)))))}catch(p){if(!Me(p))throw p;N(Qu,"Failed to update sequence numbers: "+p)}for(let p of d){let y=p.targetId;if(!p.fromCache){let S=m.Ms.get(y),C=S.snapshotVersion,k=S.withLastLimboFreeSnapshotVersion(C);m.Ms=m.Ms.insert(y,k)}}})}(n.localStore,i))})}function q_(r,t){return V(this,null,function*(){let e=j(r);if(!e.currentUser.isEqual(t)){N(nl,"User change. New user:",t.toKey());let n=yield gm(e.localStore,t);e.currentUser=t,function(i,a){i.mu.forEach(c=>{c.forEach(l=>{l.reject(new x(P.CANCELLED,a))})}),i.mu.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),yield Ss(e,n.Ls)}})}function j_(r,t){let e=j(r),n=e.Au.get(t);if(n&&n.hu)return $().add(n.key);{let s=$(),i=e.Iu.get(t);if(!i)return s;for(let a of i){let c=e.Tu.get(a);s=s.unionWith(c.view.nu)}return s}}function Cm(r){let t=j(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=bm.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=j_.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=F_.bind(null,t),t.Pu.H_=C_.bind(null,t.eventManager),t.Pu.yu=D_.bind(null,t.eventManager),t}function Dm(r){let t=j(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=L_.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=B_.bind(null,t),t}var sl=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return V(this,null,function*(){this.serializer=To(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),yield this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)})}Fu(e,n){return null}Mu(e,n){return null}vu(e){return pm(this.persistence,new Hi,e.initialUser,this.serializer)}Cu(e){return new ms(Qi.mi,this.serializer)}Du(e){return new Xi}terminate(){return V(this,null,function*(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return r.provider={build:()=>new r},r})(),pu=class extends sl{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){L(this.persistence.referenceDelegate instanceof Wi,46915);let n=this.persistence.referenceDelegate.garbageCollector;return new Gi(n,t.asyncQueue,e)}Cu(t){let e=this.cacheSizeBytes!==void 0?Nt.withCacheSize(this.cacheSizeBytes):Nt.DEFAULT;return new ms(n=>Wi.mi(n,e),this.serializer)}},gu=class r extends sl{constructor(t,e,n){super(),this.xu=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(t){return V(this,null,function*(){yield hh(r.prototype,this,"initialize").call(this,t),yield this.xu.initialize(this,t),yield Dm(this.xu.syncEngine),yield bs(this.xu.remoteStore),yield this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}vu(t){return pm(this.persistence,new Hi,t.initialUser,this.serializer)}Fu(t,e){let n=this.persistence.referenceDelegate.garbageCollector;return new Gi(n,t.asyncQueue,e)}Mu(t,e){let n=new za(e,this.persistence);return new ja(t.asyncQueue,n)}Cu(t){let e=c_(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Nt.withCacheSize(this.cacheSizeBytes):Nt.DEFAULT;return new Gc(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,y_(),di(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(t){return new Xi}};var Vm=(()=>{class r{initialize(e,n){return V(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>Qd(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=q_.bind(null,this.syncEngine),yield P_(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new cu}()}createDatastore(e){let n=To(e.databaseInfo.databaseId),s=function(a){return new Zc(a)}(e.databaseInfo);return function(a,c,l,d){return new ru(a,c,l,d)}(e.authCredentials,e.appCheckCredentials,s,n)}createRemoteStore(e){return function(s,i,a,c,l){return new iu(s,i,a,c,l)}(this.localStore,this.datastore,e.asyncQueue,n=>Qd(this.syncEngine,n,0),function(){return Yi.v()?new Yi:new Hc}())}createSyncEngine(e,n){return function(i,a,c,l,d,m,p){let y=new fu(i,a,c,l,d,m);return p&&(y.gu=!0),y}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return V(this,null,function*(){yield function(n){return V(this,null,function*(){let s=j(n);N(gn,"RemoteStore shutting down."),s.Ea.add(5),yield As(s),s.Aa.shutdown(),s.Ra.set("Unknown")})}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()})}}return r.provider={build:()=>new r},r})();var gs=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):Ct("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout(()=>{this.muted||t(e)},0)}};var Oe="FirestoreClient",yu=class{constructor(t,e,n,s,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=ht.UNAUTHENTICATED,this.clientId=Yr.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,a=>V(this,null,function*(){N(Oe,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(n,a=>(N(Oe,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new Bt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>V(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let n=Yu(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}};function Da(r,t){return V(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),N(Oe,"Initializing OfflineComponentProvider");let e=r.configuration;yield t.initialize(e);let n=e.initialUser;r.setCredentialChangeListener(s=>V(null,null,function*(){n.isEqual(s)||(yield gm(t.localStore,s),n=s)})),t.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=t})}function Hd(r,t){return V(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let e=yield z_(r);N(Oe,"Initializing OnlineComponentProvider"),yield t.initialize(e,r.configuration),r.setCredentialChangeListener(n=>Gd(t.remoteStore,n)),r.setAppCheckTokenChangeListener((n,s)=>Gd(t.remoteStore,s)),r._onlineComponents=t})}function z_(r){return V(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){N(Oe,"Using user provided OfflineComponentProvider");try{yield Da(r,r._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!function(s){return s.name==="FirebaseError"?s.code===P.FAILED_PRECONDITION||s.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(e))throw e;cn("Error using user provided cache. Falling back to memory cache: "+e),yield Da(r,new sl)}}else N(Oe,"Using default OfflineComponentProvider"),yield Da(r,new pu(void 0));return r._offlineComponents})}function il(r){return V(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(N(Oe,"Using user provided OnlineComponentProvider"),yield Hd(r,r._uninitializedComponentsProvider._online)):(N(Oe,"Using default OnlineComponentProvider"),yield Hd(r,new Vm))),r._onlineComponents})}function G_(r){return il(r).then(t=>t.syncEngine)}function $_(r){return il(r).then(t=>t.datastore)}function oo(r){return V(this,null,function*(){let t=yield il(r),e=t.eventManager;return e.onListen=V_.bind(null,t.syncEngine),e.onUnlisten=k_.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=x_.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=O_.bind(null,t.syncEngine),e})}function K_(r,t,e={}){let n=new Bt;return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return function(i,a,c,l,d){let m=new gs({next:y=>{m.Nu(),a.enqueueAndForget(()=>tl(i,p));let S=y.docs.has(c);!S&&y.fromCache?d.reject(new x(P.UNAVAILABLE,"Failed to get document because the client is offline.")):S&&y.fromCache&&l&&l.source==="server"?d.reject(new x(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(y)},error:y=>d.reject(y)}),p=new ps(vs(c.path),m,{includeMetadataChanges:!0,qa:!0});return Zu(i,p)}(yield oo(r),r.asyncQueue,t,e,n)})),n.promise}function Q_(r,t,e={}){let n=new Bt;return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return function(i,a,c,l,d){let m=new gs({next:y=>{m.Nu(),a.enqueueAndForget(()=>tl(i,p)),y.fromCache&&l.source==="server"?d.reject(new x(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(y)},error:y=>d.reject(y)}),p=new ps(c,m,{includeMetadataChanges:!0,qa:!0});return Zu(i,p)}(yield oo(r),r.asyncQueue,t,e,n)})),n.promise}function W_(r,t,e){let n=new Bt;return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){try{let s=yield $_(r);n.resolve(function(a,c,l){return V(this,null,function*(){let d=j(a),{request:m,gt:p,parent:y}=Xy(d.serializer,Sy(c),l);d.connection.$o||delete m.parent;let S=(yield d.Ho("RunAggregationQuery",d.serializer.databaseId,y,m,1)).filter(k=>!!k.result);L(S.length===1,64727);let C=S[0].result?.aggregateFields;return Object.keys(C).reduce((k,D)=>(k[p[D]]=C[D],k),{})})}(s,t,e))}catch(s){n.reject(s)}})),n.promise}function xm(r){let t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}var Jd=new Map;var Nm="firestore.googleapis.com",Xd=!0,ao=class{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new x(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Nm,this.ssl=Xd}else this.host=t.host,this.ssl=t.ssl??Xd;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=um;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<o_)throw new x(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}Gg("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=xm(t.experimentalLongPollingOptions??{}),function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(n,s){return n.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},ir=class{constructor(t,e,n,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ao({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new x(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new x(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ao(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new xa;switch(n.type){case"firstParty":return new Ma(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new x(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return V(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let n=Jd.get(e);n&&(N("ComponentProvider","Removing Datastore"),Jd.delete(e),n.terminate())}(this),Promise.resolve()}};function H_(r,t,e,n={}){r=wt(r,ir);let s=Ws(t),i=r._getSettings(),a=xr(yt({},i),{emulatorOptions:r._getEmulatorOptions()}),c=`${t}:${e}`;s&&(wh(`https://${c}`),Ih("Firestore",!0)),i.host!==Nm&&i.host!==c&&cn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l=xr(yt({},i),{host:c,ssl:s,emulatorOptions:n});if(!An(l,a)&&(r._setSettings(l),n.mockUserToken)){let d,m;if(typeof n.mockUserToken=="string")d=n.mockUserToken,m=ht.MOCK_USER;else{d=Eh(n.mockUserToken,r._app?.options.projectId);let p=n.mockUserToken.sub||n.mockUserToken.user_id;if(!p)throw new x(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");m=new ht(p)}r._authCredentials=new Na(new fi(d,m))}}var Zt=class r{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new r(this.firestore,t,this._query)}},ft=class r{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ae(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new r(this.firestore,t,this._key)}toJSON(){return{type:r._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,n){if(ws(e,r._jsonSchema))return new r(t,n||null,new M(Y.fromString(e.referencePath)))}};ft._jsonSchemaVersion="firestore/documentReference/1.0",ft._jsonSchema={type:lt("string",ft._jsonSchemaVersion),referencePath:lt("string")};var Ae=class r extends Zt{constructor(t,e,n){super(t,e,vs(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new ft(this.firestore,null,new M(t))}withConverter(t){return new r(this.firestore,t,this._path)}};function eE(r,t,...e){if(r=xt(r),of("collection","path",t),r instanceof ir){let n=Y.fromString(t,...e);return Wh(n),new Ae(r,null,n)}{if(!(r instanceof ft||r instanceof Ae))throw new x(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(Y.fromString(t,...e));return Wh(n),new Ae(r.firestore,null,n)}}function J_(r,t,...e){if(r=xt(r),arguments.length===1&&(t=Yr.newId()),of("doc","path",t),r instanceof ir){let n=Y.fromString(t,...e);return Qh(n),new ft(r,null,new M(n))}{if(!(r instanceof ft||r instanceof Ae))throw new x(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(Y.fromString(t,...e));return Qh(n),new ft(r.firestore,r instanceof Ae?r.converter:null,new M(n))}}var Yd="AsyncQueue",co=class{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Zi(this,"async_queue_retry"),this._c=()=>{let n=di();n&&N(Yd,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=t;let e=di();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;let e=di();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise(()=>{});let e=new Bt;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Xu.push(t),this.lc()))}lc(){return V(this,null,function*(){if(this.Xu.length!==0){try{yield this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!Me(t))throw t;N(Yd,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}})}cc(t){let e=this.ac.then(()=>(this.rc=!0,t().catch(n=>{throw this.nc=n,this.rc=!1,Ct("INTERNAL UNHANDLED ERROR: ",Zd(n)),n}).then(n=>(this.rc=!1,n))));return this.ac=e,e}enqueueAfterDelay(t,e,n){this.uc(),this.oc.indexOf(t)>-1&&(e=0);let s=ou.createAndSchedule(this,t,e,n,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&F(47125,{Pc:Zd(this.nc)})}verifyOperationInProgress(){}Tc(){return V(this,null,function*(){let t;do t=this.ac,yield t;while(t!==this.ac)})}Ic(t){for(let e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then(()=>{this.tc.sort((e,n)=>e.targetTimeMs-n.targetTimeMs);for(let e of this.tc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tc()})}dc(t){this.oc.push(t)}hc(t){let e=this.tc.indexOf(t);this.tc.splice(e,1)}};function Zd(r){let t=r.message||"";return r.stack&&(t=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),t}function tf(r){return function(e,n){if(typeof e!="object"||e===null)return!1;let s=e;for(let i of n)if(i in s&&typeof s[i]=="function")return!0;return!1}(r,["next","error","complete"])}var kt=class extends ir{constructor(t,e,n,s){super(t,e,n,s),this.type="firestore",this._queue=new co,this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){return V(this,null,function*(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new co(t),this._firestoreClient=void 0,yield t}})}};function nE(r,t){let e=typeof r=="object"?r:Bh(),n=typeof r=="string"?r:t||Ti,s=Mh(e,"firestore").getImmediate({identifier:n});if(!s._initialized){let i=_h("firestore");i&&H_(s,...i)}return s}function hr(r){if(r._terminated)throw new x(P.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||km(r),r._firestoreClient}function km(r){let t=r._freezeSettings(),e=function(s,i,a,c){return new Qa(s,i,a,c.host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,xm(c.experimentalLongPollingOptions),c.useFetchStreams,c.isUsingEmulator)}(r._databaseId,r._app?.options.appId||"",r._persistenceKey,t);r._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(r._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),r._firestoreClient=new yu(r._authCredentials,r._appCheckCredentials,r._queue,e,r._componentsProvider&&function(s){let i=s?._online.build();return{_offline:s?._offline.build(i),_online:i}}(r._componentsProvider))}function rE(r,t){cn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=r._freezeSettings();return X_(r,Vm.provider,{build:n=>new gu(n,e.cacheSizeBytes,t?.forceOwnership)}),Promise.resolve()}function X_(r,t,e){if((r=wt(r,kt))._firestoreClient||r._terminated)throw new x(P.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(r._componentsProvider||r._getSettings().localCache)throw new x(P.FAILED_PRECONDITION,"SDK cache is already specified.");r._componentsProvider={_online:t,_offline:e},km(r)}var _u=class{constructor(t="count",e){this._internalFieldPath=e,this.type="AggregateField",this.aggregateType=t}},wu=class{constructor(t,e,n){this._userDataWriter=e,this._data=n,this.type="AggregateQuerySnapshot",this.query=t}data(){return this._userDataWriter.convertObjectMap(this._data)}};var be=class r{constructor(t){this._byteString=t}static fromBase64String(t){try{return new r(mt.fromBase64String(t))}catch(e){throw new x(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new r(mt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:r._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(ws(t,r._jsonSchema))return r.fromBase64String(t.bytes)}};be._jsonSchemaVersion="firestore/bytes/1.0",be._jsonSchema={type:lt("string",be._jsonSchemaVersion),bytes:lt("string")};var yn=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new x(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new dt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var or=class{constructor(t){this._methodName=t}};var Se=class r{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new x(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new x(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return z(this._lat,t._lat)||z(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:r._jsonSchemaVersion}}static fromJSON(t){if(ws(t,r._jsonSchema))return new r(t.latitude,t.longitude)}};Se._jsonSchemaVersion="firestore/geoPoint/1.0",Se._jsonSchema={type:lt("string",Se._jsonSchemaVersion),latitude:lt("number"),longitude:lt("number")};var Re=class r{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(n,s){if(n.length!==s.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==s[i])return!1;return!0}(this._values,t._values)}toJSON(){return{type:r._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(ws(t,r._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every(e=>typeof e=="number"))return new r(t.vectorValues);throw new x(P.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};Re._jsonSchemaVersion="firestore/vectorValue/1.0",Re._jsonSchema={type:lt("string",Re._jsonSchemaVersion),vectorValues:lt("object")};var Y_=/^__.*__$/,Eu=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new Kt(t,this.data,this.fieldMask,e,this.fieldTransforms):new Ne(t,this.data,e,this.fieldTransforms)}},uo=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Kt(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function Om(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw F(40011,{Ac:r})}}var Iu=class r{constructor(t,e,n,s,i,a){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new r(yt(yt({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){let e=this.path?.child(t),n=this.Vc({path:e,fc:!1});return n.gc(t),n}yc(t){let e=this.path?.child(t),n=this.Vc({path:e,fc:!1});return n.Rc(),n}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return ho(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(t.length===0)throw this.Sc("Document fields must not be empty");if(Om(this.Ac)&&Y_.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}},vu=class{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||To(t)}Cc(t,e,n,s=!1){return new Iu({Ac:t,methodName:e,Dc:n,path:dt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function dr(r){let t=r._freezeSettings(),e=To(r._databaseId);return new vu(r._databaseId,!!t.ignoreUndefinedProperties,e)}function ol(r,t,e,n,s,i={}){let a=r.Cc(i.merge||i.mergeFields?2:0,t,e,s);al("Data must be an object, but it was:",a,n);let c=Bm(n,a),l,d;if(i.merge)l=new Ft(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){let m=[];for(let p of i.mergeFields){let y=Au(t,p,e);if(!a.contains(y))throw new x(P.INVALID_ARGUMENT,`Field '${y}' is specified in your field mask but missing from your input data.`);qm(m,y)||m.push(y)}l=new Ft(m),d=a.fieldTransforms.filter(p=>l.covers(p.field))}else l=null,d=a.fieldTransforms;return new Eu(new Dt(c),l,d)}var lo=class r extends or{_toFieldTransform(t){if(t.Ac!==2)throw t.Ac===1?t.Sc(`${this._methodName}() can only appear at the top level of your update data`):t.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof r}};var Tu=class r extends or{_toFieldTransform(t){return new Ci(t.path,new De)}isEqual(t){return t instanceof r}};function Mm(r,t,e,n){let s=r.Cc(1,t,e);al("Data must be an object, but it was:",s,n);let i=[],a=Dt.empty();Fe(n,(l,d)=>{let m=cl(t,l,e);d=xt(d);let p=s.yc(m);if(d instanceof lo)i.push(m);else{let y=Rs(d,p);y!=null&&(i.push(m),a.set(m,y))}});let c=new Ft(i);return new uo(a,c,s.fieldTransforms)}function Fm(r,t,e,n,s,i){let a=r.Cc(1,t,e),c=[Au(t,n,e)],l=[s];if(i.length%2!=0)throw new x(P.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let y=0;y<i.length;y+=2)c.push(Au(t,i[y])),l.push(i[y+1]);let d=[],m=Dt.empty();for(let y=c.length-1;y>=0;--y)if(!qm(d,c[y])){let S=c[y],C=l[y];C=xt(C);let k=a.yc(S);if(C instanceof lo)d.push(S);else{let D=Rs(C,k);D!=null&&(d.push(S),m.set(S,D))}}let p=new Ft(d);return new uo(m,p,a.fieldTransforms)}function Lm(r,t,e,n=!1){return Rs(e,r.Cc(n?4:3,t))}function Rs(r,t){if(Um(r=xt(r)))return al("Unsupported field value:",t,r),Bm(r,t);if(r instanceof or)return function(n,s){if(!Om(s.Ac))throw s.Sc(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${n._methodName}() is not currently supported inside arrays`);let i=n._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.fc&&t.Ac!==4)throw t.Sc("Nested arrays are not supported");return function(n,s){let i=[],a=0;for(let c of n){let l=Rs(c,s.wc(a));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),a++}return{arrayValue:{values:i}}}(r,t)}return function(n,s){if((n=xt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return ky(s.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let i=it.fromDate(n);return{timestampValue:er(s.serializer,i)}}if(n instanceof it){let i=new it(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:er(s.serializer,i)}}if(n instanceof Se)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof be)return{bytesValue:Hf(s.serializer,n._byteString)};if(n instanceof ft){let i=s.databaseId,a=n.firestore._databaseId;if(!a.isEqual(i))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Gu(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof Re)return function(a,c){return{mapValue:{fields:{[Bu]:{stringValue:Uu},[Jn]:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw c.Sc("VectorValues must only contain numeric values.");return zu(c.serializer,d)})}}}}}}(n,s);throw s.Sc(`Unsupported field value: ${mo(n)}`)}(r,t)}function Bm(r,t){let e={};return If(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Fe(r,(n,s)=>{let i=Rs(s,t.mc(n));i!=null&&(e[n]=i)}),{mapValue:{fields:e}}}function Um(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof it||r instanceof Se||r instanceof be||r instanceof ft||r instanceof or||r instanceof Re)}function al(r,t,e){if(!Um(e)||!af(e)){let n=mo(e);throw n==="an object"?t.Sc(r+" a custom object"):t.Sc(r+" "+n)}}function Au(r,t,e){if((t=xt(t))instanceof yn)return t._internalPath;if(typeof t=="string")return cl(r,t);throw ho("Field path arguments must be of type string or ",r,!1,void 0,e)}var Z_=new RegExp("[~\\*/\\[\\]]");function cl(r,t,e){if(t.search(Z_)>=0)throw ho(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new yn(...t.split("."))._internalPath}catch{throw ho(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function ho(r,t,e,n,s){let i=n&&!n.isEmpty(),a=s!==void 0,c=`Function ${t}() called with invalid data`;e&&(c+=" (via `toFirestore()`)"),c+=". ";let l="";return(i||a)&&(l+=" (found",i&&(l+=` in field ${n}`),a&&(l+=` in document ${s}`),l+=")"),new x(P.INVALID_ARGUMENT,c+r+l)}function qm(r,t){return r.some(e=>e.isEqual(t))}var ys=class{constructor(t,e,n,s,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new ft(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new bu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(bo("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},bu=class extends ys{data(){return super.data()}};function bo(r,t){return typeof t=="string"?cl(r,t):t instanceof yn?t._internalPath:t._delegate._internalPath}function jm(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new x(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var _s=class{},ar=class extends _s{};function sE(r,t,...e){let n=[];t instanceof _s&&n.push(t),n=n.concat(e),function(i){let a=i.filter(l=>l instanceof Su).length,c=i.filter(l=>l instanceof fo).length;if(a>1||a>0&&c>0)throw new x(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let s of n)r=s._apply(r);return r}var fo=class r extends ar{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=this._parse(t);return zm(t._query,e),new Zt(t.firestore,t.converter,oc(t._query,e))}_parse(t){let e=dr(t.firestore);return function(i,a,c,l,d,m,p){let y;if(d.isKeyField()){if(m==="array-contains"||m==="array-contains-any")throw new x(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if(m==="in"||m==="not-in"){nf(p,m);let C=[];for(let k of p)C.push(ef(l,i,k));y={arrayValue:{values:C}}}else y=ef(l,i,p)}else m!=="in"&&m!=="not-in"&&m!=="array-contains-any"||nf(p,m),y=Lm(c,a,p,m==="in"||m==="not-in");return K.create(d,m,y)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function iE(r,t,e){let n=t,s=bo("where",r);return fo._create(s,n,e)}var Su=class r extends _s{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new r(t,e)}_parse(t){let e=this._queryConstraints.map(n=>n._parse(t)).filter(n=>n.getFilters().length>0);return e.length===1?e[0]:Z.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:(function(s,i){let a=s,c=i.getFlattenedFilters();for(let l of c)zm(a,l),a=oc(a,l)}(t._query,e),new Zt(t.firestore,t.converter,oc(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Ru=class r extends ar{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new r(t,e)}_apply(t){let e=function(s,i,a){if(s.startAt!==null)throw new x(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new x(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ln(i,a)}(t._query,this._field,this._direction);return new Zt(t.firestore,t.converter,function(s,i){let a=s.explicitOrderBy.concat([i]);return new he(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(t._query,e))}};function oE(r,t="asc"){let e=t,n=bo("orderBy",r);return Ru._create(n,e)}var Pu=class r extends ar{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){return new Zt(t.firestore,t.converter,Pi(t._query,this._limit,this._limitType))}};function aE(r){return $g("limit",r),Pu._create("limit",r,"F")}var Cu=class r extends ar{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=tw(t,this.type,this._docOrFields,this._inclusive);return new Zt(t.firestore,t.converter,function(s,i){return new he(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(t._query,e))}};function cE(...r){return Cu._create("startAfter",r,!1)}function tw(r,t,e,n){if(e[0]=xt(e[0]),e[0]instanceof ys)return function(i,a,c,l,d){if(!l)throw new x(P.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${c}().`);let m=[];for(let p of Bn(i))if(p.field.isKeyField())m.push(un(a,l.key));else{let y=l.data.field(p.field);if(wo(y))throw new x(P.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+p.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(y===null){let S=p.field.canonicalString();throw new x(P.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${S}' (used as the orderBy) does not exist.`)}m.push(y)}return new Yt(m,d)}(r._query,r.firestore._databaseId,t,e[0]._document,n);{let s=dr(r.firestore);return function(a,c,l,d,m,p){let y=a.explicitOrderBy;if(m.length>y.length)throw new x(P.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let S=[];for(let C=0;C<m.length;C++){let k=m[C];if(y[C].field.isKeyField()){if(typeof k!="string")throw new x(P.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof k}`);if(!ju(a)&&k.indexOf("/")!==-1)throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${k}' contains a slash.`);let D=a.path.child(Y.fromString(k));if(!M.isDocumentKey(D))throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${D}' is not because it contains an odd number of segments.`);let G=new M(D);S.push(un(c,G))}else{let D=Lm(l,d,k);S.push(D)}}return new Yt(S,p)}(r._query,r.firestore._databaseId,s,t,e,n)}}function ef(r,t,e){if(typeof(e=xt(e))=="string"){if(e==="")throw new x(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ju(t)&&e.indexOf("/")!==-1)throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let n=t.path.child(Y.fromString(e));if(!M.isDocumentKey(n))throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return un(r,new M(n))}if(e instanceof ft)return un(r,e._key);throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${mo(e)}.`)}function nf(r,t){if(!Array.isArray(r)||r.length===0)throw new x(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function zm(r,t){let e=function(s,i){for(let a of s)for(let c of a.getFlattenedFilters())if(i.indexOf(c.op)>=0)return c.op;return null}(r.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new x(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new x(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}var Du=class{convertValue(t,e="none"){switch(Pe(t)){case 0:return null;case 1:return t.booleanValue;case 2:return st(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(le(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw F(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let n={};return Fe(t,(s,i)=>{n[s]=this.convertValue(i,e)}),n}convertVectorValue(t){let e=t.fields?.[Jn].arrayValue?.values?.map(n=>st(n.doubleValue));return new Re(e)}convertGeoPoint(t){return new Se(st(t.latitude),st(t.longitude))}convertArray(t,e){return(t.values||[]).map(n=>this.convertValue(n,e))}convertServerTimestamp(t,e){switch(e){case"previous":let n=Eo(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(os(t));default:return null}}convertTimestamp(t){let e=ue(t);return new it(e.seconds,e.nanos)}convertDocumentKey(t,e){let n=Y.fromString(t);L(sm(n),9688,{name:t});let s=new Hn(n.get(1),n.get(3)),i=new M(n.popFirst(5));return s.isEqual(e)||Ct(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}};function ul(r,t,e){let n;return n=r?e&&(e.merge||e.mergeFields)?r.toFirestore(t,e):r.toFirestore(t):t,n}function ew(){return new _u("count")}var Ze=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},sn=class r extends ys{constructor(t,e,n,s,i,a){super(t,e,n,s,a),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new qn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let n=this._document.data.field(bo("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new x(P.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t=this._document,e={};return e.type=r._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}};sn._jsonSchemaVersion="firestore/documentSnapshot/1.0",sn._jsonSchema={type:lt("string",sn._jsonSchemaVersion),bundleSource:lt("string","DocumentSnapshot"),bundleName:lt("string"),bundle:lt("string")};var qn=class extends sn{data(t={}){return super.data(t)}},on=class r{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new Ze(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new qn(this._firestore,this._userDataWriter,n.key,n,new Ze(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new x(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(c=>{let l=new qn(s._firestore,s._userDataWriter,c.doc.key,c.doc,new Ze(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);return c.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(c=>i||c.type!==3).map(c=>{let l=new qn(s._firestore,s._userDataWriter,c.doc.key,c.doc,new Ze(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter),d=-1,m=-1;return c.type!==0&&(d=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),m=a.indexOf(c.doc.key)),{type:nw(c.type),doc:l,oldIndex:d,newIndex:m}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new x(P.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t={};t.type=r._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=Yr.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let e=[],n=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(e.push(i._document),n.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}};function nw(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return F(61501,{type:r})}}function uE(r){r=wt(r,ft);let t=wt(r.firestore,kt);return K_(hr(t),r._key).then(e=>Gm(t,r,e))}on._jsonSchemaVersion="firestore/querySnapshot/1.0",on._jsonSchema={type:lt("string",on._jsonSchemaVersion),bundleSource:lt("string","QuerySnapshot"),bundleName:lt("string"),bundle:lt("string")};var cr=class extends Du{constructor(t){super(),this.firestore=t}convertBytes(t){return new be(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new ft(this.firestore,null,e)}};function lE(r){r=wt(r,Zt);let t=wt(r.firestore,kt),e=hr(t),n=new cr(t);return jm(r._query),Q_(e,r._query).then(s=>new on(t,n,r,s))}function hE(r,t,e){r=wt(r,ft);let n=wt(r.firestore,kt),s=ul(r.converter,t,e);return Ps(n,[ol(dr(n),"setDoc",r._key,s,r.converter!==null,e).toMutation(r._key,_t.none())])}function dE(r,t,e,...n){r=wt(r,ft);let s=wt(r.firestore,kt),i=dr(s),a;return a=typeof(t=xt(t))=="string"||t instanceof yn?Fm(i,"updateDoc",r._key,t,e,n):Mm(i,"updateDoc",r._key,t),Ps(s,[a.toMutation(r._key,_t.exists(!0))])}function fE(r){return Ps(wt(r.firestore,kt),[new fn(r._key,_t.none())])}function mE(r,t){let e=wt(r.firestore,kt),n=J_(r),s=ul(r.converter,t);return Ps(e,[ol(dr(r.firestore),"addDoc",n._key,s,r.converter!==null,{}).toMutation(n._key,_t.exists(!1))]).then(()=>n)}function pE(r,...t){r=xt(r);let e={includeMetadataChanges:!1,source:"default"},n=0;typeof t[n]!="object"||tf(t[n])||(e=t[n++]);let s={includeMetadataChanges:e.includeMetadataChanges,source:e.source};if(tf(t[n])){let l=t[n];t[n]=l.next?.bind(l),t[n+1]=l.error?.bind(l),t[n+2]=l.complete?.bind(l)}let i,a,c;if(r instanceof ft)a=wt(r.firestore,kt),c=vs(r._key.path),i={next:l=>{t[n]&&t[n](Gm(a,r,l))},error:t[n+1],complete:t[n+2]};else{let l=wt(r,Zt);a=wt(l.firestore,kt),c=l._query;let d=new cr(a);i={next:m=>{t[n]&&t[n](new on(a,d,l,m))},error:t[n+1],complete:t[n+2]},jm(r._query)}return function(d,m,p,y){let S=new gs(y),C=new ps(m,S,p);return d.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return Zu(yield oo(d),C)})),()=>{S.Nu(),d.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return tl(yield oo(d),C)}))}}(hr(a),c,s,i)}function Ps(r,t){return function(n,s){let i=new Bt;return n.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return M_(yield G_(n),s,i)})),i.promise}(hr(r),t)}function Gm(r,t,e){let n=e.docs.get(t._key),s=new cr(r);return new sn(r,s,t._key,n,new Ze(e.hasPendingWrites,e.fromCache),t.converter)}function gE(r){return rw(r,{count:ew()})}function rw(r,t){let e=wt(r.firestore,kt),n=hr(e),s=Ey(t,(i,a)=>new uc(a,i.aggregateType,i._internalFieldPath));return W_(n,r._query,s).then(i=>function(c,l,d){let m=new cr(c);return new wu(l,m,d)}(e,r,i))}var Vu=class{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=dr(t)}set(t,e,n){this._verifyNotCommitted();let s=Va(t,this._firestore),i=ul(s.converter,e,n),a=ol(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,n);return this._mutations.push(a.toMutation(s._key,_t.none())),this}update(t,e,n,...s){this._verifyNotCommitted();let i=Va(t,this._firestore),a;return a=typeof(e=xt(e))=="string"||e instanceof yn?Fm(this._dataReader,"WriteBatch.update",i._key,e,n,s):Mm(this._dataReader,"WriteBatch.update",i._key,e),this._mutations.push(a.toMutation(i._key,_t.exists(!0))),this}delete(t){this._verifyNotCommitted();let e=Va(t,this._firestore);return this._mutations=this._mutations.concat(new fn(e._key,_t.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new x(P.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Va(r,t){if((r=xt(r)).firestore!==t)throw new x(P.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}function yE(){return new Tu("serverTimestamp")}function _E(r){return hr(r=wt(r,kt)),new Vu(r,t=>Ps(r,t))}(function(t,e=!0){(function(s){ur=s})(Lh),Fr(new se("firestore",(n,{instanceIdentifier:s,options:i})=>{let a=n.getProvider("app").getImmediate(),c=new kt(new ka(n.getProvider("auth-internal")),new Fa(a,n.getProvider("app-check-internal")),function(d,m){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new x(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Hn(d.options.projectId,m)}(a,s),a);return i=yt({useFetchStreams:e},i),c._setSettings(i),c},"PUBLIC").setMultipleInstances(!0)),ye(Gh,$h,t),ye(Gh,$h,"esm2020")})();var sw="firebase",iw="12.1.0";ye(sw,iw,"app");export{gh as a,yh as b,Dp as c,_h as d,cw as e,Ks as f,Ws as g,wh as h,Eh as i,Ih as j,je as k,uw as l,lw as m,hw as n,dw as o,fw as p,Hs as q,re as r,Or as s,mw as t,An as u,pw as v,gw as w,yw as x,_w as y,xt as z,se as A,Q as B,bn as C,Fr as D,Mh as E,Fh as F,Lh as G,Dg as H,Bh as I,Bw as J,ye as K,eE as L,J_ as M,nE as N,rE as O,sE as P,iE as Q,oE as R,aE as S,cE as T,uE as U,lE as V,hE as W,dE as X,fE as Y,mE as Z,pE as _,gE as $,yE as aa,_E as ba};
