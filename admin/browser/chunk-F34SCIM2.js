import{B as A,i as b,q as C,t as f,u as h,v as g,w as P,x as d,y as w,z as l}from"./chunk-FDAITWFV.js";import{aa as p}from"./chunk-5OO6GXAC.js";import{W as U,a as o,aa as m,b as y,g as i}from"./chunk-2KT3GOAN.js";var R=class u{db=m(C);auth=m(b);colRef=h(this.db,"pre_cadastros");criar(r){return i(this,null,function*(){let e=this.auth.currentUser;if(!e)throw new Error("Usu\xE1rio n\xE3o autenticado.");let t="Assessor";try{let c=yield P(g(this.db,"colaboradores",e.uid));t=c.data()?.papel?c.data()?.nome||e.displayName||"Assessor":e.displayName||"Assessor"}catch{}let s=y(o({},r),{createdByUid:e.uid,createdByNome:t,createdAt:p()});return(yield f(this.colRef,s)).id})}registrarFeedbackCliente(r,e){return i(this,null,function*(){let t=this.auth.currentUser;if(!t)throw new Error("Usu\xE1rio n\xE3o autenticado.");let s=h(this.db,`pre_cadastros/${r}/feedback_cliente`);yield f(s,y(o({},e),{assessorUid:t.uid,source:"cliente",createdAt:p()}))})}listarDoAssessor(r){return i(this,null,function*(){let e=r??this.auth.currentUser?.uid;if(!e)throw new Error("Usu\xE1rio n\xE3o autenticado.");try{let t=l(this.colRef,A("createdByUid","==",e),w("createdAt","desc"));return(yield d(t)).docs.map(n=>o({id:n.id},n.data()))}catch(t){console.warn("[PreCadastro] Fallback sem \xEDndice composto:",t?.message||t);let s=l(this.colRef,A("createdByUid","==",e)),c=(yield d(s)).docs.map(a=>o({id:a.id},a.data())),D=a=>a?.toMillis?a.toMillis():a?.toDate?a.toDate().getTime():typeof a=="number"?a:0;return c.sort((a,v)=>D(v.createdAt)-D(a.createdAt)),c}})}listarTodos(){return i(this,null,function*(){let r=l(this.colRef,w("createdAt","desc"));return(yield d(r)).docs.map(t=>o({id:t.id},t.data()))})}static \u0275fac=function(e){return new(e||u)};static \u0275prov=U({token:u,factory:u.\u0275fac,providedIn:"root"})};export{R as a};
