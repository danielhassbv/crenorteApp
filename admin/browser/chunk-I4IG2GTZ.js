import{a as F}from"./chunk-5Q5U7TJG.js";import"./chunk-S7BSO77O.js";import{c as O,f as T,i as V,t as D}from"./chunk-WYCOUGZ3.js";import{M as k,U as P,W}from"./chunk-5OO6GXAC.js";import{j as G,k as N,l as S,w as E}from"./chunk-DTXGXR4A.js";import{Bb as _,Cb as v,Db as b,Ka as d,Ua as M,Za as h,fb as f,g as y,ia as g,ib as i,ja as u,jb as r,kb as m,nb as x,qb as C,rb as p,xb as s,zb as w}from"./chunk-2KT3GOAN.js";function L(l,a){l&1&&(i(0,"div",33),s(1," Nenhum integrante adicionado. "),r())}function B(l,a){if(l&1){let n=x();i(0,"div",34)(1,"div",35)(2,"input",36),b("ngModelChange",function(e){let o=g(n).index,c=p();return v(c.integrantes[o].cpf,e)||(c.integrantes[o].cpf=e),u(e)}),r()(),i(3,"div",35)(4,"input",37),b("ngModelChange",function(e){let o=g(n).index,c=p();return v(c.integrantes[o].nome,e)||(c.integrantes[o].nome=e),u(e)}),r()(),i(5,"button",38),C("click",function(){let e=g(n).index,o=p();return u(o.removeIntegrante(e))}),m(6,"i",39),r()()}if(l&2){let n=a.index,t=p();d(2),_("ngModel",t.integrantes[n].cpf),d(2),_("ngModel",t.integrantes[n].nome)}}function j(l,a){if(l&1){let n=x();i(0,"div",40)(1,"div",41)(2,"input",36),b("ngModelChange",function(e){let o=g(n).index,c=p();return v(c.integrantes[o].cpf,e)||(c.integrantes[o].cpf=e),u(e)}),r(),i(3,"input",37),b("ngModelChange",function(e){let o=g(n).index,c=p();return v(c.integrantes[o].nome,e)||(c.integrantes[o].nome=e),u(e)}),r(),i(4,"button",42),C("click",function(){let e=g(n).index,o=p();return u(o.removeIntegrante(e))}),m(5,"i",43),s(6," Remover "),r()()()}if(l&2){let n=a.index,t=p();d(2),_("ngModel",t.integrantes[n].cpf),d(),_("ngModel",t.integrantes[n].nome)}}function A(l,a){if(l&1&&(i(0,"div",17)(1,"div",44),s(2),r()()),l&2){let n=p();d(),f("ngClass",n.ok?"alert-success":"alert-warning"),d(),w(" ",n.msg," ")}}var I=class l{nomeGrupo="";coordenadorCpf="";coordenadorNome="";cidade="";estado="";integrantes=[];msg="";ok=!1;salvando=!1;addIntegrante(){this.integrantes.push({cpf:"",nome:"",papel:"membro"})}removeIntegrante(a){this.integrantes.splice(a,1)}limpar(){this.nomeGrupo="",this.coordenadorCpf="",this.coordenadorNome="",this.cidade="",this.estado="",this.integrantes=[],this.msg="",this.ok=!1}onlyDigits(a){return(a??"").replace(/\D/g,"")}validarCpf(a){let n=this.onlyDigits(a);return n.length===11&&!/^(\d)\1{10}$/.test(n)}salvarGrupo(){return y(this,null,function*(){this.msg="",this.ok=!1;let a=this.onlyDigits(this.coordenadorCpf);if(!this.validarCpf(a)){this.msg="CPF do coordenador inv\xE1lido";return}let n=[{cpf:a,nome:this.coordenadorNome.trim()||void 0,papel:"coordenador"},...this.integrantes.map(e=>({cpf:this.onlyDigits(e.cpf),nome:(e.nome||"").trim()||void 0,papel:"membro"})).filter(e=>this.validarCpf(e.cpf)&&e.cpf!==a)],t={codigo:this.nomeGrupo.trim()||void 0,coordenadorCpf:a,coordenadorNome:this.coordenadorNome.trim()||void 0,membros:n,cidade:this.cidade.trim()||void 0,estado:this.estado.trim()||void 0,status:"em_qa",criadoEm:new Date,criadoPorUid:"system",criadoPorNome:"Assessor"};try{this.salvando=!0;let e=k(F,"grupos",a),o=yield P(e);o.exists()&&(t.criadoEm=o.data().criadoEm||t.criadoEm),yield W(e,t,{merge:!0}),this.ok=!0,this.msg="\u2705 Grupo criado com sucesso"}catch(e){console.error(e),this.ok=!1,this.msg="\u274C Erro ao salvar grupo"}finally{this.salvando=!1}})}static \u0275fac=function(n){return new(n||l)};static \u0275cmp=M({type:l,selectors:[["app-grupo-novo"]],decls:45,vars:8,consts:[[1,"container","py-4","crn-page"],[1,"d-flex","flex-wrap","align-items-center","justify-content-between","gap-2","mb-3","crn-header"],[1,"mb-0","fw-bold","text-success"],[1,"bi","bi-people-fill","me-2"],[1,"d-flex","gap-2"],["routerLink","/grupos/relatorio",1,"btn","btn-outline-secondary"],[1,"bi","bi-list-check","me-1"],[1,"crn-card"],[1,"row","g-3"],[1,"col-md-6"],[1,"form-label","crn-label"],[1,"position-relative"],[1,"bi","bi-type","crn-input-icon"],["placeholder","Ex.: Grupo Esperan\xE7a",1,"form-control","crn-input",3,"ngModelChange","ngModel"],[1,"bi","bi-person-vcard","crn-input-icon"],["placeholder","Somente d\xEDgitos",1,"form-control","crn-input",3,"ngModelChange","ngModel"],[1,"form-text"],[1,"col-12"],[1,"d-flex","align-items-center","justify-content-between"],[1,"form-label","crn-label","mb-0"],[1,"btn","btn-sm","btn-outline-success",3,"click"],[1,"bi","bi-plus-lg","me-1"],["class","text-muted small mt-2",4,"ngIf"],[1,"list-group","mt-2","d-none","d-md-block"],["class","list-group-item d-flex align-items-center gap-2",4,"ngFor","ngForOf"],[1,"d-block","d-md-none","mt-2"],["class","mobile-card shadow-sm border rounded-4 p-3 mb-2",4,"ngFor","ngForOf"],[1,"col-12","d-flex","gap-2","justify-content-end"],[1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-eraser","me-1"],[1,"btn","btn-success",3,"click","disabled"],[1,"bi","bi-check2-circle","me-1"],["class","col-12",4,"ngIf"],[1,"text-muted","small","mt-2"],[1,"list-group-item","d-flex","align-items-center","gap-2"],[1,"flex-fill"],["placeholder","CPF (somente d\xEDgitos)",1,"form-control",3,"ngModelChange","ngModel"],["placeholder","Nome (opcional)",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-outline-danger",3,"click"],[1,"bi","bi-trash"],[1,"mobile-card","shadow-sm","border","rounded-4","p-3","mb-2"],[1,"d-flex","flex-column","gap-2"],[1,"btn","btn-outline-danger","w-100",3,"click"],[1,"bi","bi-trash","me-1"],[1,"alert",3,"ngClass"]],template:function(n,t){n&1&&(i(0,"div",0)(1,"div",1)(2,"h3",2),m(3,"i",3),s(4,"Novo Grupo Solid\xE1rio "),r(),i(5,"div",4)(6,"a",5),m(7,"i",6),s(8," Relat\xF3rio de Grupos "),r()()(),i(9,"div",7)(10,"div",8)(11,"div",9)(12,"label",10),s(13,"Nome do Grupo"),r(),i(14,"div",11),m(15,"i",12),i(16,"input",13),b("ngModelChange",function(o){return v(t.nomeGrupo,o)||(t.nomeGrupo=o),o}),r()()(),i(17,"div",9)(18,"label",10),s(19,"CPF do Coordenador (Cliente aprovado)"),r(),i(20,"div",11),m(21,"i",14),i(22,"input",15),b("ngModelChange",function(o){return v(t.coordenadorCpf,o)||(t.coordenadorCpf=o),o}),r()(),i(23,"div",16),s(24,"O grupo ser\xE1 vinculado a este CPF."),r()(),i(25,"div",17)(26,"div",18)(27,"label",19),s(28,"Integrantes"),r(),i(29,"button",20),C("click",function(){return t.addIntegrante()}),m(30,"i",21),s(31,"Adicionar integrante "),r()(),h(32,L,2,0,"div",22),i(33,"div",23),h(34,B,7,2,"div",24),r(),i(35,"div",25),h(36,j,7,2,"div",26),r()(),i(37,"div",27)(38,"button",28),C("click",function(){return t.limpar()}),m(39,"i",29),s(40," Limpar "),r(),i(41,"button",30),C("click",function(){return t.salvarGrupo()}),m(42,"i",31),s(43),r()(),h(44,A,3,2,"div",32),r()()()),n&2&&(d(16),_("ngModel",t.nomeGrupo),d(6),_("ngModel",t.coordenadorCpf),d(10),f("ngIf",t.integrantes.length===0),d(2),f("ngForOf",t.integrantes),d(2),f("ngForOf",t.integrantes),d(5),f("disabled",t.salvando),d(2),w(" ",t.salvando?"Salvando...":"Criar Grupo"," "),d(),f("ngIf",t.msg))},dependencies:[E,G,N,S,D,O,T,V],styles:['[_nghost-%COMP%]{--crn-green: #006e37;--crn-green-soft: #eaf6f0;--crn-border: #e7edf0;--shadow-sm: 0 6px 18px rgba(0,0,0,.06)}.crn-card[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--crn-border);border-radius:16px;box-shadow:var(--shadow-sm);padding:16px;position:relative}.crn-card[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;background:linear-gradient(90deg,var(--crn-green),var(--crn-green)) top left/100% 4px no-repeat;border-radius:16px}.crn-label[_ngcontent-%COMP%]{font-weight:700;color:#23423a}.crn-input[_ngcontent-%COMP%]{border-radius:12px;border-color:var(--crn-border);padding:.65rem .9rem .65rem 2.2rem;transition:all .15s ease}.crn-input[_ngcontent-%COMP%]:focus{border-color:var(--crn-green);box-shadow:0 0 0 .18rem #006e372e}.crn-input-icon[_ngcontent-%COMP%]{position:absolute;left:10px;top:50%;transform:translateY(-50%);color:#9db6ac;pointer-events:none}.mobile-card[_ngcontent-%COMP%]{overflow:hidden}.mobile-card[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{min-width:0}']})};export{I as GrupoNovoComponent};
