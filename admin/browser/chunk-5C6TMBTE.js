import{a as x}from"./chunk-J65JDUIZ.js";import{c as N,e as m,f as F,g as I,j as L,m as M,n as P,s as k,u as D}from"./chunk-WYCOUGZ3.js";import"./chunk-FDAITWFV.js";import{f as w}from"./chunk-FTITK7GV.js";import"./chunk-UQF2N3UO.js";import"./chunk-5OO6GXAC.js";import{l as E,w as _}from"./chunk-DTXGXR4A.js";import{Ka as s,Ua as v,Za as b,aa as d,fb as u,g as p,ib as a,jb as r,kb as f,qb as h,rb as S,xa as c,xb as o,y as g,yb as y,zb as C}from"./chunk-2KT3GOAN.js";function T(l,i){if(l&1&&(a(0,"div",9),o(1),r()),l&2){let e=S();s(),y(e.erro())}}var R=class l{fb=d(k);auth=d(x);router=d(w);loading=c(!1);erro=c(null);form=this.fb.group({email:["",[m.required,m.email]],senha:["",[m.required,m.minLength(6)]]});onSubmit(){return p(this,null,function*(){if(this.form.invalid)return;this.loading.set(!0),this.erro.set(null);let{email:i,senha:e}=this.form.value;try{yield this.auth.login(i,e),yield this.auth.garantirPerfilMinimo();let t=yield g(this.auth.papel$),n=this.definirRotaPorPapel(t);yield this.router.navigate([n])}catch(t){let n=String(t?.message??t??"");n.includes("auth/invalid-credential")||n.includes("auth/invalid-login-credentials")?this.erro.set("E-mail ou senha inv\xE1lidos."):n.includes("auth/user-not-found")?this.erro.set("Usu\xE1rio n\xE3o encontrado."):n.includes("auth/wrong-password")?this.erro.set("Senha incorreta."):n.includes("auth/too-many-requests")?this.erro.set("Muitas tentativas. Tente novamente mais tarde."):this.erro.set("Falha no login. "+n)}finally{this.loading.set(!1)}})}reset(){return p(this,null,function*(){let i=this.form.get("email")?.value;if(!i){this.erro.set("Informe seu e-mail para recuperar a senha.");return}try{yield this.auth.resetSenha(i),this.erro.set("Enviamos um link de redefini\xE7\xE3o para seu e-mail.")}catch(e){let t=String(e?.message??e??"");this.erro.set("Falha ao enviar e-mail de redefini\xE7\xE3o. "+t)}})}definirRotaPorPapel(i){let e={admin:"/dashboard",supervisor:"/dashboard",coordenador:"/dashboard",rh:"/rh",assessor:"/dashboard"};return i&&e[i]?e[i]:"/dashboard"}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=v({type:l,selectors:[["app-login"]],decls:17,vars:4,consts:[[1,"container","py-5",2,"max-width","420px"],[1,"mb-3"],[3,"ngSubmit","formGroup"],[1,"form-label"],["type","email","formControlName","email","autocomplete","username",1,"form-control"],["type","password","formControlName","senha","autocomplete","current-password",1,"form-control"],[1,"btn","btn-success","w-100",3,"disabled"],["type","button",1,"btn","btn-link","mt-2",3,"click"],["class","text-danger mt-2",4,"ngIf"],[1,"text-danger","mt-2"]],template:function(e,t){e&1&&(a(0,"div",0)(1,"h3",1),o(2,"Entrar"),r(),a(3,"form",2),h("ngSubmit",function(){return t.onSubmit()}),a(4,"div",1)(5,"label",3),o(6,"E-mail"),r(),f(7,"input",4),r(),a(8,"div",1)(9,"label",3),o(10,"Senha"),r(),f(11,"input",5),r(),a(12,"button",6),o(13),r(),a(14,"button",7),h("click",function(){return t.reset()}),o(15,"Esqueci minha senha"),r(),b(16,T,2,1,"div",8),r()()),e&2&&(s(3),u("formGroup",t.form),s(9),u("disabled",t.form.invalid||t.loading()),s(),C(" ",t.loading()?"Entrando\u2026":"Entrar"," "),s(3),u("ngIf",t.erro()))},dependencies:[_,E,D,L,N,F,I,M,P],encapsulation:2})};export{R as LoginComponent};
