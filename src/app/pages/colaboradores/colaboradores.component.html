
<div class="container py-4">
  <div class="hdr d-flex align-items-end justify-content-between mb-4">
    <div>
      <h3 class="title mb-1">Gerenciar Colaboradores</h3>
      <p class="subtitle mb-0">Crie usuários com CPF e foto de perfil para acesso ao sistema.</p>
    </div>
    <div class="badge-pill" [class.badge-loading]="loading()">
      <span *ngIf="!loading()">Pronto</span>
      <span *ngIf="loading()">Salvando...</span>
    </div>
  </div>

  <div class="card shadow-soft">
    <form [formGroup]="form" (ngSubmit)="criar()" class="card-body">
      <!-- Foto + preview -->
      <div class="row mb-4 align-items-center">
        <div class="col-auto">
          <div class="avatar-wrap">
            <img
              *ngIf="fotoPreview(); else noFoto"
              [src]="fotoPreview()!"
              alt="Foto do colaborador"
              class="avatar-img">
            <ng-template #noFoto>
              <div class="avatar-skeleton">Foto</div>
            </ng-template>
          </div>
        </div>
        <div class="col">
          <label class="form-label mb-1">Foto de perfil (opcional)</label>
          <input type="file" accept="image/*" class="form-control form-control-sm w-auto" (change)="onFotoChange($event)">
          <small class="text-muted d-block mt-1">Imagem exibida no perfil após o login do colaborador.</small>
        </div>
      </div>

      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Nome</label>
          <input class="form-control" formControlName="nome" placeholder="Ex.: Maria Souza">
          <div class="invalid-msg" *ngIf="form.get('nome')?.touched && form.get('nome')?.invalid">
            Informe o nome completo.
          </div>
        </div>

        <div class="col-md-6">
          <label class="form-label">E-mail</label>
          <input class="form-control" formControlName="email" type="email" placeholder="email@empresa.com">
          <div class="invalid-msg" *ngIf="form.get('email')?.touched && form.get('email')?.invalid">
            E-mail inválido.
          </div>
        </div>

        <div class="col-md-6">
          <label class="form-label">Senha (inicial)</label>
          <input class="form-control" formControlName="senha" type="password" autocomplete="new-password" placeholder="Mín. 6 caracteres">
          <div class="invalid-msg" *ngIf="form.get('senha')?.touched && form.get('senha')?.invalid">
            Mínimo de 6 caracteres.
          </div>
        </div>

        <div class="col-md-6">
          <label class="form-label">CPF</label>
          <input class="form-control" formControlName="cpf" placeholder="Somente números (11 dígitos)">
          <div class="invalid-msg" *ngIf="cpfErro()">{{ cpfErro() }}</div>
        </div>

        <div class="col-md-4">
          <label class="form-label">Papel</label>
          <select class="form-select" formControlName="papel">
            <option value="admin">Administrador</option>
            <option value="supervisor">Supervisor</option>
            <option value="coordenador">Coordenador</option>
            <option value="assessor">Assessor</option>
            <option value="operacional">Operacional</option>
            <option value="rh">RH</option>
            <option value="financeiro">Financeiro</option>
            <option value="qualidade">Controle de Qualidade</option>
          </select>
        </div>

        <div class="col-md-4">
          <label class="form-label">Status</label>
          <select class="form-select" formControlName="status">
            <option value="ativo">Ativo</option>
            <option value="inativo">Inativo</option>
          </select>
        </div>
      </div>

      <div class="mt-4 d-flex gap-2">
        <button class="btn btn-primary px-4" [disabled]="form.invalid || loading()">Criar colaborador</button>
        <button type="button" class="btn btn-outline-secondary" [disabled]="loading()" (click)="form.reset({ papel: 'assessor', status: 'ativo' })">
          Limpar
        </button>
      </div>

      <div class="mt-3">
        <div class="alert alert-danger py-2 px-3 mb-2" *ngIf="erro()">{{ erro() }}</div>
        <div class="alert alert-success py-2 px-3" *ngIf="ok()">{{ ok() }}</div>
      </div>
    </form>
  </div>
</div>
