<div class="container-fluid py-4">
  <form (ngSubmit)="salvar()" #form="ngForm" class="container py-4 card-crenorte shadow-lg rounded">
    <!-- HEADER COM LOGO -->
    <div class="form-header">
      <div class="title-box px-2">
        <h2 class="form-title mb-0">Cadastro de Cliente</h2>
        <small class="subtitle">Microcrédito Produtivo Orientado</small>
      </div>
      <div class="logo-box">
        <img src="../../../assets/img/logo2-crenorte.png" alt="Logo CRENORTE" class="logo-img">
      </div>
    </div>

    <!-- IDENTIFICAÇÃO -->
    <fieldset class="border p-3 mb-4 rounded">

      <div class="row">
        <div class="col-md-4 mb-2">
          <label class="form-label">Nome Completo</label>
          <input class="form-control" name="nomeCompleto" [(ngModel)]="cliente.nomeCompleto" required />
        </div>

        <div class="col-md-4 mb-2">
          <label class="form-label">Gênero</label>
          <select class="form-select" [ngModel]="selecionouOutroGenero ? 'Outro' : cliente.genero"
            (ngModelChange)="aoTrocarGenero($event)" name="generoSelect">
            <option value="" disabled>Selecione uma opção</option>
            <option value="Masculino">Masculino</option>
            <option value="Feminino">Feminino</option>
            <option value="Não-binário">Não-binário</option>
            <option value="Outro">Outro</option>
          </select>

          <div class="mt-2" *ngIf="selecionouOutroGenero">
            <input type="text" class="form-control" placeholder="Descreva seu gênero" [(ngModel)]="cliente.genero"
              name="generoOutro" />
          </div>
        </div>

        <div class="col-md-4">
          <label class="form-label">Estado Civil</label>
          <select class="form-select" name="estadoCivil" [(ngModel)]="cliente.estadoCivil" required>
            <option value="" disabled selected>Selecione...</option>
            <option value="Solteiro(a)">Solteiro(a)</option>
            <option value="Casado(a)">Casado(a)</option>
            <option value="Divorciado(a)">Divorciado(a)</option>
            <option value="Separado(a)">Separado(a)</option>
            <option value="Viúvo(a)">Viúvo(a)</option>
            <option value="União Estável">União Estável</option>
          </select>
        </div>
        <div class="row mt-2">

          <div class="col-md-6 mb-2">
            <label class="form-label">CPF</label>
            <input class="form-control" name="cpf" [(ngModel)]="cliente.cpf" required #cpfCtrl="ngModel"
              mask="000.000.000-00" (blur)="cpfValido = validarCPF(cliente.cpf)" />
            <div *ngIf="cpfCtrl.invalid && cpfCtrl.touched" class="text-danger small">
              CPF é obrigatório.
            </div>
            <div *ngIf="cpfCtrl.valid && cpfValido === false" class="text-danger small">
              CPF inválido. Verifique.
            </div>
          </div>
          <div class="col-md-6 mb-2">
            <label class="form-label">RG</label>
            <input class="form-control" name="rg" [(ngModel)]="cliente.rg" />
          </div>
        </div>
      </div>
      <div class="row mt-2">
        <div class="col-md-3 mb-2">
          <label class="form-label">Data de Nascimento</label>
          <div class="d-flex gap-2">
            <!-- Dia -->
            <select class="form-select" [(ngModel)]="diaSelecionado" (change)="atualizarDataNascimento()"
              name="diaNascimento">
              <option value="" disabled selected>Dia</option>
              <option *ngFor="let dia of dias" [value]="dia">{{ dia }}</option>
            </select>

            <!-- Mês -->
            <select class="form-select" [(ngModel)]="mesSelecionado" (change)="atualizarDataNascimento()"
              name="mesNascimento">
              <option value="" disabled selected>Mês</option>
              <option *ngFor="let mes of meses; let i = index" [value]="i+1">{{ mes }}</option>
            </select>

            <!-- Ano -->
            <select class="form-select" [(ngModel)]="anoSelecionado" (change)="atualizarDataNascimento()"
              name="anoNascimento">
              <option value="" disabled selected>Ano</option>
              <option *ngFor="let ano of anos" [value]="ano">{{ ano }}</option>
            </select>
          </div>

        </div>

        <div class="col-md-3 mb-2">
          <label class="form-label">Telefone (Whatsapp)</label>
          <input class="form-control"
       name="contato"
       [(ngModel)]="cliente.contato"
       mask="(00) 00000-0000"
       [dropSpecialCharacters]="true"
       required />

        </div>
        <div class="col-md-6">
          <label class="form-label">E-mail</label>
          <input type="email" class="form-control" name="email" [(ngModel)]="cliente.email" />
        </div>
      </div>

      <div class="row mt-2">
        <div class="col-md-6 mb-2">
          <label class="form-label">Endereço</label>
          <input class="form-control" name="endereco" [(ngModel)]="cliente.endereco" />
        </div>
        <div class="col-md-3 mb-2">
          <label class="form-label">Bairro</label>
          <input class="form-control" name="bairro" [(ngModel)]="cliente.bairro" />
        </div>
        <div class="col-md-3 mb-2">
          <label class="form-label">Estado</label>
          <select class="form-select" name="estado" [(ngModel)]="cliente.estado" (change)="atualizarMunicipios()"
            required>
            <option value="" disabled selected>Selecione o estado</option>
            <option *ngFor="let uf of estadosNorte" [value]="uf.sigla">{{ uf.nome }}</option>
          </select>
        </div>
        <div class="col-md-3 mt-2">
          <label class="form-label">Cidade</label>
          <select class="form-select" name="cidade" [(ngModel)]="cliente.cidade" [disabled]="!municipios.length"
            required>
            <option value="" disabled selected>Selecione a cidade</option>
            <option *ngFor="let cidade of municipios" [value]="cidade">{{ cidade }}</option>
          </select>
        </div>
      </div>
    </fieldset>

    <!-- EMPREENDIMENTO -->
    <fieldset class="border p-3 mb-4 rounded">
      <legend class="w-auto px-2 fw-bold text-success">Empreendimento</legend>

      <div class="mb-2">
        <label class="d-block">Você já tem um empreendimento?</label>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" [(ngModel)]="cliente.jaEmpreende" name="jaEmpreende"
            [value]="true" />
          <label class="form-check-label">Sim</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" [(ngModel)]="cliente.jaEmpreende" name="jaEmpreende"
            [value]="false" />
          <label class="form-check-label">Não</label>
        </div>
      </div>

      <div *ngIf="cliente.jaEmpreende === true">
        <div class="mb-2">
          <label class="form-label">Faturamento mensal aproximado</label>
          <input type="text" class="form-control" [(ngModel)]="cliente.faturamentoMensal" name="faturamentoMensal"
            mask="separator.2" prefix="R$ " thousandSeparator="." decimalMarker="," />
        </div>

        <div class="mb-2">
          <label class="form-label">Tempo de empreendimento</label>
          <select class="form-select" [(ngModel)]="cliente.tempoEmpreendimento" name="tempoEmpreendimento">
            <option value="" disabled selected>Selecione uma opção</option>
            <option value="1 a 6 meses">1 a 6 meses</option>
            <option value="+ de 6 meses">+ de 6 meses</option>
            <option value="+ de 1 ano">+ de 1 ano</option>
            <option value="+ de 2 anos">+ de 2 anos</option>
          </select>
        </div>
      </div>



      <div class="mb-2">
        <label class="form-label">Qual tipo de empreendimento você tem ou quer iniciar?</label>

        <select class="form-select" [ngModel]="selecionouOutroTipoNegocio ? 'Outro' : cliente.tipoNegocio"
          (ngModelChange)="aoTrocarTipoNegocio($event)" name="tipoNegocioSelect">
          <option value="" disabled>Selecione uma atividade</option>

          <!-- Comércio -->
          <option value="Mercearia">Mercearia / Mini mercado</option>
          <option value="Vendedor ambulante">Vendedor ambulante</option>
          <option value="Comércio de roupas">Comércio de roupas / confecções</option>
          <option value="Cosméticos e perfumes">Cosméticos e perfumes</option>
          <option value="Bijuterias e acessórios">Bijuterias e acessórios</option>
          <option value="Loja de variedades">Armarinho / Loja de variedades</option>
          <option value="Alimentos e bebidas">Comércio de alimentos e bebidas</option>
          <option value="Materiais de construção">Materiais de construção (pequeno porte)</option>
          <option value="Papelaria e utilidades">Papelaria / Utilidades</option>

          <!-- Alimentação -->
          <option value="Lanchonete">Lanchonete</option>
          <option value="Restaurante caseiro">Restaurante caseiro</option>
          <option value="Venda de salgados e doces">Venda de salgados e doces</option>
          <option value="Churrasquinho de rua">Churrasquinho de rua</option>
          <option value="Padaria artesanal">Padaria artesanal</option>
          <option value="Açaí e sorvetes">Sorveteria / Açaí</option>
          <option value="Marmitas">Marmitas / Refeições para entrega</option>

          <!-- Serviços pessoais -->
          <option value="Salão de beleza">Salão de beleza / Cabeleireiro</option>
          <option value="Barbearia">Barbearia</option>
          <option value="Manicure e pedicure">Manicure e pedicure</option>
          <option value="Estética e design de sobrancelhas">Estética / Sobrancelhas / Maquiagem</option>
          <option value="Costura e conserto de roupas">Costura e conserto de roupas</option>
          <option value="Bordado e customização">Bordado / Customização</option>

          <!-- Serviços gerais -->
          <option value="Serviços de limpeza">Serviços de limpeza</option>
          <option value="Lavanderia">Lavanderia</option>
          <option value="Reparos domésticos">Reparos domésticos (eletricista, encanador, etc.)</option>
          <option value="Pintura">Pintura residencial</option>
          <option value="Serralheria">Serralheria / Marcenaria</option>
          <option value="Oficina de bicicletas">Oficina de bicicletas</option>
          <option value="Oficina de motos">Oficina de motos</option>
          <option value="Assistência de celulares">Assistência técnica de celulares</option>
          <option value="Serviços de informática">Serviços de informática</option>

          <!-- Transporte -->
          <option value="Mototaxi">Mototáxi / Transporte alternativo</option>
          <option value="Fretes e entregas">Fretes / Entregas</option>

          <!-- Produção / Agro / Artesanato -->
          <option value="Hortifruti">Hortifruti / Agricultura familiar</option>
          <option value="Criação de aves">Criação de aves</option>
          <option value="Criação de peixes">Criação de peixes (piscicultura)</option>
          <option value="Criação de suínos">Criação de suínos</option>
          <option value="Plantas ornamentais">Cultivo de plantas ornamentais</option>
          <option value="Artesanato em madeira">Artesanato em madeira</option>
          <option value="Artesanato em cerâmica">Artesanato em cerâmica</option>
          <option value="Artesanato com fibras">Artesanato com fibras naturais</option>
          <option value="Confecção">Confecção / Pequena produção têxtil</option>

          <!-- Criativos / Mídia -->
          <option value="Fotografia e filmagem">Fotografia e filmagem</option>
          <option value="Produção cultural">Produção cultural (música, dança, etc.)</option>

          <!-- Outro -->
          <option value="Outro">Outro</option>
        </select>

        <div class="mt-2" *ngIf="selecionouOutroTipoNegocio">
          <input type="text" class="form-control" placeholder="Descreva seu tipo de negócio"
            [(ngModel)]="cliente.tipoNegocio" name="tipoNegocioOutro" />
        </div>
      </div>



      <div class="mb-2">
        <label class="form-label">Onde funciona ou funcionará o seu empreendimento?</label>

        <select class="form-select" [ngModel]="selecionouOutroOndeVende ? 'Outro' : cliente.ondeVende"
          (ngModelChange)="aoTrocarOndeVende($event)" name="ondeVendeSelect">
          <option value="" disabled>Selecione uma opção</option>
          <option value="Na minha casa">Na minha casa</option>
          <option value="Online">Online (WhatsApp, Instagram etc.)</option>
          <option value="Na rua/feira">Na rua/feira</option>
          <option value="Outro">Outro</option>
        </select>

        <div class="mt-2" *ngIf="selecionouOutroOndeVende">
          <input type="text" class="form-control" placeholder="Descreva onde você vende" [(ngModel)]="cliente.ondeVende"
            name="ondeVendeOutro" />
        </div>
      </div>

    </fieldset>

    <!-- RENDA E ORGANIZAÇÃO -->
    <fieldset class="border p-3 mb-4 rounded">
      <legend class="w-auto px-2 fw-bold text-success">Renda e Organização</legend>

      <div class="mb-2">
        <label>Tem outra fonte de renda além do seu negócio?</label>
        <br>
        <div class="form-check form-check-inline">
          <input type="radio" class="form-check-input" [(ngModel)]="cliente.outraRenda" name="outraRenda"
            [value]="true" /> Sim
        </div>
        <div class="form-check form-check-inline">
          <input type="radio" class="form-check-input" [(ngModel)]="cliente.outraRenda" name="outraRenda"
            [value]="false" /> Não
        </div>
      </div>

      <!-- Só aparece se cliente.outraRenda === true -->
      <div class="mb-2" *ngIf="cliente.outraRenda === true">
        <label class="form-label">Renda mensal aproximada</label>
        <input type="text" class="form-control" [(ngModel)]="cliente.rendaMensal" name="rendaMensal" mask="separator.2"
          prefix="R$ " thousandSeparator="." decimalMarker="," />
      </div>


      <div class="mb-2">
        <label class="form-label">Ocupação atual</label>
        <input class="form-control" name="ocupacaoAtual" [(ngModel)]="cliente.ocupacaoAtual" />
      </div>

    </fieldset>

    <!-- EMPRÉSTIMO -->
    <fieldset class="border p-3 mb-4 rounded">
      <legend class="w-auto px-2 fw-bold text-success">Empréstimo</legend>
      <div class="row mb-2">
        <div class="col-md-6 mb-2">
          <label class="form-label">Valor Solicitado (R$)</label>
          <input type="text" class="form-control" [(ngModel)]="cliente.valorSolicitado" name="valorSolicitado"
            mask="separator.2" prefix="R$ " thousandSeparator="." decimalMarker=","
            (ngModelChange)="onValorChange($event)" />
        </div>

        <div class="col-md-6">
          <label class="form-label">Parcelas:</label>
          <select class="form-select" [(ngModel)]="cliente.parcelas" name="parcelas"
            (ngModelChange)="onParcelasChange($event)">
            <option value="" disabled selected>Selecione</option>
            <option *ngFor="let p of parcelasComValor" [value]="p.n">
              {{ p.label }}
            </option>
          </select>

          <small class="text-muted d-block mt-1" *ngIf="resumoParcela">
            {{ resumoParcela }}
          </small>
        </div>
      </div>



      <div class="mb-2">
        <label class="form-label">Para que usaria esse valor?</label>
        <div class="form-check">
          <input type="radio" class="form-check-input" [(ngModel)]="cliente.usoValor" name="usoValor"
            value="Investimento em negócio" /> Investimento em negócio
        </div>
        <div class="form-check">
          <input type="radio" class="form-check-input" [(ngModel)]="cliente.usoValor" name="usoValor"
            value="Capital de giro" /> Capital de giro
        </div>
        <div class="form-check">
          <input type="radio" class="form-check-input" [(ngModel)]="cliente.usoValor" name="usoValor" value="Outro" />
          Outro
        </div>
      </div>

      <div class="mb-2">
        <label>Já é cliente da CRENORTE?</label>
        <div class="form-check form-check-inline">
          <input type="radio" [(ngModel)]="cliente.clienteCrenorte" name="clienteCrenorte" [value]="true" /> Sim
        </div>
        <div class="form-check form-check-inline">
          <input type="radio" [(ngModel)]="cliente.clienteCrenorte" name="clienteCrenorte" [value]="false" /> Não
        </div>
      </div>

      <div class="mb-2">
        <label>Já possui algum empréstimo ativo?</label>
        <div class="form-check form-check-inline">
          <input type="radio" [(ngModel)]="cliente.emprestimoAtivo" name="emprestimoAtivo" [value]="true" /> Sim
        </div>
        <div class="form-check form-check-inline">
          <input type="radio" [(ngModel)]="cliente.emprestimoAtivo" name="emprestimoAtivo" [value]="false" /> Não
        </div>
      </div>

      <div class="mb-2">
        <label class="form-label">Se sim, com qual instituição?</label>
        <input class="form-control" name="instituicaoEmprestimo" [(ngModel)]="cliente.instituicaoEmprestimo" />
      </div>
    </fieldset>

    <!-- FINALIZAÇÃO -->
    <fieldset class="border p-3 mb-4 rounded">
      <legend class="w-auto px-2 fw-bold text-success">Data do cadastro</legend>
      <div class="mb-2">
        <label class="form-label">Data do preenchimento</label>
        <div class="row mb-3">
          <div class="col">
            <select class="form-select" [(ngModel)]="diaPre" (ngModelChange)="atualizarDataPreenchimento()"
              name="diaPreenchimento">
              <option value="">Dia</option>
              <option *ngFor="let d of dias" [value]="d">{{ d }}</option>
            </select>
          </div>
          <div class="col">
            <select class="form-select" [(ngModel)]="mesPre" (ngModelChange)="atualizarDataPreenchimento()"
              name="mesPreenchimento">
              <option value="">Mês</option>
              <option *ngFor="let m of meses; let i = index" [value]="i+1">{{ m }}</option>
            </select>
          </div>
          <div class="col">
            <select class="form-select" [(ngModel)]="anoPre" (ngModelChange)="atualizarDataPreenchimento()"
              name="anoPreenchimento">
              <option value="">Ano</option>
              <option *ngFor="let a of anos" [value]="a">{{ a }}</option>
            </select>
          </div>
        </div>

      </div>


      <div class="form-check mb-4">
        <input type="checkbox" class="form-check-input" [(ngModel)]="cliente.autorizacaoUsoDados"
          name="autorizacaoUsoDados" />
        <label class="form-check-label">Autorizo o uso dos meus dados para fins de contato comercial</label>
      </div>

      <div class="d-flex justify-content-start gap-2">
        <button type="submit" class="btn btn-success">Salvar</button>
      </div>
    </fieldset>
  </form>
</div>